<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Wooley, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="我将去向哪里">
<meta property="og:type" content="website">
<meta property="og:title" content="航行日志">
<meta property="og:url" content="http://wooley.win/page/10/index.html">
<meta property="og:site_name" content="航行日志">
<meta property="og:description" content="我将去向哪里">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="航行日志">
<meta name="twitter:description" content="我将去向哪里">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wooley.win/page/10/"/>





  <title> 航行日志 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">航行日志</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">追寻梦想</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2011/01/02/apache开多个虚拟站点/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/01/02/apache开多个虚拟站点/" itemprop="url">
                  apache开多个虚拟站点 - 做人得天天做 - JavaEye技术网站
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2011-01-02T01:09:13+08:00">
                2011-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://bea.javaeye.com/blog/166485" target="_blank" rel="external">apache开多个虚拟站点 - 做人得天天做 - JavaEye技术网站</a>.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2011/01/02/Ubuntu下启动重启停止apache服务器/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/01/02/Ubuntu下启动重启停止apache服务器/" itemprop="url">
                  Ubuntu下启动/重启/停止apache服务器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2011-01-02T00:32:29+08:00">
                2011-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">Ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Task: Start Apache 2 Server /启动apache服务</p>
<p><span style="font-family: 新宋体;"># /etc/init.d/apache2 start<br></span>or<br><span style="font-family: 新宋体;">$ sudo /etc/init.d/apache2 start</span></p>
<p>Task: Restart Apache 2 Server  /重启apache服务</p>
<p><span style="font-family: 新宋体;"># /etc/init.d/apache2 restart<br></span>or<br><span style="font-family: 新宋体;">$ sudo /etc/init.d/apache2 restart</span></p>
<p>Task: Stop Apache 2 Server  /停止apache服务</p>
<p><span style="font-family: 新宋体;"># /etc/init.d/apache2 stop<br></span>or<br><span style="font-family: 新宋体;">$ sudo /etc/init.d/apache2 stop</span></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2011/01/01/关于ubuntu下的httpd.conf/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/01/01/关于ubuntu下的httpd.conf/" itemprop="url">
                  关于ubuntu下的httpd.conf
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2011-01-01T22:29:52+08:00">
                2011-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ubuntu下的httpd.conf位置在 /etc/apache2/ 初始还是空的</p>
<p>其实，apache2的配置文件在 /etc/apache2/apache2.conf</p>
<p>apache2 根据配置功能的不同, 对配置文件进行了分割, 这样更利于管理</p>
<p>同时，也不会随着httpd.conf的增加而变化。</p>
<p>另外，我们备份网站的一些配置文件也很方便，可以在 sites-enabled配置</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/31/WordPress自动升级插件时需要填写FTP信息的解决/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/31/WordPress自动升级插件时需要填写FTP信息的解决/" itemprop="url">
                  WordPress自动升级插件时需要填写FTP信息的解决
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-31T23:52:47+08:00">
                2010-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>sudo chown -R www-data.www-data /home/username/wordpress</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/30/OpenVPN HOWTO 中文版/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/30/OpenVPN HOWTO 中文版/" itemprop="url">
                  OpenVPN HOWTO 中文版
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-30T19:05:53+08:00">
                2010-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>OpenVPN HOWTO</p>
<p>介绍<br>此文档描述一个典型的Home到Office的通信中OpenVPN的配置。这份HOWTO举了一个完整的配置实例，在man page手册页中有一个更为简单的例子。</p>
<p>此HOWTO文档还有如下格式：</p>
<p>PDF<br>PostScript</p>
<p>附加的文档<br>其他的一些很好的文档及HOWTO 为不同环境下配置OpenVPN而作。</p>
<p>基本的隧道(Tunnel)类型<br>OpenVPN可以创建两种基本的隧道类型：</p>
<p>Routed IP tunnels – 适用于不需广播的点对点IP(point-to-point)通信。比起桥接网络隧道来略显得更有效率些而且更易配置。此HOWTO文档涵盖了Routed IP tunnels。<br>Bridged Ethernet Tunnels(桥接网络隧道) – 能用于IP协议或非IP协议的隧道。这种类型的隧道更适合于使用广播(broadcast)的应用，比如某些Windows网络游戏。配置起来稍微复杂些。关于桥接网络隧道的Mini-HOWTO。<br>Routed IP tunnel HOWTO<br>我们会尝试描述一个完整的系统配置，期间涉及到防火墙，VPN，NAT以及他们彼此间的相互关联，我们不会孤立的一部分一部分的探讨VPN设置。</p>
<p>在我们的例子中，Home和Office机器所在的私有网络都分别通过了一台具有公网IP地址的网关机器接入互联网。每台网关机器都配有两块网卡（NIC），一块联入内网，另一块联入公网。网关机器为内网机器提供NAT，防火墙，VPN服务。Home及Office机器的配置基本一样，除了Office的网关机器为固定IP，Home机器的IP为DHCP动态获取。</p>
<p>在以下例子中所显示的配置文件在OpenVPN发布版本中是有效的。</p>
<p>Home和Office的IP网络参数<br>Home Office<br>本地子网 (内网地址) 10.0.1.0/24 10.0.0.0/24<br>Tunnel Endpoint (内网地址) 10.1.0.2 10.1.0.1<br>OpenVPN Gateway (公网地址) DHCP client, need not be explicitly specified 1.2.3.4</p>
<p>安装 OpenVPN<br>如果你的系统没有OpenSSL库，你需要 下载和安装它。</p>
<p>如果你想使用VPN连接的压缩特性，或者你想将OpenVPN安装为一个RPM包，安装LZO Library。</p>
<p>如果你使用Linux 2.2 或更早版本，下载 TUN/TAP driver。对于Linux 2.4.7及以上版本的用户TUN/TAP 驱动已经捆绑到内核中。Linux 2.4.0 -&gt; 2.4.6 的用户需要留意INSTALL文件末尾的注意信息。</p>
<p>现在下载 OpenVPN 的最新发布版：</p>
<p><a href="http://prdownloads.sourceforge.net/openvpn/openvpn-1.6.0.tar.gz" target="_blank" rel="external">http://prdownloads.sourceforge.net/openvpn/openvpn-1.6.0.tar.gz</a><br>使用 tarball 安装<br>解开发布版的压缩包：</p>
<p>gzip -dc openvpn-1.6.0.tar.gz | tar xvf -<br>创建 OpenVPN:</p>
<p>cd openvpn-1.6.0<br>./configure<br>make<br>make install<br>如果你未下载 LZO Library ，将 –disable-lzo 加入到 configure 命令中。也可以启用其他的选型，比如 pthread (./configure –enable-pthread) 用来提高 SSL/TLS 动态密钥交换的响应速度。命令</p>
<p>./configure –help<br>将显示所有的配置选型。</p>
<p>从 RPM 安装<br>首先创建RPM文件。此操作需要 OpenSSl，pthread，和LZO 库。通常只会有 LZO 库需要额外下载并安装；; 其他的库在大多数的Linux 发行版本中已经作为缺省安装。</p>
<p>rpmbuild -tb openvpn-1.6.0.tar.gz<br>RPM 创建过程会生成大量输出信息。创建成功后，在输出信息的末尾附记会有一个提示信息说明生成的二进制RPM文件名。用如下命令安装该文件：</p>
<p>rpm -Uvh binary-RPM-file</p>
<p>配置 TUN/TAP 驱动<br>仅需一次的配置<br>如果你使用 Linux 2.4.7 或更高版本，十分幸运 TUN/TAP 驱动已经捆绑到内核中。你可以通过如下命令确认：<br>locate if_tun.h<br>此命令产生类似这样的信息 /usr/include/linux/if_tun.h 。</p>
<p>对于 Linux 2.4.7 或更高版本，如果你通过 tarball 安装，输入如下命令配置 TUN/TAP 设备节点（如果你通过 RPM 安装可以忽略这一步，因为RPM为你自动创建该节点）：</p>
<p>mknod /dev/net/tun c 10 200<br>如果你使用 Linux 2.2，你需要获得 版本 1.1 的TUN/TAP kernel module 并按照安装说明进行操作。</p>
<p>每次系统启动后需要执行一次的配置<br>在 Linux 上使用 OpenVPN 或任何用到 TUN/TAP 设备的程序前需要载入 TUN/TAP kernel module：</p>
<p>modprobe tun<br>并且启用 IP 转发：</p>
<p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<p>配置 Firewall 和 NAT<br>这一小节假定你使用 Linux 2.4 和 iptables 防火墙。这里是一个防火墙配置的例子，它为内网机器访问互联网提供了NAT服务，stateful outgoing connection tracking, 和 OpenVPN 支持:</p>
<hr>
<p>sample-config-files/firewall.sh</p>
<p>#!/bin/bash</p>
<h1 id="OpenVPN-aware-防火墙例子"><a href="#OpenVPN-aware-防火墙例子" class="headerlink" title="OpenVPN-aware 防火墙例子."></a>OpenVPN-aware 防火墙例子.</h1><h1 id="eth0-连接到互联网"><a href="#eth0-连接到互联网" class="headerlink" title="eth0 连接到互联网."></a>eth0 连接到互联网.</h1><h1 id="eth1-连接到内部子网"><a href="#eth1-连接到内部子网" class="headerlink" title="eth1 连接到内部子网."></a>eth1 连接到内部子网.</h1><h1 id="这里改变你的子网地址"><a href="#这里改变你的子网地址" class="headerlink" title="这里改变你的子网地址"></a>这里改变你的子网地址</h1><h1 id="Home-使用-10-0-1-0-24"><a href="#Home-使用-10-0-1-0-24" class="headerlink" title="Home   使用 10.0.1.0/24"></a>Home   使用 10.0.1.0/24</h1><h1 id="Office-使用-10-0-0-0-24"><a href="#Office-使用-10-0-0-0-24" class="headerlink" title="Office 使用 10.0.0.0/24"></a>Office 使用 10.0.0.0/24</h1><p>PRIVATE=10.0.0.0/24</p>
<h1 id="Loopback-地址"><a href="#Loopback-地址" class="headerlink" title="Loopback 地址"></a>Loopback 地址</h1><p>LOOP=127.0.0.1</p>
<h1 id="删除旧的-iptables-规则"><a href="#删除旧的-iptables-规则" class="headerlink" title="删除旧的 iptables 规则"></a>删除旧的 iptables 规则</h1><h1 id="并且临时阻塞网络通信"><a href="#并且临时阻塞网络通信" class="headerlink" title="并且临时阻塞网络通信"></a>并且临时阻塞网络通信</h1><p>iptables -P OUTPUT DROP<br>iptables -P INPUT DROP<br>iptables -P FORWARD DROP<br>iptables -F</p>
<h1 id="设置缺省策略"><a href="#设置缺省策略" class="headerlink" title="设置缺省策略"></a>设置缺省策略</h1><p>iptables -P OUTPUT ACCEPT<br>iptables -P INPUT DROP<br>iptables -P FORWARD DROP</p>
<h1 id="阻止外部数据包使用-loopback-地址"><a href="#阻止外部数据包使用-loopback-地址" class="headerlink" title="阻止外部数据包使用 loopback 地址"></a>阻止外部数据包使用 loopback 地址</h1><p>iptables -A INPUT -i eth0 -s $LOOP -j DROP<br>iptables -A FORWARD -i eth0 -s $LOOP -j DROP<br>iptables -A INPUT -i eth0 -d $LOOP -j DROP<br>iptables -A FORWARD -i eth0 -d $LOOP -j DROP</p>
<h1 id="任何从互联网流入的数据包都必须使用真实互联网地址"><a href="#任何从互联网流入的数据包都必须使用真实互联网地址" class="headerlink" title="任何从互联网流入的数据包都必须使用真实互联网地址"></a>任何从互联网流入的数据包都必须使用真实互联网地址</h1><p>iptables -A FORWARD -i eth0 -s 192.168.0.0/16 -j DROP<br>iptables -A FORWARD -i eth0 -s 172.16.0.0/12 -j DROP<br>iptables -A FORWARD -i eth0 -s 10.0.0.0/8 -j DROP<br>iptables -A INPUT -i eth0 -s 192.168.0.0/16 -j DROP<br>iptables -A INPUT -i eth0 -s 172.16.0.0/12 -j DROP<br>iptables -A INPUT -i eth0 -s 10.0.0.0/8 -j DROP</p>
<h1 id="阻塞-NetBios-数据包流出-如果内网有-windows-机器-。"><a href="#阻塞-NetBios-数据包流出-如果内网有-windows-机器-。" class="headerlink" title="阻塞 NetBios 数据包流出(如果内网有 windows 机器)。"></a>阻塞 NetBios 数据包流出(如果内网有 windows 机器)。</h1><h1 id="这不会影响-VPN-隧道上的NetBios通信，"><a href="#这不会影响-VPN-隧道上的NetBios通信，" class="headerlink" title="这不会影响 VPN 隧道上的NetBios通信，"></a>这不会影响 VPN 隧道上的NetBios通信，</h1><h1 id="但它会阻止本地-windows-机器向互联网广播自己。"><a href="#但它会阻止本地-windows-机器向互联网广播自己。" class="headerlink" title="但它会阻止本地 windows 机器向互联网广播自己。"></a>但它会阻止本地 windows 机器向互联网广播自己。</h1><p>iptables -A FORWARD -p tcp –sport 137:139 -o eth0 -j DROP<br>iptables -A FORWARD -p udp –sport 137:139 -o eth0 -j DROP<br>iptables -A OUTPUT -p tcp –sport 137:139 -o eth0 -j DROP<br>iptables -A OUTPUT -p udp –sport 137:139 -o eth0 -j DROP</p>
<h1 id="检查流向互联网的数据包中源地址的合法性"><a href="#检查流向互联网的数据包中源地址的合法性" class="headerlink" title="检查流向互联网的数据包中源地址的合法性"></a>检查流向互联网的数据包中源地址的合法性</h1><p>iptables -A FORWARD -s ! $PRIVATE -i eth1 -j DROP</p>
<h1 id="允许本地-loopback"><a href="#允许本地-loopback" class="headerlink" title="允许本地 loopback"></a>允许本地 loopback</h1><p>iptables -A INPUT -s $LOOP -j ACCEPT<br>iptables -A INPUT -d $LOOP -j ACCEPT</p>
<h1 id="允许向内的-incoming-ping-操作-可以禁止"><a href="#允许向内的-incoming-ping-操作-可以禁止" class="headerlink" title="允许向内的(incoming) ping 操作(可以禁止)"></a>允许向内的(incoming) ping 操作(可以禁止)</h1><p>iptables -A INPUT -p icmp –icmp-type echo-request -j ACCEPT</p>
<h1 id="允许-www-和-ssh-服务-可以禁止"><a href="#允许-www-和-ssh-服务-可以禁止" class="headerlink" title="允许 www 和 ssh 服务(可以禁止)"></a>允许 www 和 ssh 服务(可以禁止)</h1><p>iptables -A INPUT -p tcp –dport http -j ACCEPT<br>iptables -A INPUT -p tcp –dport ssh -j ACCEPT</p>
<h1 id="允许向内的-incoming-OpenVPN-数据包"><a href="#允许向内的-incoming-OpenVPN-数据包" class="headerlink" title="允许向内的(incoming) OpenVPN 数据包"></a>允许向内的(incoming) OpenVPN 数据包</h1><h1 id="对于每条-OpenVPN-隧道要将以下每行重复，"><a href="#对于每条-OpenVPN-隧道要将以下每行重复，" class="headerlink" title="对于每条 OpenVPN 隧道要将以下每行重复，"></a>对于每条 OpenVPN 隧道要将以下每行重复，</h1><h1 id="改变-–dport-n-为-OpenVPN-UDP-实际端口。"><a href="#改变-–dport-n-为-OpenVPN-UDP-实际端口。" class="headerlink" title="改变 –dport n 为 OpenVPN UDP 实际端口。"></a>改变 –dport n 为 OpenVPN UDP 实际端口。</h1><p>#</p>
<h1 id="在-OpenVPN中，端口号由-–port-n-选项控制。"><a href="#在-OpenVPN中，端口号由-–port-n-选项控制。" class="headerlink" title="在 OpenVPN中，端口号由 –port n 选项控制。"></a>在 OpenVPN中，端口号由 –port n 选项控制。</h1><h1 id="如果你将这个选型写入配置文件，"><a href="#如果你将这个选型写入配置文件，" class="headerlink" title="如果你将这个选型写入配置文件，"></a>如果你将这个选型写入配置文件，</h1><h1 id="你可以去掉-‘–’后这一串字符。"><a href="#你可以去掉-‘–’后这一串字符。" class="headerlink" title="你可以去掉 ‘–’后这一串字符。"></a>你可以去掉 ‘–’后这一串字符。</h1><p>#</p>
<h1 id="If-you-taking-the-stateful-firewall"><a href="#If-you-taking-the-stateful-firewall" class="headerlink" title="If you taking the stateful firewall"></a>If you taking the stateful firewall</h1><h1 id="approach-参看-OpenVPN-HOWTO"><a href="#approach-参看-OpenVPN-HOWTO" class="headerlink" title="approach (参看 OpenVPN HOWTO),"></a>approach (参看 OpenVPN HOWTO),</h1><h1 id="那么注释掉下面这一行。"><a href="#那么注释掉下面这一行。" class="headerlink" title="那么注释掉下面这一行。"></a>那么注释掉下面这一行。</h1><p>iptables -A INPUT -p udp –dport 5000 -j ACCEPT</p>
<h1 id="允许来自-TUN-TAP-设备的数据包。"><a href="#允许来自-TUN-TAP-设备的数据包。" class="headerlink" title="允许来自 TUN/TAP 设备的数据包。"></a>允许来自 TUN/TAP 设备的数据包。</h1><h1 id="当-OpenVPN-运行于安全模式时，"><a href="#当-OpenVPN-运行于安全模式时，" class="headerlink" title="当 OpenVPN 运行于安全模式时，"></a>当 OpenVPN 运行于安全模式时，</h1><h1 id="他会对-tun-或-tap-接口上的数据包到达前进行验证。"><a href="#他会对-tun-或-tap-接口上的数据包到达前进行验证。" class="headerlink" title="他会对 tun 或 tap 接口上的数据包到达前进行验证。"></a>他会对 tun 或 tap 接口上的数据包到达前进行验证。</h1><h1 id="也就是说，这里添加的任何过滤不是必需的，"><a href="#也就是说，这里添加的任何过滤不是必需的，" class="headerlink" title="也就是说，这里添加的任何过滤不是必需的，"></a>也就是说，这里添加的任何过滤不是必需的，</h1><h1 id="除非你想对有可能溢出隧道的数据包类型进行严格约束。"><a href="#除非你想对有可能溢出隧道的数据包类型进行严格约束。" class="headerlink" title="除非你想对有可能溢出隧道的数据包类型进行严格约束。"></a>除非你想对有可能溢出隧道的数据包类型进行严格约束。</h1><p>iptables -A INPUT -i tun+ -j ACCEPT<br>iptables -A FORWARD -i tun+ -j ACCEPT<br>iptables -A INPUT -i tap+ -j ACCEPT<br>iptables -A FORWARD -i tap+ -j ACCEPT</p>
<h1 id="允许来自内网的数据包"><a href="#允许来自内网的数据包" class="headerlink" title="允许来自内网的数据包"></a>允许来自内网的数据包</h1><p>iptables -A INPUT -i eth1 -j ACCEPT<br>iptables -A FORWARD -i eth1 -j ACCEPT</p>
<h1 id="保持来自本机和内网数据包的连接状态"><a href="#保持来自本机和内网数据包的连接状态" class="headerlink" title="保持来自本机和内网数据包的连接状态"></a>保持来自本机和内网数据包的连接状态</h1><p>iptables -A OUTPUT -m state –state NEW -o eth0 -j ACCEPT<br>iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>iptables -A FORWARD -m state –state NEW -o eth0 -j ACCEPT<br>iptables -A FORWARD -m state –state ESTABLISHED,RELATED -j ACCEPT</p>
<h1 id="伪装本地子网"><a href="#伪装本地子网" class="headerlink" title="伪装本地子网"></a>伪装本地子网</h1><p>iptables -t nat -A POSTROUTING -s $PRIVATE -o eth0 -j MASQUERADE</p>
<p>OpenVPN 在防火墙设置中提供少量的附加选项：</p>
<p>If both OpenVPN peers reference the other with an explicit –remote option, and stateful firewalls that provide UDP connection tracking (such as iptables) exist between the peers, it is possible to run OpenVPN without any explicit firewall rules, if both peers originate regular pings to each other to keep the connection alive. To do this, simply run OpenVPN with the –remote peer option, and specify –ping 15 to ensure that packets flow over the tunnel at least once every 15 seconds.<br>上面的选项在隧道一端(peer)频繁变更 IP 地址比如说DHCP或拨号时，显得不够方便。在这种情况下，以上简单的防火墙配置将允许任何IP地址通过UDP端口5000（OpenVPN 的缺省UDP端口） 流入数据包。在 OpenVPN 的安全模式下，所有流入隧道的数据或者通过安全验证或者被丢弃，所以它通常被认为是安全的。<br>如果你选择完全开放 OpenVPN 的 incoming UDP 端口就像上面简单防火墙中的配置一样，你可能会想利用 –tls-auth 选项在 TLS 控制通道上作双倍的验证，同时使用 RSA 密钥和预先分享的密码短语(passphrase)来作为防御 DoS 或 active 攻击的第二道防线。关于–tls-auth 的更多信息，参考 openvpn man page。</p>
<p>创建 RSA 证书和密钥<br>OpenVPN 有两种安全模式，一种基于使用 RSA 证书和密钥的 SSL/TLS，一种使用预先分享的静态密钥。SSL/TLS + RSA 密钥被证明是一种最安全的选择，静态密钥优势则在于简洁。如果你想使用 RSA 密钥，继续往下读。要使用静态密钥，向前跳到 创建预分享静态密钥 一节.<br>我们将使用 openssl 命令创建 RSA 证书和密钥，该命令包含在 OpenSSL 库的发布程序中。</p>
<p>RSA 证书是一种公开密钥，在其中还含有其他安全域，比如说证书持有者的 Common Name 或 email 地址。OpenVPN 有能力在进行认证前对这些域进行测试。更多信息参考 openvpn man page 中的 –tls-verify 选项。</p>
<p>在我们的例子中遵从 apache 惯例使用 .crt 扩展名表示证书文件，.key 扩展名表示私钥。私钥文件必须安全保管。证书文件可以自由发布共享。</p>
<p>选择一台机器比如 Office 作为密钥管理主机。</p>
<p>首先编辑文件 /usr/share/ssl/openssl.cnf (这个文件也许在其他地方，可以用 locate openssl.cnf 命令找到它)。</p>
<p>你或许会对它作一些修改：</p>
<p>建立一个目录作为密钥的工作目录，将 dir 指向它。<br>考虑增加有限期限 default_days 以免你的 VPN 在工作整一年后莫名其妙的终止。<br>设定 certificate 和 private_key 指向你的根证书 （master certificate authority certificate）和私钥文件（我们马上要生成它）。在下面的例子中，我们假定你的证书文件名为 my-ca.crt，你的私钥文件名为 my-ca.key 。<br>注意文件 index.txt 和 serial。将 index.txt 清空，serial 初始化为包含一个数字序列比如 01.<br>如果你狂热的追求密钥长度，那可以将 default_bits 增加到2048。 对于打开 pthread 支持（可以后台处理 RSA 密钥）的 OpenVPN 处理2048位的 RSA 密钥是毫无问题的。甚至没有打开 pthread 支持时也可以使用更长的密钥，但你会在隧道中作 SSL/TLS 密钥协商时感觉到响应时间的延迟。这里有一份选择 RSA 密钥长度的很好的文章，参见 April 2002 issue of Bruce Schneier’s Crypto-Gram Newsletter.<br>openssl.cnf 编辑完后，创建根证书/私钥对（master certificate authority certificate/private-key pair）:</p>
<p>openssl req -nodes -new -x509 -keyout my-ca.key -out my-ca.crt -days 3650<br>这将会创建一对有效期为十年的根证书/私钥对。</p>
<p>现在为 Home 和 Office 创建 证书/私钥对：</p>
<p>openssl req -nodes -new -keyout office.key -out office.csr<br>openssl ca -out office.crt -in office.csr<br>openssl req -nodes -new -keyout home.key -out home.csr<br>openssl ca -out home.crt -in home.csr<br>现在将 home.crt, home.key, 和 my-ca.crt 文件通过安全途径拷贝到 Home 机器上，尽管实际上只有.key 才被认为是应该保密的。</p>
<p>现在在 Office 机器上创建 Diffie Hellman 参数，使用下列命令：</p>
<p>openssl dhparam -out dh1024.pem 1024<br>如果在 openssl.cnf 中增大了密钥位数，相应的这里也要把 1024 改为 2048。</p>
<p>对于偏执狂可以考虑去掉上面 openssl 命令中的-nodes 选项。其结果是对每一个私钥进行口令加密，从而保证当有人攻入你的主机盗走你的私钥时仍有一定的安全性。麻烦的是每次当你使用 OpenVPN 时都需要输入口令。更多信息参考 openvpn man page 中的 –askpass 选项。</p>
<p>如果你对手工管理 RSA 密钥觉得困惑，那要指出一点 OpenVPN 可以很好的同任何 X509 证书管理工具或服务包括商业化的 CAs 如 Thawte or Verisign等协同工作。检索 OpenCA 项目可以查看有哪些同证书/密钥管理工具 配合良好的开源项目。</p>
<p>另外，OpenVPN 发布版中包含了一组脚本能够简化 RSA 证书和密钥管理。</p>
<p>在 OpenVPN 上使用商业证书(CAs)的重要提示<br>It should be noted that OpenVPN’s security model in SSL/TLS mode is oriented toward users who will generate their own root certificate, and hence be their own CA. In SSL/TLS mode, OpenVPN authenticates its peer by checking that the peer-supplied certificate was signed by the CA certificate specified in the –ca option. Like the SSL-based secure web, the security of OpenVPN’s SSL/TLS mode rests on the infeasibility of forging a root certificate signature.</p>
<p>This authentication procedure works perfectly well if you have generated your own root certificate, but presents a problem if you wish to use the root certificate of a commercial CA such as Thawte. If, for example, you specified Thawte’s root certificate in the –ca option, any certificate signed by Thawte would now be able to authenticate with your OpenVPN peer – certainly not what you would want.</p>
<p>Luckily there is a solution to this problem in the –tls-verify option. This option will allow you to execute a command to check the contents of a certificate, to fine-tune the selection of which certificate is allowed, and which is not. See the script verify-cn in the sample-scripts subdirectory for an example of how to do this, and also see the man page for the –tls-verify option.</p>
<p>使用 SSL/TLS 模式和 RSA 证书/密钥的配置文件<br>在我们的例子中，我们使用 OpenVPN 配置文件。OpenVPN 允许由命令行或一个或多个配置文件指定参数。在命令行中由”–”引导的参数在配置文件中是可以忽略”–”的，命令行中则不行。</p>
<p>设置下列配置文件：</p>
<hr>
<p>sample-config-files/tls-office.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for"><a href="#Sample-OpenVPN-configuration-file-for" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="office-using-SSL-TLS-mode-and-RSA-certificates-keys"><a href="#office-using-SSL-TLS-mode-and-RSA-certificates-keys" class="headerlink" title="office using SSL/TLS mode and RSA certificates/keys."></a>office using SSL/TLS mode and RSA certificates/keys.</h1><p>#</p>
<h1 id="‘-’-或-‘-’-用于表明注释"><a href="#‘-’-或-‘-’-用于表明注释" class="headerlink" title="‘#’ 或 ‘;’ 用于表明注释."></a>‘#’ 或 ‘;’ 用于表明注释.</h1><h1 id="使用-dynamic-tun-device"><a href="#使用-dynamic-tun-device" class="headerlink" title="使用 dynamic tun device."></a>使用 dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes"><a href="#For-Linux-2-2-or-non-Linux-OSes" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="你可以使用显式指明的设备号，比如”tun1”"><a href="#你可以使用显式指明的设备号，比如”tun1”" class="headerlink" title="你可以使用显式指明的设备号，比如”tun1”"></a>你可以使用显式指明的设备号，比如”tun1”</h1><h1 id="OpenVPN-也支持虚拟网络-“tap”-devices"><a href="#OpenVPN-也支持虚拟网络-“tap”-devices" class="headerlink" title="OpenVPN 也支持虚拟网络 “tap” devices;"></a>OpenVPN 也支持虚拟网络 “tap” devices;</h1><p>dev tun</p>
<h1 id="10-1-0-1-is-our-local-VPN-endpoint-office"><a href="#10-1-0-1-is-our-local-VPN-endpoint-office" class="headerlink" title="10.1.0.1 is our local VPN endpoint (office)."></a>10.1.0.1 is our local VPN endpoint (office).</h1><h1 id="10-1-0-2-is-our-remote-VPN-endpoint-home"><a href="#10-1-0-2-is-our-remote-VPN-endpoint-home" class="headerlink" title="10.1.0.2 is our remote VPN endpoint (home)."></a>10.1.0.2 is our remote VPN endpoint (home).</h1><p>ifconfig 10.1.0.1 10.1.0.2</p>
<h1 id="up-脚本将在-VPN-激活时建立路由"><a href="#up-脚本将在-VPN-激活时建立路由" class="headerlink" title="up 脚本将在 VPN 激活时建立路由"></a>up 脚本将在 VPN 激活时建立路由</h1><p>up ./office.up</p>
<h1 id="在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client"><a href="#在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client" class="headerlink" title="在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client"></a>在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client</h1><p>tls-server</p>
<h1 id="Diffie-Hellman-Parameters-tls-server-only"><a href="#Diffie-Hellman-Parameters-tls-server-only" class="headerlink" title="Diffie-Hellman Parameters (tls-server only)"></a>Diffie-Hellman Parameters (tls-server only)</h1><p>dh dh1024.pem</p>
<h1 id="Certificate-Authority-file"><a href="#Certificate-Authority-file" class="headerlink" title="Certificate Authority file"></a>Certificate Authority file</h1><p>ca my-ca.crt</p>
<h1 id="Our-certificate-public-key"><a href="#Our-certificate-public-key" class="headerlink" title="Our certificate/public key"></a>Our certificate/public key</h1><p>cert office.crt</p>
<h1 id="Our-private-key"><a href="#Our-private-key" class="headerlink" title="Our private key"></a>Our private key</h1><p>key office.key</p>
<h1 id="OpenVPN-缺省使用-UDP-端口-5000"><a href="#OpenVPN-缺省使用-UDP-端口-5000" class="headerlink" title="OpenVPN 缺省使用 UDP 端口 5000 ."></a>OpenVPN 缺省使用 UDP 端口 5000 .</h1><h1 id="每一个-OpenVPN-tunnel-必须使用一个不同的端口"><a href="#每一个-OpenVPN-tunnel-必须使用一个不同的端口" class="headerlink" title="每一个 OpenVPN tunnel 必须使用一个不同的端口."></a>每一个 OpenVPN tunnel 必须使用一个不同的端口.</h1><h1 id="lport-和-rport-被用于指明本地或远程的不同端口"><a href="#lport-和-rport-被用于指明本地或远程的不同端口" class="headerlink" title="lport 和 rport 被用于指明本地或远程的不同端口"></a>lport 和 rport 被用于指明本地或远程的不同端口</h1><p>; port 5000</p>
<h1 id="出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”"><a href="#出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”" class="headerlink" title="出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”"></a>出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”</h1><p>; user nobody<br>; group nobody</p>
<h1 id="如果你的OpenVPN支持LZO-压缩-去掉这一行的注释"><a href="#如果你的OpenVPN支持LZO-压缩-去掉这一行的注释" class="headerlink" title="如果你的OpenVPN支持LZO 压缩,去掉这一行的注释"></a>如果你的OpenVPN支持LZO 压缩,去掉这一行的注释</h1><p>; comp-lzo</p>
<p>#</p>
<h1 id="每15秒向远端主机发送一个-UDP-ping"><a href="#每15秒向远端主机发送一个-UDP-ping" class="headerlink" title="每15秒向远端主机发送一个 UDP ping"></a>每15秒向远端主机发送一个 UDP ping</h1><h1 id="stateful-firewall-connection"><a href="#stateful-firewall-connection" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this"><a href="#alive-Uncomment-this" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful"><a href="#out-if-you-are-using-a-stateful" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall"><a href="#firewall" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations"><a href="#travel-to-other-locations" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级"><a href="#信息细节等级" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。"><a href="#0-–-除非发生致命错误，否则保持安静。" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。"><a href="#1-–-非常安静，但会显示一些非致命网络错误。" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。"><a href="#3-–-中等输出，通常情况下的很好选择。" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。"><a href="#9-–-非常详细，用于诊断错误。" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/office.up</p>
<p>#!/bin/bash<br>route add -net 10.0.1.0 netmask 255.255.255.0 gw $5</p>
<hr>
<p>sample-config-files/tls-home.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for-1"><a href="#Sample-OpenVPN-configuration-file-for-1" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="home-using-SSL-TLS-mode-and-RSA-certificates-keys"><a href="#home-using-SSL-TLS-mode-and-RSA-certificates-keys" class="headerlink" title="home using SSL/TLS mode and RSA certificates/keys."></a>home using SSL/TLS mode and RSA certificates/keys.</h1><p>#</p>
<h1 id="‘-’-or-‘-’-may-be-used-to-delimit-comments"><a href="#‘-’-or-‘-’-may-be-used-to-delimit-comments" class="headerlink" title="‘#’ or ‘;’ may be used to delimit comments."></a>‘#’ or ‘;’ may be used to delimit comments.</h1><h1 id="Use-a-dynamic-tun-device"><a href="#Use-a-dynamic-tun-device" class="headerlink" title="Use a dynamic tun device."></a>Use a dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes-1"><a href="#For-Linux-2-2-or-non-Linux-OSes-1" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="you-may-want-to-use-an-explicit"><a href="#you-may-want-to-use-an-explicit" class="headerlink" title="you may want to use an explicit"></a>you may want to use an explicit</h1><h1 id="unit-number-such-as-“tun1”"><a href="#unit-number-such-as-“tun1”" class="headerlink" title="unit number such as “tun1”."></a>unit number such as “tun1”.</h1><h1 id="OpenVPN-also-supports-virtual"><a href="#OpenVPN-also-supports-virtual" class="headerlink" title="OpenVPN also supports virtual"></a>OpenVPN also supports virtual</h1><h1 id="ethernet-“tap”-devices"><a href="#ethernet-“tap”-devices" class="headerlink" title="ethernet “tap” devices."></a>ethernet “tap” devices.</h1><p>dev tun</p>
<h1 id="Our-OpenVPN-peer-is-the-office-gateway"><a href="#Our-OpenVPN-peer-is-the-office-gateway" class="headerlink" title="Our OpenVPN peer is the office gateway."></a>Our OpenVPN peer is the office gateway.</h1><p>remote 1.2.3.4</p>
<h1 id="10-1-0-2-is-our-local-VPN-endpoint-home"><a href="#10-1-0-2-is-our-local-VPN-endpoint-home" class="headerlink" title="10.1.0.2 is our local VPN endpoint (home)."></a>10.1.0.2 is our local VPN endpoint (home).</h1><h1 id="10-1-0-1-is-our-remote-VPN-endpoint-office"><a href="#10-1-0-1-is-our-remote-VPN-endpoint-office" class="headerlink" title="10.1.0.1 is our remote VPN endpoint (office)."></a>10.1.0.1 is our remote VPN endpoint (office).</h1><p>ifconfig 10.1.0.2 10.1.0.1</p>
<h1 id="Our-up-script-will-establish-routes"><a href="#Our-up-script-will-establish-routes" class="headerlink" title="Our up script will establish routes"></a>Our up script will establish routes</h1><h1 id="once-the-VPN-is-alive"><a href="#once-the-VPN-is-alive" class="headerlink" title="once the VPN is alive."></a>once the VPN is alive.</h1><p>up ./home.up</p>
<h1 id="在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client-1"><a href="#在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client-1" class="headerlink" title="在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client"></a>在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client</h1><p>tls-client</p>
<h1 id="Certificate-Authority-file-1"><a href="#Certificate-Authority-file-1" class="headerlink" title="Certificate Authority file"></a>Certificate Authority file</h1><p>ca my-ca.crt</p>
<h1 id="Our-certificate-public-key-1"><a href="#Our-certificate-public-key-1" class="headerlink" title="Our certificate/public key"></a>Our certificate/public key</h1><p>cert home.crt</p>
<h1 id="Our-private-key-1"><a href="#Our-private-key-1" class="headerlink" title="Our private key"></a>Our private key</h1><p>key home.key</p>
<h1 id="OpenVPN-缺省使用-UDP-端口-5000-1"><a href="#OpenVPN-缺省使用-UDP-端口-5000-1" class="headerlink" title="OpenVPN 缺省使用 UDP 端口 5000 ."></a>OpenVPN 缺省使用 UDP 端口 5000 .</h1><h1 id="每一个-OpenVPN-tunnel-必须使用一个不同的端口-1"><a href="#每一个-OpenVPN-tunnel-必须使用一个不同的端口-1" class="headerlink" title="每一个 OpenVPN tunnel 必须使用一个不同的端口."></a>每一个 OpenVPN tunnel 必须使用一个不同的端口.</h1><h1 id="lport-和-rport-被用于指明本地或远程的不同端口-1"><a href="#lport-和-rport-被用于指明本地或远程的不同端口-1" class="headerlink" title="lport 和 rport 被用于指明本地或远程的不同端口"></a>lport 和 rport 被用于指明本地或远程的不同端口</h1><p>; port 5000</p>
<h1 id="出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”-1"><a href="#出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”-1" class="headerlink" title="出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”"></a>出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”</h1><p>; user nobody<br>; group nobody</p>
<h1 id="如果你的OpenVPN支持LZO-压缩-去掉这一行的注释-1"><a href="#如果你的OpenVPN支持LZO-压缩-去掉这一行的注释-1" class="headerlink" title="如果你的OpenVPN支持LZO 压缩,去掉这一行的注释"></a>如果你的OpenVPN支持LZO 压缩,去掉这一行的注释</h1><p>; comp-lzo</p>
<h1 id="每15秒向远端主机发送一个-UDP-ping-1"><a href="#每15秒向远端主机发送一个-UDP-ping-1" class="headerlink" title="每15秒向远端主机发送一个 UDP ping"></a>每15秒向远端主机发送一个 UDP ping</h1><h1 id="stateful-firewall-connection-1"><a href="#stateful-firewall-connection-1" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this-1"><a href="#alive-Uncomment-this-1" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful-1"><a href="#out-if-you-are-using-a-stateful-1" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall-1"><a href="#firewall-1" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system-1"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-1" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that-1"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that-1" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations-1"><a href="#travel-to-other-locations-1" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级-1"><a href="#信息细节等级-1" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。-1"><a href="#0-–-除非发生致命错误，否则保持安静。-1" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。-1"><a href="#1-–-非常安静，但会显示一些非致命网络错误。-1" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。-1"><a href="#3-–-中等输出，通常情况下的很好选择。-1" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。-1"><a href="#9-–-非常详细，用于诊断错误。-1" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/home.up</p>
<p>#!/bin/bash<br>route add -net 10.0.0.0 netmask 255.255.255.0 gw $5</p>
<p>创建一个预分享静态密钥(Pre-Shared Static Key)<br>同 RSA 密钥管理极为不同的是，使用预分享静态密钥是十分简单。The major downside of using static keys is that you give up the notion of perfect forward secrecy, meaning that if an attacker steals your static key, everything that was ever encrypted with it is compromised.</p>
<p>使用如下命令生成静态密钥：</p>
<p>openvpn –genkey –secret static.key<br>静态密钥文件由ascii组成，就像下面这样：</p>
<p>—–BEGIN OpenVPN Static key V1—–<br>e5e4d6af39289d53<br>171ecc237a8f996a<br>97743d146661405e<br>c724d5913c550a0c<br>30a48e52dfbeceb6<br>e2e7bd4a8357df78<br>4609fe35bbe99c32<br>bdf974952ade8fb9<br>71c204aaf4f256ba<br>eeda7aed4822ff98<br>fd66da2efa9bf8c5<br>e70996353e0f96a9<br>c94c9f9afb17637b<br>283da25cc99b37bf<br>6f7e15b38aedc3e8<br>e6adb40fca5c5463<br>—–END OpenVPN Static key V1—–</p>
<p>一个 OpenVPN 静态密钥包含有足够的熵值，其中512位作为加密键，512位作为身份验证的 HMAC。（An OpenVPN static key file contains enough entropy to key both a 512 bit cipher key and a 512 bit HMAC key for authentication.）</p>
<p>通过安全的媒介将 static.key 拷贝到另一端(peer)，比如使用scp 或 ssh 中的拷贝、粘贴。</p>
<p>使用预共享静态密钥(Pre-Shared Static Key)的配置文件<br>在我们的例子中，我们使用 OpenVPN 配置文件。OpenVPN 允许由命令行或一个或多个配置文件指定参数。在命令行中由”–”引导的参数在配置文件中是可以忽略”–”的，命令行中则不行。</p>
<p>Set up the following configuration files:</p>
<hr>
<p>sample-config-files/static-office.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for-2"><a href="#Sample-OpenVPN-configuration-file-for-2" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="office-using-a-pre-shared-static-key"><a href="#office-using-a-pre-shared-static-key" class="headerlink" title="office using a pre-shared static key."></a>office using a pre-shared static key.</h1><p>#</p>
<h1 id="‘-’-or-‘-’-may-be-used-to-delimit-comments-1"><a href="#‘-’-or-‘-’-may-be-used-to-delimit-comments-1" class="headerlink" title="‘#’ or ‘;’ may be used to delimit comments."></a>‘#’ or ‘;’ may be used to delimit comments.</h1><h1 id="Use-a-dynamic-tun-device-1"><a href="#Use-a-dynamic-tun-device-1" class="headerlink" title="Use a dynamic tun device."></a>Use a dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes-2"><a href="#For-Linux-2-2-or-non-Linux-OSes-2" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="you-may-want-to-use-an-explicit-1"><a href="#you-may-want-to-use-an-explicit-1" class="headerlink" title="you may want to use an explicit"></a>you may want to use an explicit</h1><h1 id="unit-number-such-as-“tun1”-1"><a href="#unit-number-such-as-“tun1”-1" class="headerlink" title="unit number such as “tun1”."></a>unit number such as “tun1”.</h1><h1 id="OpenVPN-also-supports-virtual-1"><a href="#OpenVPN-also-supports-virtual-1" class="headerlink" title="OpenVPN also supports virtual"></a>OpenVPN also supports virtual</h1><h1 id="ethernet-“tap”-devices-1"><a href="#ethernet-“tap”-devices-1" class="headerlink" title="ethernet “tap” devices."></a>ethernet “tap” devices.</h1><p>dev tun</p>
<h1 id="10-1-0-1-is-our-local-VPN-endpoint-office-1"><a href="#10-1-0-1-is-our-local-VPN-endpoint-office-1" class="headerlink" title="10.1.0.1 is our local VPN endpoint (office)."></a>10.1.0.1 is our local VPN endpoint (office).</h1><h1 id="10-1-0-2-is-our-remote-VPN-endpoint-home-1"><a href="#10-1-0-2-is-our-remote-VPN-endpoint-home-1" class="headerlink" title="10.1.0.2 is our remote VPN endpoint (home)."></a>10.1.0.2 is our remote VPN endpoint (home).</h1><p>ifconfig 10.1.0.1 10.1.0.2</p>
<h1 id="Our-up-script-will-establish-routes-1"><a href="#Our-up-script-will-establish-routes-1" class="headerlink" title="Our up script will establish routes"></a>Our up script will establish routes</h1><h1 id="once-the-VPN-is-alive-1"><a href="#once-the-VPN-is-alive-1" class="headerlink" title="once the VPN is alive."></a>once the VPN is alive.</h1><p>up ./office.up</p>
<h1 id="Our-pre-shared-static-key"><a href="#Our-pre-shared-static-key" class="headerlink" title="Our pre-shared static key"></a>Our pre-shared static key</h1><p>secret static.key</p>
<h1 id="OpenVPN-uses-UDP-port-5000-by-default"><a href="#OpenVPN-uses-UDP-port-5000-by-default" class="headerlink" title="OpenVPN uses UDP port 5000 by default."></a>OpenVPN uses UDP port 5000 by default.</h1><h1 id="Each-OpenVPN-tunnel-must-use"><a href="#Each-OpenVPN-tunnel-must-use" class="headerlink" title="Each OpenVPN tunnel must use"></a>Each OpenVPN tunnel must use</h1><h1 id="a-different-port-number"><a href="#a-different-port-number" class="headerlink" title="a different port number."></a>a different port number.</h1><h1 id="lport-or-rport-can-be-used"><a href="#lport-or-rport-can-be-used" class="headerlink" title="lport or rport can be used"></a>lport or rport can be used</h1><h1 id="to-denote-different-ports"><a href="#to-denote-different-ports" class="headerlink" title="to denote different ports"></a>to denote different ports</h1><h1 id="for-local-and-remote"><a href="#for-local-and-remote" class="headerlink" title="for local and remote."></a>for local and remote.</h1><p>; port 5000</p>
<h1 id="Downgrade-UID-and-GID-to"><a href="#Downgrade-UID-and-GID-to" class="headerlink" title="Downgrade UID and GID to"></a>Downgrade UID and GID to</h1><h1 id="“nobody”-after-initialization"><a href="#“nobody”-after-initialization" class="headerlink" title="“nobody” after initialization"></a>“nobody” after initialization</h1><h1 id="for-extra-security"><a href="#for-extra-security" class="headerlink" title="for extra security."></a>for extra security.</h1><p>; user nobody<br>; group nobody</p>
<h1 id="If-you-built-OpenVPN-with"><a href="#If-you-built-OpenVPN-with" class="headerlink" title="If you built OpenVPN with"></a>If you built OpenVPN with</h1><h1 id="LZO-compression-uncomment"><a href="#LZO-compression-uncomment" class="headerlink" title="LZO compression, uncomment"></a>LZO compression, uncomment</h1><h1 id="out-the-following-line"><a href="#out-the-following-line" class="headerlink" title="out the following line."></a>out the following line.</h1><p>; comp-lzo</p>
<h1 id="Send-a-UDP-ping-to-remote-once"><a href="#Send-a-UDP-ping-to-remote-once" class="headerlink" title="Send a UDP ping to remote once"></a>Send a UDP ping to remote once</h1><h1 id="every-15-seconds-to-keep"><a href="#every-15-seconds-to-keep" class="headerlink" title="every 15 seconds to keep"></a>every 15 seconds to keep</h1><h1 id="stateful-firewall-connection-2"><a href="#stateful-firewall-connection-2" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this-2"><a href="#alive-Uncomment-this-2" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful-2"><a href="#out-if-you-are-using-a-stateful-2" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall-2"><a href="#firewall-2" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system-2"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-2" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that-2"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that-2" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations-2"><a href="#travel-to-other-locations-2" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级-2"><a href="#信息细节等级-2" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。-2"><a href="#0-–-除非发生致命错误，否则保持安静。-2" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。-2"><a href="#1-–-非常安静，但会显示一些非致命网络错误。-2" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。-2"><a href="#3-–-中等输出，通常情况下的很好选择。-2" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。-2"><a href="#9-–-非常详细，用于诊断错误。-2" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/office.up</p>
<p>#!/bin/bash<br>route add -net 10.0.1.0 netmask 255.255.255.0 gw $5</p>
<hr>
<p>sample-config-files/static-home.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for-3"><a href="#Sample-OpenVPN-configuration-file-for-3" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="home-using-a-pre-shared-static-key"><a href="#home-using-a-pre-shared-static-key" class="headerlink" title="home using a pre-shared static key."></a>home using a pre-shared static key.</h1><p>#</p>
<h1 id="‘-’-or-‘-’-may-be-used-to-delimit-comments-2"><a href="#‘-’-or-‘-’-may-be-used-to-delimit-comments-2" class="headerlink" title="‘#’ or ‘;’ may be used to delimit comments."></a>‘#’ or ‘;’ may be used to delimit comments.</h1><h1 id="Use-a-dynamic-tun-device-2"><a href="#Use-a-dynamic-tun-device-2" class="headerlink" title="Use a dynamic tun device."></a>Use a dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes-3"><a href="#For-Linux-2-2-or-non-Linux-OSes-3" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="you-may-want-to-use-an-explicit-2"><a href="#you-may-want-to-use-an-explicit-2" class="headerlink" title="you may want to use an explicit"></a>you may want to use an explicit</h1><h1 id="unit-number-such-as-“tun1”-2"><a href="#unit-number-such-as-“tun1”-2" class="headerlink" title="unit number such as “tun1”."></a>unit number such as “tun1”.</h1><h1 id="OpenVPN-also-supports-virtual-2"><a href="#OpenVPN-also-supports-virtual-2" class="headerlink" title="OpenVPN also supports virtual"></a>OpenVPN also supports virtual</h1><h1 id="ethernet-“tap”-devices-2"><a href="#ethernet-“tap”-devices-2" class="headerlink" title="ethernet “tap” devices."></a>ethernet “tap” devices.</h1><p>dev tun</p>
<h1 id="Our-OpenVPN-peer-is-the-office-gateway-1"><a href="#Our-OpenVPN-peer-is-the-office-gateway-1" class="headerlink" title="Our OpenVPN peer is the office gateway."></a>Our OpenVPN peer is the office gateway.</h1><p>remote 1.2.3.4</p>
<h1 id="10-1-0-2-is-our-local-VPN-endpoint-home-1"><a href="#10-1-0-2-is-our-local-VPN-endpoint-home-1" class="headerlink" title="10.1.0.2 is our local VPN endpoint (home)."></a>10.1.0.2 is our local VPN endpoint (home).</h1><h1 id="10-1-0-1-is-our-remote-VPN-endpoint-office-1"><a href="#10-1-0-1-is-our-remote-VPN-endpoint-office-1" class="headerlink" title="10.1.0.1 is our remote VPN endpoint (office)."></a>10.1.0.1 is our remote VPN endpoint (office).</h1><p>ifconfig 10.1.0.2 10.1.0.1</p>
<h1 id="Our-up-script-will-establish-routes-2"><a href="#Our-up-script-will-establish-routes-2" class="headerlink" title="Our up script will establish routes"></a>Our up script will establish routes</h1><h1 id="once-the-VPN-is-alive-2"><a href="#once-the-VPN-is-alive-2" class="headerlink" title="once the VPN is alive."></a>once the VPN is alive.</h1><p>up ./home.up</p>
<h1 id="Our-pre-shared-static-key-1"><a href="#Our-pre-shared-static-key-1" class="headerlink" title="Our pre-shared static key"></a>Our pre-shared static key</h1><p>secret static.key</p>
<h1 id="OpenVPN-uses-UDP-port-5000-by-default-1"><a href="#OpenVPN-uses-UDP-port-5000-by-default-1" class="headerlink" title="OpenVPN uses UDP port 5000 by default."></a>OpenVPN uses UDP port 5000 by default.</h1><h1 id="Each-OpenVPN-tunnel-must-use-1"><a href="#Each-OpenVPN-tunnel-must-use-1" class="headerlink" title="Each OpenVPN tunnel must use"></a>Each OpenVPN tunnel must use</h1><h1 id="a-different-port-number-1"><a href="#a-different-port-number-1" class="headerlink" title="a different port number."></a>a different port number.</h1><h1 id="lport-or-rport-can-be-used-1"><a href="#lport-or-rport-can-be-used-1" class="headerlink" title="lport or rport can be used"></a>lport or rport can be used</h1><h1 id="to-denote-different-ports-1"><a href="#to-denote-different-ports-1" class="headerlink" title="to denote different ports"></a>to denote different ports</h1><h1 id="for-local-and-remote-1"><a href="#for-local-and-remote-1" class="headerlink" title="for local and remote."></a>for local and remote.</h1><p>; port 5000</p>
<h1 id="Downgrade-UID-and-GID-to-1"><a href="#Downgrade-UID-and-GID-to-1" class="headerlink" title="Downgrade UID and GID to"></a>Downgrade UID and GID to</h1><h1 id="“nobody”-after-initialization-1"><a href="#“nobody”-after-initialization-1" class="headerlink" title="“nobody” after initialization"></a>“nobody” after initialization</h1><h1 id="for-extra-security-1"><a href="#for-extra-security-1" class="headerlink" title="for extra security."></a>for extra security.</h1><p>; user nobody<br>; group nobody</p>
<h1 id="If-you-built-OpenVPN-with-1"><a href="#If-you-built-OpenVPN-with-1" class="headerlink" title="If you built OpenVPN with"></a>If you built OpenVPN with</h1><h1 id="LZO-compression-uncomment-1"><a href="#LZO-compression-uncomment-1" class="headerlink" title="LZO compression, uncomment"></a>LZO compression, uncomment</h1><h1 id="out-the-following-line-1"><a href="#out-the-following-line-1" class="headerlink" title="out the following line."></a>out the following line.</h1><p>; comp-lzo</p>
<h1 id="Send-a-UDP-ping-to-remote-once-1"><a href="#Send-a-UDP-ping-to-remote-once-1" class="headerlink" title="Send a UDP ping to remote once"></a>Send a UDP ping to remote once</h1><h1 id="every-15-seconds-to-keep-1"><a href="#every-15-seconds-to-keep-1" class="headerlink" title="every 15 seconds to keep"></a>every 15 seconds to keep</h1><h1 id="stateful-firewall-connection-3"><a href="#stateful-firewall-connection-3" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this-3"><a href="#alive-Uncomment-this-3" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful-3"><a href="#out-if-you-are-using-a-stateful-3" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall-3"><a href="#firewall-3" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system-3"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-3" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that-3"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that-3" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations-3"><a href="#travel-to-other-locations-3" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级-3"><a href="#信息细节等级-3" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。-3"><a href="#0-–-除非发生致命错误，否则保持安静。-3" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。-3"><a href="#1-–-非常安静，但会显示一些非致命网络错误。-3" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。-3"><a href="#3-–-中等输出，通常情况下的很好选择。-3" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。-3"><a href="#9-–-非常详细，用于诊断错误。-3" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/home.up</p>
<p>#!/bin/bash<br>route add -net 10.0.0.0 netmask 255.255.255.0 gw $5</p>
<p>在 SSL/TLS mode 下启动 VPN<br>Home 机器端，用如下命令启动 VPN ：</p>
<p>openvpn –config tls-home.conf<br>Office 端，用如下命令启动 VPN ：</p>
<p>openvpn –config tls-office.conf</p>
<p>在静态密钥模式(Static Key mode)下启动 VPN<br>Home 机器端，用如下命令启动 VPN ：</p>
<p>openvpn –config static-home.conf<br>Office 端，用如下命令启动 VPN ：</p>
<p>openvpn –config static-office.conf</p>
<p>测试 VPN<br>在 Home 机器上，可以通过 ping Office 主机（经过隧道）来测试 VPN：</p>
<p>ping 10.1.0.1<br>在 Office 机器上，可以通过 ping Home 主机（经过隧道）来测试 VPN：</p>
<p>ping 10.1.0.2<br>如果测试失败但无输出信息，可以编辑配置文件将 信息细节等级 调为8（将产生大量细节信息用于调试）。参考FAQ 获取更多错误处理信息。</p>
<p>如果测试通过，可以尝试经过隧道 ping 另一端子网中的机器（网关机器除外）来测试路由。基本上 10.0.1.0/24 子网中的任一机器可以访问 10.0.1.0/24 子网中的任意机器，反之亦然。</p>
<p>如果工作正常，恭喜你！如果不正常，你可以查看邮件列表 OpenVPN Mailing List 有没有相似问题。如果问题依旧，可以考虑贴到 openvpn-users 列表。</p>
<p>Make the VPN DHCP-aware<br>回想一下，在我们的网络配置中，Home是使用动态 IP，地址可以任意的变化。如果你的客户端(client daemon)使用 dhcpcd ，那写一个适应IP地址任意变化的脚本也是很容易的。这个脚本或许被命名为 /etc/dhcpc/dhcpcd-eth0.exe.</p>
<p>基本上你要作的就是将下面这一行加入脚本，其作用是向 OpenVPn daemon 发送一个SIGUSR1 或 SIGHUP 信号：</p>
<p>killall -HUP openvpn<br>当 OpenVPN 收到这个信号后会关闭连接随后再使用DHCP获取的新的IP重新与对端连接。</p>
<p>如果你连接的对端由于 DHCP 重置而改变IP地址，你也许会考虑使用 –float 选项。</p>
<p>DHCP 重置时也有可能是 SIGUSR1 起作用，相比SIGHUP 它会在OpenVPN子系统重置时提供更多的进程回收控制。–ping 和 –ping-restart 也会内在的产生SIGUSR1信号。</p>
<p>–persist-tun 选项实现重置时不需关闭重新打开 TUN 设备（这就为在DHCP上的隧道提供了一种无缝连接）。</p>
<p>–persist-remote-ip 选项实现在DHCP重置时会保留远端 IP 地址。这样就允许 OpenVPN 隧道的两端都可以为DHCP client。</p>
<p>–persist-key 选项实现在重启时不用重新读取密钥文件（这样就允许 OpenVPN daemon 在权限降为 –user 或 –group 时也能实现重启）。</p>
<p>在 动态IP 环境下使用 OpenVPN的 更多信息，可参考FAQ 。</p>
<p>OpenVPN 也能在如下环境使用:连接两端都为动态地址。</p>
<p>系统重启时自动启动 VPN<br>首先建立一个目录存放OpenVPN密钥和配置文件,如： /etc/openvpn.</p>
<p>选择使用TLS模式或静态密钥模式 ，将适当的 .conf, .up, .key, .pem, 和 .crt 文件拷入 目录/etc/openvpn.</p>
<p>保护你的 .key 文件：</p>
<p>chmod go-rwx /etc/openvpn/*.key<br>如果使用 Linux iptables，编辑防火墙配置文件 firewall.sh，将相应的变动拷入目录 /etc/openvpn.</p>
<p>创建类似如下的 startup 脚本：</p>
<hr>
<p>sample-config-files/openvpn-startup.sh</p>
<p>#!/bin/bash</p>
<h1 id="A-sample-OpenVPN-startup-script"><a href="#A-sample-OpenVPN-startup-script" class="headerlink" title="A sample OpenVPN startup script"></a>A sample OpenVPN startup script</h1><h1 id="for-Linux"><a href="#for-Linux" class="headerlink" title="for Linux."></a>for Linux.</h1><h1 id="openvpn-config-file-directory"><a href="#openvpn-config-file-directory" class="headerlink" title="openvpn config file directory"></a>openvpn config file directory</h1><p>dir=/etc/openvpn</p>
<h1 id="载入防火墙"><a href="#载入防火墙" class="headerlink" title="载入防火墙"></a>载入防火墙</h1><p>$dir/firewall.sh</p>
<h1 id="载入-TUN-TAP-kernel-module"><a href="#载入-TUN-TAP-kernel-module" class="headerlink" title="载入 TUN/TAP kernel module"></a>载入 TUN/TAP kernel module</h1><p>modprobe tun</p>
<h1 id="开启IP转发"><a href="#开启IP转发" class="headerlink" title="开启IP转发"></a>开启IP转发</h1><p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<h1 id="为每一个VPN隧道唤醒一个守护-daemon-模式的openvpn"><a href="#为每一个VPN隧道唤醒一个守护-daemon-模式的openvpn" class="headerlink" title="为每一个VPN隧道唤醒一个守护(daemon)模式的openvpn"></a>为每一个VPN隧道唤醒一个守护(daemon)模式的openvpn</h1><h1 id="Invoke-openvpn-for-each-VPN-tunnel"><a href="#Invoke-openvpn-for-each-VPN-tunnel" class="headerlink" title="Invoke openvpn for each VPN tunnel"></a>Invoke openvpn for each VPN tunnel</h1><h1 id="in-daemon-mode-Alternatively"><a href="#in-daemon-mode-Alternatively" class="headerlink" title="in daemon mode.  Alternatively,"></a>in daemon mode.  Alternatively,</h1><h1 id="you-could-remove-“–daemon”-from"><a href="#you-could-remove-“–daemon”-from" class="headerlink" title="you could remove “–daemon” from"></a>you could remove “–daemon” from</h1><h1 id="the-command-line-and-add-“daemon”"><a href="#the-command-line-and-add-“daemon”" class="headerlink" title="the command line and add “daemon”"></a>the command line and add “daemon”</h1><h1 id="to-the-config-file"><a href="#to-the-config-file" class="headerlink" title="to the config file."></a>to the config file.</h1><p>#</p>
<h1 id="Each-tunnel-should-run-on-a-separate"><a href="#Each-tunnel-should-run-on-a-separate" class="headerlink" title="Each tunnel should run on a separate"></a>Each tunnel should run on a separate</h1><h1 id="UDP-port-Use-the-“port”-option"><a href="#UDP-port-Use-the-“port”-option" class="headerlink" title="UDP port.  Use the “port” option"></a>UDP port.  Use the “port” option</h1><h1 id="to-control-this-Like-all-of"><a href="#to-control-this-Like-all-of" class="headerlink" title="to control this.  Like all of"></a>to control this.  Like all of</h1><h1 id="OpenVPN’s-options-you-can"><a href="#OpenVPN’s-options-you-can" class="headerlink" title="OpenVPN’s options, you can"></a>OpenVPN’s options, you can</h1><h1 id="specify-“–port-8000”-on-the-command"><a href="#specify-“–port-8000”-on-the-command" class="headerlink" title="specify “–port 8000” on the command"></a>specify “–port 8000” on the command</h1><h1 id="line-or-“port-8000”-in-the-config"><a href="#line-or-“port-8000”-in-the-config" class="headerlink" title="line or “port 8000” in the config"></a>line or “port 8000” in the config</h1><h1 id="file"><a href="#file" class="headerlink" title="file."></a>file.</h1><p>openvpn –cd $dir –daemon –config vpn1.conf<br>openvpn –cd $dir –daemon –config vpn2.conf<br>openvpn –cd $dir –daemon –config vpn2.conf</p>
<p>创建类似如下的 shutdown 脚本：</p>
<hr>
<p>sample-config-files/openvpn-shutdown.sh</p>
<p>#!/bin/bash</p>
<h1 id="stop-all-openvpn-processes"><a href="#stop-all-openvpn-processes" class="headerlink" title="stop all openvpn processes"></a>stop all openvpn processes</h1><p>killall -TERM openvpn</p>
<p>最后将 openvpn-startup.sh 和 openvpn-shutdown.sh 脚本添加到系统的 startup 和shutdown 脚本中 或拷贝到 /etc/init.d 目录.</p>
<p>管理多条 OpenVPN 隧道的 startup 和 shutdown<br>这里是一个/etc/init.d 下的脚本例子，它自动为 /etc/openvpn 下的每一个.conf 文件创建一条 OpenVPN 隧道。</p>
<p>该脚本在通过 RPM 安装 OpenVPN 时会缺省安装到机器上。</p>
<hr>
<p>sample-scripts/openvpn.init</p>
<p>#!/bin/sh<br>#</p>
<h1 id="openvpn-This-shell-script-takes-care-of-starting-and-stopping"><a href="#openvpn-This-shell-script-takes-care-of-starting-and-stopping" class="headerlink" title="openvpn       This shell script takes care of starting and stopping"></a>openvpn       This shell script takes care of starting and stopping</h1><h1 id="openvpn-on-RedHat-or-other-chkconfig-based-system"><a href="#openvpn-on-RedHat-or-other-chkconfig-based-system" class="headerlink" title="openvpn on RedHat or other chkconfig-based system."></a>openvpn on RedHat or other chkconfig-based system.</h1><p>#</p>
<h1 id="chkconfig-345-80-30"><a href="#chkconfig-345-80-30" class="headerlink" title="chkconfig: 345 80 30"></a>chkconfig: 345 80 30</h1><p>#</p>
<h1 id="描述-OpenVPN-is-a-robust-and-highly-flexible-tunneling-application-that"><a href="#描述-OpenVPN-is-a-robust-and-highly-flexible-tunneling-application-that" class="headerlink" title="描述:         OpenVPN is a robust and highly flexible tunneling application that"></a>描述:         OpenVPN is a robust and highly flexible tunneling application that</h1><h1 id="uses-all-of-the-encryption-authentication-and-certification-features"><a href="#uses-all-of-the-encryption-authentication-and-certification-features" class="headerlink" title="uses all of the encryption, authentication, and certification features"></a>uses all of the encryption, authentication, and certification features</h1><h1 id="of-the-OpenSSL-library-to-securely-tunnel-IP-networks-over-a-single"><a href="#of-the-OpenSSL-library-to-securely-tunnel-IP-networks-over-a-single" class="headerlink" title="of the OpenSSL library to securely tunnel IP networks over a single"></a>of the OpenSSL library to securely tunnel IP networks over a single</h1><h1 id="UDP-port"><a href="#UDP-port" class="headerlink" title="UDP port."></a>UDP port.</h1><p>#</p>
<h1 id="Contributed-to-the-OpenVPN-project-by"><a href="#Contributed-to-the-OpenVPN-project-by" class="headerlink" title="Contributed to the OpenVPN project by"></a>Contributed to the OpenVPN project by</h1><h1 id="Douglas-Keller"><a href="#Douglas-Keller" class="headerlink" title="Douglas Keller"></a>Douglas Keller</h1><h1 id="2002-05-15"><a href="#2002-05-15" class="headerlink" title="2002.05.15"></a>2002.05.15</h1><h1 id="安装此脚本"><a href="#安装此脚本" class="headerlink" title="安装此脚本:"></a>安装此脚本:</h1><h1 id="将这个文件拷贝到-etc-rc-d-init-d-openvpn"><a href="#将这个文件拷贝到-etc-rc-d-init-d-openvpn" class="headerlink" title="将这个文件拷贝到 /etc/rc.d/init.d/openvpn"></a>将这个文件拷贝到 /etc/rc.d/init.d/openvpn</h1><h1 id="shell-gt-chkconfig-–add-openvpn"><a href="#shell-gt-chkconfig-–add-openvpn" class="headerlink" title="shell&gt; chkconfig –add openvpn"></a>shell&gt; chkconfig –add openvpn</h1><h1 id="shell-gt-mkdir-etc-openvpn"><a href="#shell-gt-mkdir-etc-openvpn" class="headerlink" title="shell&gt; mkdir /etc/openvpn"></a>shell&gt; mkdir /etc/openvpn</h1><h1 id="make-conf-or-sh-files-in-etc-openvpn-see-below"><a href="#make-conf-or-sh-files-in-etc-openvpn-see-below" class="headerlink" title="make .conf or .sh files in /etc/openvpn (see below)"></a>make .conf or .sh files in /etc/openvpn (see below)</h1><h1 id="删除此脚本"><a href="#删除此脚本" class="headerlink" title="删除此脚本:"></a>删除此脚本:</h1><h1 id="运行-chkconfig-–del-openvpn"><a href="#运行-chkconfig-–del-openvpn" class="headerlink" title="运行: chkconfig –del openvpn"></a>运行: chkconfig –del openvpn</h1><h1 id="作者提示"><a href="#作者提示" class="headerlink" title="作者提示:"></a>作者提示:</h1><p>#</p>
<h1 id="我已经写了一个-etc-init-d-初始化脚本并修改了-openvpn-spec-可以自动注册该脚本。"><a href="#我已经写了一个-etc-init-d-初始化脚本并修改了-openvpn-spec-可以自动注册该脚本。" class="headerlink" title="我已经写了一个 /etc/init.d 初始化脚本并修改了 openvpn.spec 可以自动注册该脚本。"></a>我已经写了一个 /etc/init.d 初始化脚本并修改了 openvpn.spec 可以自动注册该脚本。</h1><h1 id="RPM-包装好后你可以直接使用-“service-openvpn-start”-和-“service-openvpn-stop”"><a href="#RPM-包装好后你可以直接使用-“service-openvpn-start”-和-“service-openvpn-stop”" class="headerlink" title="RPM 包装好后你可以直接使用 “service openvpn start” 和 “service openvpn stop”."></a>RPM 包装好后你可以直接使用 “service openvpn start” 和 “service openvpn stop”.</h1><h1 id="命令启动和终止-OpenVPN"><a href="#命令启动和终止-OpenVPN" class="headerlink" title="命令启动和终止 OpenVPN."></a>命令启动和终止 OpenVPN.</h1><p>#</p>
<h1 id="初始化脚本工作如下："><a href="#初始化脚本工作如下：" class="headerlink" title="初始化脚本工作如下："></a>初始化脚本工作如下：</h1><p>#</p>
<h1 id="为它在-etc-openvpn下找到的每一个-conf-文件启动一个-openvpn-进程"><a href="#为它在-etc-openvpn下找到的每一个-conf-文件启动一个-openvpn-进程" class="headerlink" title="- 为它在/etc/openvpn下找到的每一个 .conf 文件启动一个 openvpn 进程"></a>- 为它在/etc/openvpn下找到的每一个 .conf 文件启动一个 openvpn 进程</h1><p>#</p>
<h1 id="如果存在对应于-xxx-conf-的-etc-openvpn-xxx-sh-文件，"><a href="#如果存在对应于-xxx-conf-的-etc-openvpn-xxx-sh-文件，" class="headerlink" title="- 如果存在对应于 xxx.conf 的 /etc/openvpn/xxx.sh 文件，"></a>- 如果存在对应于 xxx.conf 的 /etc/openvpn/xxx.sh 文件，</h1><h1 id="那么在它启动-openvpn-前执行它-作-openvpn-–mktun…-时很有用-。"><a href="#那么在它启动-openvpn-前执行它-作-openvpn-–mktun…-时很有用-。" class="headerlink" title="那么在它启动 openvpn 前执行它(作 openvpn –mktun… 时很有用)。"></a>那么在它启动 openvpn 前执行它(作 openvpn –mktun… 时很有用)。</h1><p>#</p>
<h1 id="除-start-stop-外还可以执行："><a href="#除-start-stop-外还可以执行：" class="headerlink" title="- 除 start/stop 外还可以执行："></a>- 除 start/stop 外还可以执行：</h1><p>#</p>
<h1 id="service-openvpn-reload-SIGHUP"><a href="#service-openvpn-reload-SIGHUP" class="headerlink" title="service openvpn reload - SIGHUP"></a>service openvpn reload - SIGHUP</h1><h1 id="service-openvpn-reopen-SIGUSR1"><a href="#service-openvpn-reopen-SIGUSR1" class="headerlink" title="service openvpn reopen - SIGUSR1"></a>service openvpn reopen - SIGUSR1</h1><h1 id="service-openvpn-status-SIGUSR2"><a href="#service-openvpn-status-SIGUSR2" class="headerlink" title="service openvpn status - SIGUSR2"></a>service openvpn status - SIGUSR2</h1><h1 id="Modifications-2003-05-02"><a href="#Modifications-2003-05-02" class="headerlink" title="Modifications 2003.05.02"></a>Modifications 2003.05.02</h1><h1 id="Changed-to-for-sh-compliance-Bishop-Clark"><a href="#Changed-to-for-sh-compliance-Bishop-Clark" class="headerlink" title="* Changed == to = for sh compliance (Bishop Clark)."></a>* Changed == to = for sh compliance (Bishop Clark).</h1><h1 id="If-condrestart-reload-reopen-status-check-that-we-were"><a href="#If-condrestart-reload-reopen-status-check-that-we-were" class="headerlink" title="* If condrestart|reload|reopen|status, check that we were"></a>* If condrestart|reload|reopen|status, check that we were</h1><h1 id="actually-started-James-Yonan"><a href="#actually-started-James-Yonan" class="headerlink" title="actually started (James Yonan)."></a>actually started (James Yonan).</h1><h1 id="Added-lock-piddir-and-work-variables-James-Yonan"><a href="#Added-lock-piddir-and-work-variables-James-Yonan" class="headerlink" title="* Added lock, piddir, and work variables (James Yonan)."></a>* Added lock, piddir, and work variables (James Yonan).</h1><h1 id="If-start-is-attempted-twice-without-an-intervening-stop-or"><a href="#If-start-is-attempted-twice-without-an-intervening-stop-or" class="headerlink" title="* If start is attempted twice, without an intervening stop, or"></a>* If start is attempted twice, without an intervening stop, or</h1><h1 id="if-start-is-attempted-when-previous-start-was-not-properly"><a href="#if-start-is-attempted-when-previous-start-was-not-properly" class="headerlink" title="if start is attempted when previous start was not properly"></a>if start is attempted when previous start was not properly</h1><h1 id="shut-down-then-kill-any-previously-started-processes-before"><a href="#shut-down-then-kill-any-previously-started-processes-before" class="headerlink" title="shut down, then kill any previously started processes, before"></a>shut down, then kill any previously started processes, before</h1><h1 id="commencing-new-start-operation-James-Yonan"><a href="#commencing-new-start-operation-James-Yonan" class="headerlink" title="commencing new start operation (James Yonan)."></a>commencing new start operation (James Yonan).</h1><h1 id="Do-a-better-job-of-flagging-errors-on-start-and-properly"><a href="#Do-a-better-job-of-flagging-errors-on-start-and-properly" class="headerlink" title="* Do a better job of flagging errors on start, and properly"></a>* Do a better job of flagging errors on start, and properly</h1><h1 id="returning-success-or-failure-status-to-caller-James-Yonan"><a href="#returning-success-or-failure-status-to-caller-James-Yonan" class="headerlink" title="returning success or failure status to caller (James Yonan)."></a>returning success or failure status to caller (James Yonan).</h1><h1 id="Location-of-openvpn-binary"><a href="#Location-of-openvpn-binary" class="headerlink" title="Location of openvpn binary"></a>Location of openvpn binary</h1><p>openvpn=”/usr/sbin/openvpn”</p>
<h1 id="Lockfile"><a href="#Lockfile" class="headerlink" title="Lockfile"></a>Lockfile</h1><p>lock=”/var/lock/subsys/openvpn”</p>
<h1 id="PID-directory"><a href="#PID-directory" class="headerlink" title="PID directory"></a>PID directory</h1><p>piddir=”/var/run/openvpn”</p>
<h1 id="Our-working-directory"><a href="#Our-working-directory" class="headerlink" title="Our working directory"></a>Our working directory</h1><p>work=/etc/openvpn</p>
<h1 id="Source-function-library"><a href="#Source-function-library" class="headerlink" title="Source function library."></a>Source function library.</h1><p>. /etc/rc.d/init.d/functions</p>
<h1 id="Source-networking-configuration"><a href="#Source-networking-configuration" class="headerlink" title="Source networking configuration."></a>Source networking configuration.</h1><p>. /etc/sysconfig/network</p>
<h1 id="Check-that-networking-is-up"><a href="#Check-that-networking-is-up" class="headerlink" title="Check that networking is up."></a>Check that networking is up.</h1><p>[ ${NETWORKING} = “no” ] &amp;&amp; exit 0</p>
<p>[ -f  $openvpn ] || exit 0</p>
<h1 id="See-how-we-were-called"><a href="#See-how-we-were-called" class="headerlink" title="See how we were called."></a>See how we were called.</h1><p>case “$1” in<br>start)<br>echo -n $”Starting openvpn: “</p>
<p>/sbin/modprobe tun &gt;/dev/null 2&gt;&amp;1</p>
<h1 id="From-a-security-perspective-I-think-it-makes"><a href="#From-a-security-perspective-I-think-it-makes" class="headerlink" title="From a security perspective, I think it makes"></a>From a security perspective, I think it makes</h1><h1 id="sense-to-remove-this-and-have-users-who-need"><a href="#sense-to-remove-this-and-have-users-who-need" class="headerlink" title="sense to remove this, and have users who need"></a>sense to remove this, and have users who need</h1><h1 id="it-explictly-enable-in-their-–up-scripts-or"><a href="#it-explictly-enable-in-their-–up-scripts-or" class="headerlink" title="it explictly enable in their –up scripts or"></a>it explictly enable in their –up scripts or</h1><h1 id="firewall-setups"><a href="#firewall-setups" class="headerlink" title="firewall setups."></a>firewall setups.</h1><p>#echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<p>if [ ! -d  $piddir ]; then<br>mkdir $piddir<br>fi</p>
<p>if [ -f $lock ]; then</p>
<h1 id="we-were-not-shut-down-correctly"><a href="#we-were-not-shut-down-correctly" class="headerlink" title="we were not shut down correctly"></a>we were not shut down correctly</h1><p>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>rm -f $pidf<br>done<br>rm -f $lock<br>sleep 2<br>fi</p>
<p>rm -f $piddir/*.pid<br>cd $work</p>
<h1 id="Start-every-conf-in-work-and-run-sh-if-exists"><a href="#Start-every-conf-in-work-and-run-sh-if-exists" class="headerlink" title="Start every .conf in $work and run .sh if exists"></a>Start every .conf in $work and run .sh if exists</h1><p>errors=0<br>successes=0<br>for c in <code>/bin/ls *.conf 2&amp;gt;/dev/null</code>; do<br>bn=${c%%.conf}<br>if [ -f “$bn.sh” ]; then<br>. $bn.sh<br>fi<br>rm -f $piddir/$bn.pid<br>$openvpn –daemon –writepid $piddir/$bn.pid –config $c –cd $work<br>if [ $? = 0 ]; then<br>successes=1<br>else<br>errors=1<br>fi<br>done</p>
<p>if [ $errors = 1 ]; then<br>failure; echo<br>else<br>success; echo<br>fi</p>
<p>if [ $successes = 1 ]; then<br>touch $lock<br>fi<br>;;<br>stop)<br>echo -n $”Shutting down openvpn: “<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>rm -f $pidf<br>done<br>success; echo<br>rm -f $lock<br>;;<br>restart)<br>$0 stop<br>sleep 2<br>$0 start<br>;;<br>reload)<br>if [ -f $lock ]; then<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill -HUP <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>done<br>else<br>echo “openvpn: service not started”<br>exit 1<br>fi<br>;;<br>reopen)<br>if [ -f $lock ]; then<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill -USR1 <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>done<br>else<br>echo “openvpn: service not started”<br>exit 1<br>fi<br>;;<br>condrestart)<br>if [ -f $lock ]; then<br>$0 stop</p>
<h1 id="avoid-race"><a href="#avoid-race" class="headerlink" title="avoid race"></a>avoid race</h1><p>sleep 2<br>$0 start<br>fi<br>;;<br>status)<br>if [ -f $lock ]; then<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill -USR2 <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>done<br>echo “Status written to /var/log/messages”<br>else<br>echo “openvpn: service not started”<br>exit 1<br>fi<br>;;<br>*)<br>echo “Usage: openvpn {start|stop|restart|condrestart|reload|reopen|status}”<br>exit 1<br>esac</p>
<p>exit 0</p>
<p>用inetd或xinetd衍生(instantiate)一个 OpenVPN daemon<br>通用服务进程 xinetd 能够响应远端节点发送的初始数据报，自动衍生一个 OpenVPN daemon 。</p>
<p>此 xinetd 配置会使 xinetd 进程监听 UDP 端口 5000，当流入一个 OpenVPN session (使用 pre-shared key)的数据报时，xinetd 自动衍生一个 OpenVPN daemon来处理此 session。注意使用 –inactive 参数会使 OpenVPN daemon 在发呆10分钟后超时退出。无论何种原因一旦OpenVPN daemon 退出，xinetd 服务会重新监听端口等待新的连接。另外要注意 xinetd 使用 root 权限衍生 OpenVPN daemon，但随后(读取受保护的密钥文件后) OpenVPN 会将权限降为 nobody 。</p>
<p>可用如下命令生成密钥(key)文件：</p>
<p>openvpn –genkey –secret key<br>注意每一条新的 OpenVPN 隧道都有它独自的端口，同时也有它自己的 xinetd 配置文件。这是因为OpenVPN 对每一个潜在的接入者需要特定的信息，包括key文件，TUN/TAP 设备，隧道节点(endpoints)，和路由配置。基于这种观点在 OpenVPN 的发展中，它从不使用单个配置文件来处理一大批类似的潜在接入者，即它没有描述接入的模板文件。从OpenVPN 作为一个UDP server 实现以来，它不具有TCP server可监听一个固定端口同时可 fork 一个新的 daemon 来动态处理客户连接的优点。尽管如此，接入模板的实现已进入预期计划，只要得到开发者和最终用户社区的足够注意和支持，它一定会实现的。</p>
<hr>
<p>sample-config-files/xinetd-server-config</p>
<h1 id="An-xinetd-configuration-file-for-OpenVPN"><a href="#An-xinetd-configuration-file-for-OpenVPN" class="headerlink" title="An xinetd configuration file for OpenVPN."></a>An xinetd configuration file for OpenVPN.</h1><p>#</p>
<h1 id="This-file-should-be-renamed-to-openvpn-or-something-suitably"><a href="#This-file-should-be-renamed-to-openvpn-or-something-suitably" class="headerlink" title="This file should be renamed to openvpn or something suitably"></a>This file should be renamed to openvpn or something suitably</h1><h1 id="descriptive-and-copied-to-the-etc-xinetd-d-directory"><a href="#descriptive-and-copied-to-the-etc-xinetd-d-directory" class="headerlink" title="descriptive and copied to the /etc/xinetd.d directory."></a>descriptive and copied to the /etc/xinetd.d directory.</h1><h1 id="xinetd-can-then-be-made-aware-of-this-file-by-restarting"><a href="#xinetd-can-then-be-made-aware-of-this-file-by-restarting" class="headerlink" title="xinetd can then be made aware of this file by restarting"></a>xinetd can then be made aware of this file by restarting</h1><h1 id="it-or-sending-it-a-SIGHUP-signal"><a href="#it-or-sending-it-a-SIGHUP-signal" class="headerlink" title="it or sending it a SIGHUP signal."></a>it or sending it a SIGHUP signal.</h1><p>#</p>
<h1 id="For-each-potential-incoming-client-create-a-separate-version"><a href="#For-each-potential-incoming-client-create-a-separate-version" class="headerlink" title="For each potential incoming client, create a separate version"></a>For each potential incoming client, create a separate version</h1><h1 id="of-this-configuration-file-on-a-unique-port-number-Also-note"><a href="#of-this-configuration-file-on-a-unique-port-number-Also-note" class="headerlink" title="of this configuration file on a unique port number.  Also note"></a>of this configuration file on a unique port number.  Also note</h1><h1 id="that-the-key-file-and-ifconfig-endpoints-should-be-unique-for"><a href="#that-the-key-file-and-ifconfig-endpoints-should-be-unique-for" class="headerlink" title="that the key file and ifconfig endpoints should be unique for"></a>that the key file and ifconfig endpoints should be unique for</h1><h1 id="each-client-This-configuration-assumes-that-the-OpenVPN"><a href="#each-client-This-configuration-assumes-that-the-OpenVPN" class="headerlink" title="each client.  This configuration assumes that the OpenVPN"></a>each client.  This configuration assumes that the OpenVPN</h1><h1 id="executable-and-key-live-in-root-openvpn-Change-this-to-fit"><a href="#executable-and-key-live-in-root-openvpn-Change-this-to-fit" class="headerlink" title="executable and key live in /root/openvpn.  Change this to fit"></a>executable and key live in /root/openvpn.  Change this to fit</h1><h1 id="your-environment"><a href="#your-environment" class="headerlink" title="your environment."></a>your environment.</h1><p>service openvpn_1<br>{<br>type            = UNLISTED<br>port            = 5000<br>socket_type     = dgram<br>protocol        = udp<br>wait            = yes<br>user            = root<br>server          = /root/openvpn/openvpn<br>server_args     = –inetd –dev tun –ifconfig 10.4.0.2 10.4.0.1 –secret /root/openvpn/key –inactive 600 –user nobody<br>}</p>
<hr>
<p>sample-config-files/xinetd-client-config</p>
<h1 id="This-OpenVPN-config-file"><a href="#This-OpenVPN-config-file" class="headerlink" title="This OpenVPN config file"></a>This OpenVPN config file</h1><h1 id="is-the-client-side-counterpart"><a href="#is-the-client-side-counterpart" class="headerlink" title="is the client side counterpart"></a>is the client side counterpart</h1><h1 id="of-xinetd-server-config"><a href="#of-xinetd-server-config" class="headerlink" title="of xinetd-server-config"></a>of xinetd-server-config</h1><p>dev tun<br>ifconfig 10.4.0.1 10.4.0.2<br>remote my-server<br>port 5000<br>user nobody<br>secret /root/openvpn/key<br>inactive 600</p>
<hr>
<p>Copyright (C) 2002-2004 by James Yonan . 此文档于 GNU Free Documentation License Version 1.2 协议下发布.</p>
<p>中文翻译：liyi</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/30/ Iptables 指南 1.1.19/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/30/ Iptables 指南 1.1.19/" itemprop="url">
                  Iptables 指南 1.1.19
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-30T16:39:19+08:00">
                2010-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://gu.wooley.me/wp/Iptables%20%E6%8C%87%E5%8D%97%201.1.19.htm" target="_blank" rel="external">Iptables 指南 1.1.19</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/29/SAFEARRAY(安全数组)使用详解/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/29/SAFEARRAY(安全数组)使用详解/" itemprop="url">
                  SAFEARRAY(安全数组)使用详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-29T14:12:36+08:00">
                2010-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>SAFEARRAY(安全数组)使用详解<br>一，何谓SAFEARRAY(安全数组)：<br>winddows操作系统与使用 SAFEARRAY 定义。 下列 SAFEARRAY 结构是 SAFEARRAY 典型、 一般定义：<br>[cpp]<br>typedef struct FARSTRUCT tagSAFEARRAY { unsigned short cDims; // 安全数组的大小<br>unsigned short fFeatures; //安全数组的标记，取值见下表</p>
<p>#if defined(WIN32) //如果在windows系统上<br>unsigned long cbElements; //安全数组元素的大小 //不包括安全数组数据的大小<br>unsigned long cLocks; // 被锁定次数</p>
<p>#else<br>unsigned short cbElements;<br>unsigned short cLocks;<br>unsigned long handle; // 仅用在 Macintosh 系统上</p>
<p>#endif void HUGEP* pvData; // 数据指针<br>SAFEARRAYBOUND rgsabound[1]; //安全数组的下界，元素数, 结构见下说明 } SAFEARRAY;</p>
<p>typedef struct tagSAFEARRAYBOUND {<br>unsigned long cElements;// 元素数<br>long lLbound;// 数组的下界<br>} SAFEARRAYBOUND;</p>
<p>fFeatures; //安全数组的标记说明<br>FADF_AUTO 0x0001在栈上创建数组<br>FADF_STATIC 0x0002在堆上创建数组<br>FADF_EMBEDDED 0x0004在结构中创建<br>FADF_FIXEDSIZE 0x0010不能改变数组大小<br>FADF_RECORD 0x0020记录容器<br>FADF_HAVEIID 0x0040有IID 身份标记 数组<br>FADF_HAVEVARTYPE 0x0080VT 类型数组<br>FADF_BSTR 0x0100BSTR数组<br>FADF_UNKNOWN 0x0200IUnknown<em> 数组<br>FADF_DISPATCH 0x0400IDispatch</em> 数组<br>FADF_VARIANT 0x0800VARIANTs数组<br>FADF_RESERVED 0xF0E8余留，将来使用<br>[/cpp]<br>Microsoft Windows 2000 和 WindowsXP 等操作系统系统使用整个 Win32API。 因此, 是运行 Windows 2000 或 WindowsXP, 计算机上之后处理条件指令, Oaidl.h 文件与以下示例代码中可能定义 SAFEARRAY：<br>[cpp]<br>typedef struct tagSAFEARRAY {<br>USHORT cDims;<br>USHORT fFeatures;<br>ULONG cbElements;<br>ULONG cLocks;<br>PVOID pvData;<br>SAFEARRAYBOUND rgsabound[ 1 ];<br>} SAFEARRAY;<br>Oaidl.h 文件, 中 SAFEARRAYBOUND 是如以下示例代码中定义一个结构：<br>typedef struct tagSAFEARRAYBOUND {<br>unsigned long cElements;<br>long lLbound;<br>} SAFEARRAYBOUND;<br>[/cpp]</p>
<p>Oaidl.h 文件还包含对于， 可用于访问 SAFEARRAY 函数原型。<br>二,什么情况下使用<br>1：在使用vc编写COM组件的时候,需要一次传递很多的数据时,使用SAFEARRAY就会很方便<br>2：VisualBasic 和 C 之间或在 VisualBasic 和 VisualC++, 之间传递数组或字符串，用 C、 C++ 或 ATL 创建 DLL时用SAFEARRAY。</p>
<p>三，使用实例</p>
<p>1：使用SafeArrayAllocDescriptor在栈上创建一维数组<br>[cpp]<br>//创建SAFEARRAY数组，每个元素为long型，该数组是一维数组<br>long nData[10]={1,2,3,4,5,6,7,8,9,10};</p>
<p>SAFEARRAY* pArray=NULL;<br>HRESULT hr=SafeArrayAllocDescriptor(1,&amp;pArray);//创建SAFEARRAY结构的对象<br>pArray-&gt;cbElements=sizeof(nData[0]);<br>pArray-&gt;rgsabound[0].cElements=10;<br>pArray-&gt;rgsabound[0].lLbound=0;<br>pArray-&gt;pvData=nData;<br>pArray-&gt;fFeatures=FADF_AUTO|FADF_FIXEDSIZE;//FADF_AUTO指定在栈上分配数据，并且大小不可以改变（固定为10）</p>
<p>//访问SAFEARRAY数组<br>long<em> pValue=NULL;<br>SafeArrayAccessData(pArray,(void*</em>)&amp;pValue);//取得数据存到指针pValue<br>long Low(0),High(0);<br>hr=SafeArrayGetLBound(pArray,1,&amp;Low);//维数索引从1开始<br>hr=SafeArrayGetUBound(pArray,1,&amp;High);//维数索引从1开始</p>
<p>SafeArrayUnaccessData(pArray);<br>SafeArrayDestroy(pArray);<br>[/cpp]<br>这种方法在栈上分配数组元素所占的空间，即nData数组所用的空间<br>2：vc++创建dll, VisualBasic向dll中传数组<br>Vc++中创建dll工程StdDLL，把下边函数复制到cpp中<br>[cpp]<br>long <strong>declspec (dllexport) </strong>stdcall Func2(SAFEARRAY <em>*ppsaMyArray) {<br>HRESULT hr;<br>HUGEP byte </em> plData;<br>hr = SafeArrayAccessData(<em>ppsaMyArray, (void HUGEP</em> FAR<em>)&amp;plData);//取得数组数据<br>byte baa;<br>baa=plData[0];//第一个数据<br>SafeArrayUnaccessData(</em>ppsaMyArray);//取消数据访问<br>SafeArrayDestroy(*ppsaMyArray);//销毁<br>return 2;<br>}<br>[/cpp]<br>将以下文本追加到 StdDLL.def 文件中现有文本：<br>Func2<br>VisualBasic中创建工程<br>添加以下声明代码，<br>Private Declare Function Func2 Lib”C:StdDLLDebugStdDLL.dll” (MyArray() As Long) As Long ‘注意文件路径和你机器的一致<br>添加 Command1命令按钮，把以下代码附加到 Command 1 _ Click 事件过程中<br>[cpp]Dim Result As Long Dim MyArrayOfLongs(3) As Long<br>MyArrayOfLongs(0) = 0<br>MyArrayOfLongs(1) = 1<br>MyArrayOfLongs(2) = 2<br>Result = Func2(MyArrayOfLongs())<br>MsgBox (“Func2 returned “ &amp; Result) [/cpp]<br>四，注意问题<br>1） 在堆上创建SAFEARRAY数组<br>2） 一方创建，一方回收<br>3） 接收方不可以修改SAFEARRAY的数据，只能读或者销毁</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>首先介绍SafeArray使用，在介绍SafeArray中的结构。看完该节文章，SafeArray的陌生感一扫而去。</p>
<p>&nbsp;</p>
<p>SafeArray 在ADO编程中经常使用。它的主要目的是用于automation中的数组型参数的传递。因为在网络环境中，数组是不能直接传递的，而必须将其包装成 SafeArray。实质上SafeArray就是将通常的数组增加一个描述符，说明其维数、长度、边界、元素类型等信息。SafeArray也并不单独使用，而是将其再包装到VARIANT类型的变量中，然后才作为参数传送出去。在VARIANT的vt成员的值如果包含VT_ARRAY|…,那么它所封装的就是一个SafeArray，它的parray成员即是指向SafeArray的指针。SafeArray中元素的类型可以是VARIANT能封装的任何类型，包括VARIANT类型本身。</p>
<p>&nbsp;</p>
<p>使用SafeArray的具体步骤：</p>
<p>方法一：</p>
<p>包装一个SafeArray：</p>
<p>(1)定义变量，如：</p>
<p>VARIANT varChunk;</p>
<p>SAFEARRAY *psa;</p>
<p>SAFEARRAYBOUND rgsabound[1];</p>
<p>&nbsp;</p>
<p>(2)创建SafeArray描述符：</p>
<p>//read array from a file.</p>
<p>uIsRead=f.Read(bVal,ChunkSize);</p>
<p>if(uIsRead==0)</p>
<p>break;</p>
<p>rgsabound[0].cElements = uIsRead;</p>
<p>rgsabound[0].lLbound = 0;</p>
<p>psa = SafeArrayCreate(VT_UI1,1,rgsabound);</p>
<p>&nbsp;</p>
<p>(3)放置数据元素到SafeArray：</p>
<p>for(long index=0;index&lt;uIsRead;index++)</p>
<p>{</p>
<p>if(FAILED(SafeArrayPutElement(psa,&amp;index,&amp;bVal[index])))</p>
<p>::MessageBox(NULL,”出毛病了。”,”提示”,MB_OK | MB_ICONWARNING);</p>
<p>}</p>
<p>一个一个地放，挺麻烦的。</p>
<p>&nbsp;</p>
<p>(4)封装到VARIANT内：</p>
<p>varChunk.vt = VT_ARRAY|VT_UI1;</p>
<p>varChunk.parray = psa;</p>
<p>这样就可以将varChunk作为参数传送出去了。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>读取SafeArray中的数据的步骤：</p>
<p>(1)用SafeArrayGetElement一个一个地读</p>
<p>BYTE buf[lIsRead];</p>
<p>for(long index=0; index&lt;lIsRead; index++)</p>
<p>{</p>
<p>::SafeArrayGetElement(varChunk.parray,&amp;index,buf+index);</p>
<p>}</p>
<p>就读到缓冲区buf里了。</p>
<p>&nbsp;</p>
<p>方法二：</p>
<p>使用SafeArrayAccessData直接读写SafeArray的缓冲区：</p>
<p>(1)读缓冲区：</p>
<p>BYTE *buf;</p>
<p>SafeArrayAccessData(varChunk.parray, (void **)&amp;buf);</p>
<p>f.Write(buf,lIsRead);</p>
<p>SafeArrayUnaccessData(varChunk.parray);</p>
<p>&nbsp;</p>
<p>(2)写缓冲区：</p>
<p>BYTE *buf;</p>
<p>::SafeArrayAccessData(psa, (void **)&amp;buf);</p>
<p>for(long index=0;index&lt;uIsRead;index++)</p>
<p>{</p>
<p>buf[index]=bVal[index];</p>
<p>}</p>
<p>::SafeArrayUnaccessData(psa);</p>
<p>varChunk.vt = VT_ARRAY|VT_UI1;</p>
<p>varChunk.parray = psa;</p>
<p>这种方法读写SafeArray都可以，它直接操纵SafeArray的数据缓冲区，比用SafeArrayGetElement和 SafeArrayPutElement速度快。特别适合于读取数据。但用完之后不要忘了调用::SafeArrayUnaccessData (psa)，否则会出错的。</p>
<p>&nbsp;</p>
<p>以下就是SAFEARRAY的Win32定义：</p>
<p>typedef struct tagSAFEARRAY</p>
<p>{</p>
<p>unsigned short cDims;</p>
<p>unsigned short fFeatures;</p>
<p>unsigned long cbElements;</p>
<p>unsigned long cLocks;</p>
<p>void * pvData;</p>
<p>SAFEARRAYBOUND rgsabound[ 1 ];</p>
<p>} SAFEARRAY;</p>
<p>&nbsp;</p>
<p>这个结构的成员（cDims，cLocks等）是通过API函数来设置和管理的。真正的数据存放在pvData成员中，而SAFEARRAYBOUND结构定义该数组结构的细节。以下就是该结构成员的简要描述：</p>
<p>&nbsp;</p>
<p><table></table></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td valign="top" width="112">成员</td></p>
<p><td valign="top" width="442">描述</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="112">cDims</td></p>
<p><td valign="top" width="442">数组的维数</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="112">fFeatures</td></p>
<p><td valign="top" width="442">用来描述数组如何分配和如何被释放的标志</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="112">cbElements</td></p>
<p><td valign="top" width="442">数组元素的大小</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="112">cLocks</td></p>
<p><td valign="top" width="442">一个计数器，用来跟踪该数组被锁定的次数</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="112">pvData</td></p>
<p><td valign="top" width="442">指向数据缓冲的指针</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="112">rgsabound</td></p>
<p><td valign="top" width="442">描述数组每维的数组结构，该数组的大小是可变的</td><br><br><br><br>&nbsp;</p>
<p>rgsabound是一个有趣的成员，它的结构不太直观。它是数据范围的数组。该数组的大小依safe array维数的不同而有所区别。rgsabound成员是一个SAFEARRAYBOUND结构的数组–每个元素代表SAFEARRAY的一个维。</p>
<p>typedef struct tagSAFEARRAYBOUND</p>
<p>{</p>
<p>unsigned long cElements;</p>
<p>unsigned long lLbound;</p>
<p>} SAFEARRAYBOUND;</p>
<p>&nbsp;</p>
<p>维数被定义在cDims成员中。例如，一个\’C\’类数组的维数可以是[3][4][5]-一个三维的数组。如果我们使用一个SAFEARRAY来表示这个结构，我们定义一个有三个元素的rgsabound数组–一个代表一维。</p>
<p>&nbsp;</p>
<p>cDims = 3;</p>
<p>…</p>
<p>SAFEARRAYBOUND rgsabound[3];</p>
<p>&nbsp;</p>
<p>rgsabound[0]元素定义第一维。在这个例子中ILBOUND元素为0，是数组的下界。cElements成员的值等于三。数组的第二维 （[4]）可以被rgsabound结构的第二个元素定义。下界也可以是0，元素的个数是4，第三维也是这样。</p>
<p>要注意，由于这是一个”C”数组，因此由0 开始，对于其它语言，例如Visual Basic，或者使用一个不同的开始。该数组的详细情况如下所示：</p>
<p>&nbsp;</p>
<p><table></table></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td valign="top" width="103">元素</td></p>
<p><td valign="top" width="103">cElements</td></p>
<p><td valign="top" width="103">ILbound</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="103">rgsabound[0]</td></p>
<p><td valign="top" width="103">3</td></p>
<p><td valign="top" width="103">0</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="103">rgsabound[1]</td></p>
<p><td valign="top" width="103">4</td></p>
<p><td valign="top" width="103">0</td><br></p>
<p><tr></tr></p>
<p><td valign="top" width="103">rgsabound[2]</td></p>
<p><td valign="top" width="103">5</td></p>
<p><td valign="top" width="103">0</td><br><br><br><br>&nbsp;</p>
<p>关于SAFEARRAYBOUND结构其实还有很多没说的。我们将要使用的SAFEARRAY只是一个简单的单维字节数组。我们通过API函数创建数组的时候，SAFEARRAYBOUND将会被自动设置。只有在你需要使用复杂的多维数组的时候，你才需要操作这个结构。</p>
<p>还有一个名字为cLocks的成员变量。很明显，它与时间没有任何的关系–它是一个锁的计数器。该参数是用来控制访问数组数据的。在你访问它之前，你必须锁定数据。通过跟踪该计数器，系统可以在不需要该数组时安全地删除它。</p>
<p>&nbsp;</p>
<p>创建SAFEARRAY</p>
<p>&nbsp;</p>
<p>创建一个单维SAFEARRAY的简单方法是通过使用SafeArrayCreateVector API函数。该函数可分配一个特定大小的连续内存块。</p>
<p>SAFEARRAY *psa;</p>
<p>// create a safe array to store the stream data</p>
<p>// llen is the number of bytes in the array.</p>
<p>psa = SafeArrayCreateVector( VT_UI1, 0, llen );</p>
<p>&nbsp;</p>
<p>SafeArrayCreateVector API创建一个SAFEARRAY，并且返回一个指向它的指针。首个参数用来定义数组的类型–它可以是任何有效的变量数据类型。为了传送一个串行化的对 象，我们将使用最基本的类型–一个非负的字节数组。VT–UI1代表非负整形的变量类型，1个字节。</p>
<p>常数\’0\’定义数组的下界；在C++中，通常为0。最后的参数llen定义数组元素的个数。在我们的例子中，这与我们将要传送对象的字节数是一样的。我们还没有提数组大小（llen）是怎样来的，这将在我们重新考查串行化时提及。</p>
<p>在你访问SAFEARRAY数据之前，你必须调用SafeArrayAccessData。该函数锁定数据并且返回一个指针。在这里，锁定数组意味着增加该数组的内部计数器（cLocks）。</p>
<p>// define a pointer to a byte array</p>
<p>unsigned char *pData = NULL;</p>
<p>SafeArrayAccessData( psa, (void**)&amp;pData );</p>
<p>… use the safe array</p>
<p>SafeArrayUnaccessData(psa);</p>
<p>相应用来释放数据的函数是SafeArrayUnaccessData()，该功能释放该参数的计数。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/28/苹果VS谷歌（转自译言）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/28/苹果VS谷歌（转自译言）/" itemprop="url">
                  苹果VS谷歌（转自译言）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-28T10:02:08+08:00">
                2010-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/未分类/" itemprop="url" rel="index">
                    <span itemprop="name">未分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自：<a href="http://article.yeeyan.org/view/176819/161611" target="_blank" rel="external">http://article.yeeyan.org/view/176819/161611</a></p>
<p>当2006年苹果公司在曼哈顿的第五大道上开设了一家新的实体店时，它却受到了不同寻常的抱怨。以往在纽约，新建筑物收到的投诉通常都是因为你遮挡了我花重金购买的绝佳视野，或是你要升级改造我刚刚发现的地块，而是正如一位伊斯兰教的狂热者所抱怨的那样，这家立方体型的由钢制的透明的立苹果实体店对伊斯兰教是一种亵渎，因为它怎么看怎么像屹立在麦加圣城中的克尔白。</p>
<p>这个故事很无厘头–因为它出自某个极端网站上，那些聪明的狂热的宗教信徒说：”当这家店铺还在装修的时候，黑色的防雨布罩住这家点的顶棚好像麦加的克尔白。”对此，纽约很多的穆斯林曾站出来说过：“我们很喜爱这家苹果店。”但是回过头来看，将苹果商店比作麦加也并不疯狂。拥有漂亮内饰和外观的苹果商店，仿佛就是苹果产品拥护者的朝圣地。不像大多数的电子产品制造商，苹果公司销售的远不是造型设计流畅的电子玩具，而是一种生活的态度和方式，即“苹果主义”。</p>
<p>苹果主义并非是一种信仰，但是它却有着救世主般的领导者–史蒂夫乔布斯。充满传奇色彩的是，他在1985年被董事会解雇后，1997年重新走马上任，使业绩暴跌的苹果公司起死回生。许多苹果迷们对苹果公司满怀忠诚：10月辞世的美国影星托尼·柯蒂斯（Tony Curtis）将他的iPhone作为陪葬品，就像是一位法老渴望在来世继续更新Facebook状态一样。</p>
<p>关注狂热的追随者，对于许多信仰来说都是一件非常有趣但启示性并不大的事情。最近一次去第五大道的苹果商店，发现许多苹果信徒并非传统意义上的苹果迷：时髦，富有的西方青年。取而代之的是衣领上带阿联酋国旗的外交官模样的人；一群来自巴西的用葡萄牙语嬉戏打闹（horesed around）的男孩儿们；放下手中的《福音圣经》，玩起了网游《Combat Arm》的红发年轻人；还有一对中年夫妇，正在访问一家名为Bed, Bath &amp; Beyond的购物网站。苹果过去的的成功只局限于那些穿不对称牛仔裤、带黑框眼镜的人群，而如今它已经超越了这一范畴，开始迈向大众市场。</p>
<p>商店内，大多数设备都可以拿在手里把玩试用。这就是苹果公司的一招智慧的棋子：虽然这会对商品产生一定的浪费，但是它也吸引了那些潜在的买家，使苹果商店犹如过去的唱片店一样，成为了人们闲逛的好去处。只有一个地方被里三层外三层围的水泄不通，那就iPad展台。</p>
<p>iPad，这款苹果今年4月发布的平板电脑，已经成为了一种现象。尽管早期遭遇了一些质疑，尽管没有3G模块的版本售价仍然高达500美元，尽管并不具备多少其他设备（电子阅读器、游戏机以及苹果自家的iPhone手机）所缺乏的功能，但该产品上市6个月的销量仍然高达750万台。iPad符合苹果一贯的大胆作风，它创造出了一类全新的产品，而人们之所以买账，几乎完全是因为它出自苹果。苹果已于2007年停用“苹果电脑”这一公司名称，如今的苹果已经在 Mac电脑以外，拥有了3款主打产品——iPod、iPad和iPhone。它想随时对地与你同在。</p>
<p>这也使得苹果与另外一家企业产生了冲突，这家企业原本并不开发移动设备，但如今却想时时伴你左右。谷歌起家时，专门为用户提供更为智能的互联网搜索方式；现在，它的业务范围遍及各种服务，而且已经渗透到我们生活的方方面面。我们会利用谷歌搜索一家好饭店，搜索它在其他网站上的评论，在谷歌地图上寻找它的位置，搜索列车是否准时，并用Gmail告知好友，我们可能会晚15分钟。</p>
<p>逐渐地，我们可能会通过搭载谷歌Android操作系统的智能手机来完成上述所有事情。谷歌自己并不生产手机，但是随着它将Android授权给越来越多的手机厂商，这样一家根本不生产任何消费电子产品的企业，却已经成为全球最成功消费电子企业的最大竞争对手。谷歌下了很大的赌注，希望创造同样能让我们时刻铭记的“谷歌主义”（Googleism）。</p>
<p>但事情并不总是一成不变的。仅仅一两年前，苹果和谷歌还相安无事，而谷歌CEO埃里克·施密特（Eric Schmidt）也得以稳坐苹果董事会（2006年至2009年）。“史蒂夫和我是非常好的私人朋友，”施密特今年夏天说，“我相信，无论以何种标准评判，他都是全世界最优秀的CEO。”这两家公司本应是“天作之合”：苹果的华丽设备运行谷歌神奇的服务。但是智能手机的吸引力令谷歌难以割舍。在2010 年末的销量超越iPhone后，Android如今已经成为最畅销的智能手机操作系统。乔布斯暗示，谷歌已经违反了双方心照不宣的“互不侵犯条约”。他在今年6月的一次会议上说：“我们不想进军搜索”，而且“我们也不会进军搜索”。乔布斯的自信一如既往，他当时对台下的听众表示，他不会从苹果的设备中移除谷歌的搜索框。“现在，我们有了更好的产品。”他说。</p>
<p>在移动大战中，这两家公司采取了截然不同的方法。苹果的设备只能安装通过苹果认证的应用。而谷歌则通过免费方式，将Android安装到了索尼、摩托罗拉、三星、LG、宏达电等手机厂商的数十款设备上。Android代码是开源的，手机厂商可以通过修改，使之适应自己的需求（尽管谷歌试图维护一套基本的标准，以便让针对一款Android手机开发的应用也可以兼容其他Android手机）。任何人开发的Android应用都可以进驻 Android Market，这是一个与苹果应用商店对应的服务。苹果的产品很华丽，但是却更为封闭。施密特今年7月造访《经济学人》伦敦总部时，曾经谈到了二者之间的这一差异。“谷歌采取了完全不同的模式，”他说，“苹果的观念一贯都很封闭。我们则采取了相反的模式：网络、开放、所有的选择、所有的声音。而且这一实验还在进行之中。”</p>
<p>把一家公司的老板打造成为该公司的文化标志，这种伎俩似乎已经过时，但是这两家公司的领导人却都拥有令人无法抗拒的诱惑。作为苹果无可争议的导航灯，乔布斯是一名出众且难于捉摸的人。他一贯蔑视媒体，除非是在指导公关团队“泄露”信息，或是举行规模盛大的新闻发布会时。他日复一日地穿着同一套行头（一件黑色高领衫和一条李维斯501牛仔裤），一如网上流传的乔布斯玩偶。乔布斯领导下的苹果几乎从未推出过没有价值的产品。</p>
<p>相比而言，谷歌没有乔布斯，但却拥有古怪的三家马车——CEO施密特以及联合创始人拉里·佩奇（Larry Page）和赛吉·布林（Sergy Brin）。佩奇和布林是斯坦福大学的同学，至今仍在推动谷歌的创新，并将公司的日常运营事务托付给施密特，一位西装革履的CEO。谷歌可以对用户的电子邮件、网络搜索和手机进行研究，然后再卖给广告主，借此获取收入。谷歌成立时的信条是“不作恶”，它的员工至今仍在身体力行。但是施密特似乎又有了一条新的标准：“不令人生厌。”他2009年的一番言论令评论人士大跌眼镜：“如果你有什么不希望别人知道的事情，当初就不应该干。”显然是为了安抚那些担心谷歌做事没有底线的人，他2010年末又再度阐述了自己的观点，他说：“谷歌的政策是到达令人生厌的那条底线，但不会逾越。”但他显然没有意识到，对于一家无处不在的科技公司的老板而言，这恰恰是他所能说出的最令人厌恶的话。</p>
<p>与苹果相比，谷歌是一个不讲规则的地方，它倾向于把产品先发布出去，然后再观察外界的反应。Gmail，一款获得了巨大成功的电子邮件系统，以测试版的形式发布，并且将这个标签保留了多年。Wave，一款极其复杂的电子邮件、信息和协作工具，用户却寥寥无几。Buzz，一款社交网络工具，由于对外公开了用户的常用联系人而遭遇了一场隐私灾难。这就是谷歌的产品开发过程，这里鼓励员工每周拿出一天来研究个人项目，而相对于设计师那精美的作品而言，程序员采用的试探性方法更受器重。</p>
<p>尽管存在种种差异，但谷歌和苹果却都发源于同一片土壤：加州硅谷。这两家公司的故事表明，一家公司的许多工程师和程序员原本都可以到另外一家公司工作：上世纪80年代在办公室里玩塑胶球的苹果Mac创造者，完全可能成为谷歌的创始人，并在90年代末利用乐高积木搭建服务器机架。硅谷可能是世界上最具创意的地方，这里诞生和毁灭过大量的企业，正因如此，才催生出一种“别告诉我从来没人试过”的态度，并同时推动着苹果和谷歌的发展。</p>
<p>但这两家公司却都在初期就开始展现他们的发展方向。乔布斯说，他在大学（退学前）上的最重要的课就是书法。在内心深处，他已然成为了一名设计师，于是他领导了一支团队开发出首款Macintosh电脑。当其他团队成员夜以继日地提高性能时，乔布斯却在对外观吹毛求疵，努力改进那些其他人几乎没有注意到的细微之处。尽管今天看来，当年的第一款Mac电脑有些笨重，色彩也不够鲜活，但在1984年，它却堪称设计典范。这是全球首款配备屏幕的商用电脑，外观与我们现在使用的电脑别无二致。</p>
<p>谷歌的DNA也在早期就已经展现。佩奇当年曾经对一名导师说，他想将整个互联网都下载到他的电脑中。谷歌的野心由此可见一斑。他们购买了大量的廉价电脑，并将其连为一体，这也成为谷歌得以成型的关键：但在多数外部人士看来，谷歌的成功更多地体现在软件上，而非硬件工程。如今，谷歌每天都要处理 10亿次以上的搜索，可是你上次看到它崩溃是在什么时候？</p>
<p>这两家公司都曾经是无名小卒：苹果曾经是希望挑战微软的大卫，而谷歌也曾是希望推翻雅虎王朝的后起之秀。他们都非常优异，并逐渐发展壮大，随后一路披荆斩棘进军了新的领域，推出了新的产品。现在，苹果和谷歌在浏览器（Safari和Chrome）、图片编辑软件（iPhoto和 Picasa）、电子邮件（Me.com和Gmail）以及云计算（MobileMe和iGoogle）等领域展开了竞争。苹果iTunes是当今全球最大的音乐商店；谷歌则通过谷歌音乐予以回应。几年前还对图书业务嗤之以鼻的苹果，如今也开始通过iTunes出售电子书了；谷歌也在通过谷歌图书项目悄悄对所有能拿到手的书籍进行数字化。谷歌拥有全球最大的视频网站YouTube；苹果也开始（借助iTunes、iPod、iPad和Apple TV）将提供电影作为核心业务。今年4月，苹果反戈一击，针对谷歌的核心业务推出了iAd，一款移动广告平台。</p>
<p>《呆伯特》（Dilbert）连环画的创造者斯科特·亚当斯（Scott Adams）开设了一个博客，主要针对技术人员发表评论。去年，他曾经将依赖技术的人称作是“电子人”（cyborg）：“如果一个电子人能够把电子眼取下，放在架子上当监视器用，我想我们都认为它的确能做到，那么你的手机就有资格成为你身体的一部分。”他将手机视为人的“外脑”：“你将大脑的部分记忆外包给外脑，并利用外脑来提供其他一些功能，例如GPS导航，或者搜索互联网。如果你像我一样，你的外脑就会每天24小时伴随着你。”</p>
<p>如果智能手机能够成为我们的外脑，至少在未来几年内，苹果或谷歌将会成为多数外脑的幕后主导者。微软Windows Phone 7的希望比较渺茫。只有黑莓，一款以工作为中心的、与众不同的设备有可能与他们一较高下。除此之外，其他企业也只能是跟随者谷歌和苹果的步伐而已。</p>
<p>当然，苹果和谷歌在构建外脑的过程中，采取了截然不同的方法。外界虽然对苹果系统的封闭颇有微词，但它的确提供了一系列优秀的设备。 iPod、 iPad和iPhone都是Mac的延伸，可以将图片、视频、音乐和电影融合成一条快乐的河流，无论在火车上、沙发上还是行走过程中，我们都可以畅游其中。由于使用了与iPod和iPhone相同的iOS系统，iPad也拥有了数亿名已经熟悉其使用方法的潜在用户。苹果提供的外脑是漂亮的硬件和直观的软件，多数时候，“亵玩”的乐趣甚至胜过“远观”。</p>
<p>但缺陷，同时也是苹果不希望你考虑的事情是：当你终于进入了它的手掌后，再要改变主意，就很难逃离苹果的系统。你通过苹果购买的音乐和电影只能借助一种蹩脚的权宜之计，从iPod转移到第三方设备，就连这种方法也是最近才刚刚出现的。苹果的产品几乎从不令你失望，可一旦你真的失望了，也已经为时已晚，这时的你已经付出了很多成本，并且拥有了一个“苹果主义者”的名声，尽管你不希望被这样称呼。作为iPhone美国独家运营商，AT&amp;T 遭到很多苹果粉丝的诟病，但他们却别无选择。苹果主义的魔力如此强烈，以至于多数用户根本不在乎他们的iPhone其实是一款差劲的手机。乔布斯声称，任何网络都会像AT&amp;T一样，被热切的iPhone用户淹没。他很快就可以更好地证明这一观点，因为iPhone明年就将与第二家美国运营商 （Verizon）签约。</p>
<p>谷歌追求的则是一种不同的品牌信仰。你可以选择运营商，也可以选择手机制造商。独立应用开发商可以通过不懈的努力将应用推向你的手机，而无需经过谷歌的批准。随着Android阵营的不断壮大，互联网以及网民的群体智慧将推动这些应用不断改进。谷歌本身则几乎一无所求。它不会像苹果那样直接对你收费，也不会向你销售外脑，它想要的是内容。</p>
<p>有了这些内容，它就可以向那些想对你发布广告的企业收费。这都是些小广告，不是吗？谷歌早先曾承诺，所有的广告都是文本广告，而且篇幅很短。由于广告都是为你量身定制的，所以你不会感觉被打扰，也没有任何损失。</p>
<p>这些量身定制的广告有时会很滑稽：一名大学生写了一篇有关板球的文章，文中提到了灰烬杯（Ashes），于是他的搜索结果一侧便会出现火葬场的广告。但是它的风险却不止于此。去年在纽约举行的一次会议上，我遇到了一位令人印象深刻的将军，他极度自信，当时任职于美国特种部队，而且参加过伊拉克战争。我们聊了一会，并且交换了名片，我并没有将这件事放在心上。但一年后，当我上网冲浪时，他却反复出现在谷歌的广告中。他当时正在竞选密苏里州的国会议员，而我则完全无法逃脱他的竞选广告。我并不住在密苏里，但是谷歌似乎通过某种渠道知道了我曾经见过他。</p>
<p>当它们在你的口袋中发生冲突之前，苹果主义和谷歌主义都曾赢得过你的信赖。苹果彻底改变了我们对电子产品的认识。美国《Fast Company》杂志的设计编辑克里夫·库昂（Cliff Kuang）说，以前，当一款新的电子产品面市时，“你家里只有一个人知道怎么用。而苹果已经彻底改变了这种状况。不会再有人认为，要使用苹果的产品还用学。”</p>
<p>事实上，我的新iPad根本没有说明书和使用手册，也没有乱七八糟的电线和数据线，甚至连光盘都没有。打开包装后，看到的只有iPad和一条数据线。无需阅读晦涩的说明，只要把iPad拿出来，揭下上面的塑料膜，按一下按钮，就会出现“欢迎。你想要做什么？”的语音提示。这种易用性或许可以帮助乔布斯为AT&amp;T辩护：根据美国权威杂志《消费者报告》的数据，iPhone用户的数据使用量比其他智能手机用户多五倍。苹果主义者并不是在摆弄他们的苹果设备，而是在实实在在地使用。</p>
<p>而且，苹果的产品经常会被用于“google”信息。值得注意的是“apple”并未成为动词。我们已经忘记，在苹果将电脑和电子产品引入主流前，这些设备曾经是多么地难于使用。与之类似，很多人也已经忘记，在谷歌诞生前，搜索引擎同样非常糟糕。当时的大型互联网公司都希望成为门户——通过一个单独的网页为你提供媒体、购物机会、天气预报以及电子邮件等服务。但是雅虎、AltaVista、Excite等企业却无法组织数百万的网页。谷歌则抛弃了门户的概念，而是利用神奇的算法挖掘用户在网上寻找什么，而且每次都能将这些内容放在搜索页面的顶部，或接近顶部的位置。有了谷歌，互联网才得以成为今天的样子。当然，它此后也推出了一些华而不实的页面，并且开始滥用先发优势。现在的网站都希望提升在谷歌中的排名，如果被挤到了第四页，几乎就没有任何被人发现的希望。迎合谷歌的算法已经成为零售商、娱乐明星和政治人物的重要任务，他们都在争夺搜索页面排名第一的位置。</p>
<p>苹果也能够令优秀的人或物锦上添花。过去20年间，iTunes给音乐行业带来的活力超过了任何一家公司。2010年2月，iTunes出售的歌曲已经达到了100亿首。在纽约或伦敦的地铁中，有半数乘客的耳朵里都塞着苹果的白色耳机。但他们并没有改变消费模式，而是承袭并加剧了原有的模式。下载模式在打压专辑销量的同时，却对热门单曲起到了推动作用。根据英国音乐版权协会（PRS for Music）的数据，2005年，排名首位的单曲平均销量为6万份，而目前的这一数字则达到了9.3万。有人曾经认为，由于获取大量音乐的成本降低，因此将增加一些非着名的小众音乐的销量。由《连线》杂志主编克里斯·安德森（Chris Anderson）提出的“长尾理论”认为，尽管20%的歌曲或书籍或者其他任何东西能够占到80%的销量，但小众市场仍然拥有很大的机会。但是英国音乐版权协会却发现，实际占到80%销量的歌曲只有2%。</p>
<p>无论是对苹果还是谷歌而言，只是帮助强者更强，根本称不上是一家优秀的企业。但是由于拥有强大的实力，无论他们做什么，都难免会成为批评的对象。但也并非全无变化，谷歌正在逐渐抛弃以往的做法，不再为所有用户提供完全相同的搜索结果，而是逐渐开始根据地理位置、浏览历史甚至联系方式，为不同用户提供个性化的结果。它希望可以借此提高搜索结果的相关性。部分媒体观察人士认为，生活在你自己的“谷歌泡泡”里，会威胁到文化，甚至民主，原因是用户永远不会被意外信息所“打扰”。目前为止，不同用户间的搜索引擎只有细微的差别。可以推测，施密特并不认为此举令人生厌。</p>
<p>种种迹象显示，苹果和谷歌正在展开一场殊死搏斗，尽管如此，他们仍然可以保持亦敌亦友的状态。很多人都用Gmail收发邮件，用iTunes 购买音乐，用iPod配合健身，并用Android接打电话。谷歌仍然是iPhone的默认搜索引擎。而刚刚开始崭露头角的Android平板电脑也将紧追 iPad的步伐，一如Android手机对iPhone的追赶一样。我们的屏幕世界非常宽广，远不止这两家公司，还包括主打图书和电子阅读器的亚马逊，提供社交网络的Facebook和Twitter，以及发布分类广告的eBay和Craigslist。无论是苹果还是谷歌，都没有足够的实力一统天下。</p>
<p>但苹果和谷歌在我们的口袋里展开的手机大战，却是苹果和微软的桌面大战以来，科技行业最大的一场冲突。到2011年底，智能手机的销量将超过传统手机，2012年则会超过PC。以往，照片、歌曲、文档和其他所有数据都是存储于个人设备上的，但这种系统却有可能会被云计算取代。与此同时，部分观察人士预计，搜索引擎收入很快也将见顶。乔布斯就是这些观察人士中的一员，他曾经直截了当地表示：“在移动设备中，搜索未成气候。搜索并非它的重点所在。” 这使得智能手机应用成为访问云计算的重要途径——而苹果和谷歌都在努力通过工作、浏览、听觉、视觉和网络产品，渗透到我们生活的方方面面，以便追赶彼此的收入。</p>
<p>他们的方法有着显着的差别。尽管竞争可能同时促进双方的发展，但要获得同等成功，可能性却微乎其微。世界将分成两派：一派是像苹果一样的完美主义者，他们遵循井然有序、一切尽在掌握的行为方式；还有一派则像谷歌一样勇于探索，他们反应迅速，而且信仰开放的模式。为数不多的完美产品由苹果生产，而数量庞大的Android设备则由谷歌来引导。伴着Facebook成长起来的一代人会忘记隐私担忧，最终投靠谷歌吗？那些成长过程中一直期待着设备够用即可的人会倾向苹果吗？答案不仅取决于金钱的多少，还取决于我们感受周围世界的方式。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/28/hello-world-2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/28/hello-world-2/" itemprop="url">
                  Hello world！
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-28T07:54:52+08:00">
                2010-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/未分类/" itemprop="url" rel="index">
                    <span itemprop="name">未分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>欢迎使用 WordPress。这是系统自动生成的演示文章。编辑或者删除它，开始您的博客！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/25/RedHat(CentOS)和Ubuntu安装软件命令对比(区别)/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2010/12/25/RedHat(CentOS)和Ubuntu安装软件命令对比(区别)/" itemprop="url">
                  RedHat(CentOS)和Ubuntu安装软件命令对比(区别)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-25T09:46:50+08:00">
                2010-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/未分类/" itemprop="url" rel="index">
                    <span itemprop="name">未分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>此表内容来自《Ubuntu Server最佳方案》，CentOS和Ubuntu(Debian)是VPS最常见的系统，这份表很实用，分享下。 <img src="http://hi.csdn.net/attachment/201006/14/0_1276557908G7Ic.gif" alt=""><img src="http://hi.csdn.net/attachment/201006/14/0_1276557915jy6P.gif" alt=""><img src="http://hi.csdn.net/attachment/201006/14/0_1276557922WC0l.gif" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Wooley Gu" />
          <p class="site-author-name" itemprop="name">Wooley Gu</p>
          <p class="site-description motion-element" itemprop="description">我将去向哪里</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">147</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">94</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://m.qxqy.net" title="栖霞棋院" target="_blank">栖霞棋院</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wooley Gu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
