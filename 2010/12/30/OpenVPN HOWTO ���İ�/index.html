<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Wooley, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="OpenVPN HOWTO
介绍此文档描述一个典型的Home到Office的通信中OpenVPN的配置。这份HOWTO举了一个完整的配置实例，在man page手册页中有一个更为简单的例子。
此HOWTO文档还有如下格式：
PDFPostScript
附加的文档其他的一些很好的文档及HOWTO 为不同环境下配置OpenVPN而作。
基本的隧道(Tunnel)类型OpenVPN可以创建两种基本的隧道">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenVPN HOWTO 中文版">
<meta property="og:url" content="http://wooley.win/2010/12/30/OpenVPN HOWTO 中文版/index.html">
<meta property="og:site_name" content="航行日志">
<meta property="og:description" content="OpenVPN HOWTO
介绍此文档描述一个典型的Home到Office的通信中OpenVPN的配置。这份HOWTO举了一个完整的配置实例，在man page手册页中有一个更为简单的例子。
此HOWTO文档还有如下格式：
PDFPostScript
附加的文档其他的一些很好的文档及HOWTO 为不同环境下配置OpenVPN而作。
基本的隧道(Tunnel)类型OpenVPN可以创建两种基本的隧道">
<meta property="og:updated_time" content="2016-12-02T09:43:58.670Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenVPN HOWTO 中文版">
<meta name="twitter:description" content="OpenVPN HOWTO
介绍此文档描述一个典型的Home到Office的通信中OpenVPN的配置。这份HOWTO举了一个完整的配置实例，在man page手册页中有一个更为简单的例子。
此HOWTO文档还有如下格式：
PDFPostScript
附加的文档其他的一些很好的文档及HOWTO 为不同环境下配置OpenVPN而作。
基本的隧道(Tunnel)类型OpenVPN可以创建两种基本的隧道">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wooley.win/2010/12/30/OpenVPN HOWTO 中文版/"/>





  <title> OpenVPN HOWTO 中文版 | 航行日志 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">航行日志</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">追寻梦想</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wooley.win/2010/12/30/OpenVPN HOWTO 中文版/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Wooley Gu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="航行日志">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="航行日志" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OpenVPN HOWTO 中文版
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2010-12-30T19:05:53+08:00">
                2010-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>OpenVPN HOWTO</p>
<p>介绍<br>此文档描述一个典型的Home到Office的通信中OpenVPN的配置。这份HOWTO举了一个完整的配置实例，在man page手册页中有一个更为简单的例子。</p>
<p>此HOWTO文档还有如下格式：</p>
<p>PDF<br>PostScript</p>
<p>附加的文档<br>其他的一些很好的文档及HOWTO 为不同环境下配置OpenVPN而作。</p>
<p>基本的隧道(Tunnel)类型<br>OpenVPN可以创建两种基本的隧道类型：</p>
<p>Routed IP tunnels – 适用于不需广播的点对点IP(point-to-point)通信。比起桥接网络隧道来略显得更有效率些而且更易配置。此HOWTO文档涵盖了Routed IP tunnels。<br>Bridged Ethernet Tunnels(桥接网络隧道) – 能用于IP协议或非IP协议的隧道。这种类型的隧道更适合于使用广播(broadcast)的应用，比如某些Windows网络游戏。配置起来稍微复杂些。关于桥接网络隧道的Mini-HOWTO。<br>Routed IP tunnel HOWTO<br>我们会尝试描述一个完整的系统配置，期间涉及到防火墙，VPN，NAT以及他们彼此间的相互关联，我们不会孤立的一部分一部分的探讨VPN设置。</p>
<p>在我们的例子中，Home和Office机器所在的私有网络都分别通过了一台具有公网IP地址的网关机器接入互联网。每台网关机器都配有两块网卡（NIC），一块联入内网，另一块联入公网。网关机器为内网机器提供NAT，防火墙，VPN服务。Home及Office机器的配置基本一样，除了Office的网关机器为固定IP，Home机器的IP为DHCP动态获取。</p>
<p>在以下例子中所显示的配置文件在OpenVPN发布版本中是有效的。</p>
<p>Home和Office的IP网络参数<br>Home Office<br>本地子网 (内网地址) 10.0.1.0/24 10.0.0.0/24<br>Tunnel Endpoint (内网地址) 10.1.0.2 10.1.0.1<br>OpenVPN Gateway (公网地址) DHCP client, need not be explicitly specified 1.2.3.4</p>
<p>安装 OpenVPN<br>如果你的系统没有OpenSSL库，你需要 下载和安装它。</p>
<p>如果你想使用VPN连接的压缩特性，或者你想将OpenVPN安装为一个RPM包，安装LZO Library。</p>
<p>如果你使用Linux 2.2 或更早版本，下载 TUN/TAP driver。对于Linux 2.4.7及以上版本的用户TUN/TAP 驱动已经捆绑到内核中。Linux 2.4.0 -&gt; 2.4.6 的用户需要留意INSTALL文件末尾的注意信息。</p>
<p>现在下载 OpenVPN 的最新发布版：</p>
<p><a href="http://prdownloads.sourceforge.net/openvpn/openvpn-1.6.0.tar.gz" target="_blank" rel="external">http://prdownloads.sourceforge.net/openvpn/openvpn-1.6.0.tar.gz</a><br>使用 tarball 安装<br>解开发布版的压缩包：</p>
<p>gzip -dc openvpn-1.6.0.tar.gz | tar xvf -<br>创建 OpenVPN:</p>
<p>cd openvpn-1.6.0<br>./configure<br>make<br>make install<br>如果你未下载 LZO Library ，将 –disable-lzo 加入到 configure 命令中。也可以启用其他的选型，比如 pthread (./configure –enable-pthread) 用来提高 SSL/TLS 动态密钥交换的响应速度。命令</p>
<p>./configure –help<br>将显示所有的配置选型。</p>
<p>从 RPM 安装<br>首先创建RPM文件。此操作需要 OpenSSl，pthread，和LZO 库。通常只会有 LZO 库需要额外下载并安装；; 其他的库在大多数的Linux 发行版本中已经作为缺省安装。</p>
<p>rpmbuild -tb openvpn-1.6.0.tar.gz<br>RPM 创建过程会生成大量输出信息。创建成功后，在输出信息的末尾附记会有一个提示信息说明生成的二进制RPM文件名。用如下命令安装该文件：</p>
<p>rpm -Uvh binary-RPM-file</p>
<p>配置 TUN/TAP 驱动<br>仅需一次的配置<br>如果你使用 Linux 2.4.7 或更高版本，十分幸运 TUN/TAP 驱动已经捆绑到内核中。你可以通过如下命令确认：<br>locate if_tun.h<br>此命令产生类似这样的信息 /usr/include/linux/if_tun.h 。</p>
<p>对于 Linux 2.4.7 或更高版本，如果你通过 tarball 安装，输入如下命令配置 TUN/TAP 设备节点（如果你通过 RPM 安装可以忽略这一步，因为RPM为你自动创建该节点）：</p>
<p>mknod /dev/net/tun c 10 200<br>如果你使用 Linux 2.2，你需要获得 版本 1.1 的TUN/TAP kernel module 并按照安装说明进行操作。</p>
<p>每次系统启动后需要执行一次的配置<br>在 Linux 上使用 OpenVPN 或任何用到 TUN/TAP 设备的程序前需要载入 TUN/TAP kernel module：</p>
<p>modprobe tun<br>并且启用 IP 转发：</p>
<p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<p>配置 Firewall 和 NAT<br>这一小节假定你使用 Linux 2.4 和 iptables 防火墙。这里是一个防火墙配置的例子，它为内网机器访问互联网提供了NAT服务，stateful outgoing connection tracking, 和 OpenVPN 支持:</p>
<hr>
<p>sample-config-files/firewall.sh</p>
<p>#!/bin/bash</p>
<h1 id="OpenVPN-aware-防火墙例子"><a href="#OpenVPN-aware-防火墙例子" class="headerlink" title="OpenVPN-aware 防火墙例子."></a>OpenVPN-aware 防火墙例子.</h1><h1 id="eth0-连接到互联网"><a href="#eth0-连接到互联网" class="headerlink" title="eth0 连接到互联网."></a>eth0 连接到互联网.</h1><h1 id="eth1-连接到内部子网"><a href="#eth1-连接到内部子网" class="headerlink" title="eth1 连接到内部子网."></a>eth1 连接到内部子网.</h1><h1 id="这里改变你的子网地址"><a href="#这里改变你的子网地址" class="headerlink" title="这里改变你的子网地址"></a>这里改变你的子网地址</h1><h1 id="Home-使用-10-0-1-0-24"><a href="#Home-使用-10-0-1-0-24" class="headerlink" title="Home   使用 10.0.1.0/24"></a>Home   使用 10.0.1.0/24</h1><h1 id="Office-使用-10-0-0-0-24"><a href="#Office-使用-10-0-0-0-24" class="headerlink" title="Office 使用 10.0.0.0/24"></a>Office 使用 10.0.0.0/24</h1><p>PRIVATE=10.0.0.0/24</p>
<h1 id="Loopback-地址"><a href="#Loopback-地址" class="headerlink" title="Loopback 地址"></a>Loopback 地址</h1><p>LOOP=127.0.0.1</p>
<h1 id="删除旧的-iptables-规则"><a href="#删除旧的-iptables-规则" class="headerlink" title="删除旧的 iptables 规则"></a>删除旧的 iptables 规则</h1><h1 id="并且临时阻塞网络通信"><a href="#并且临时阻塞网络通信" class="headerlink" title="并且临时阻塞网络通信"></a>并且临时阻塞网络通信</h1><p>iptables -P OUTPUT DROP<br>iptables -P INPUT DROP<br>iptables -P FORWARD DROP<br>iptables -F</p>
<h1 id="设置缺省策略"><a href="#设置缺省策略" class="headerlink" title="设置缺省策略"></a>设置缺省策略</h1><p>iptables -P OUTPUT ACCEPT<br>iptables -P INPUT DROP<br>iptables -P FORWARD DROP</p>
<h1 id="阻止外部数据包使用-loopback-地址"><a href="#阻止外部数据包使用-loopback-地址" class="headerlink" title="阻止外部数据包使用 loopback 地址"></a>阻止外部数据包使用 loopback 地址</h1><p>iptables -A INPUT -i eth0 -s $LOOP -j DROP<br>iptables -A FORWARD -i eth0 -s $LOOP -j DROP<br>iptables -A INPUT -i eth0 -d $LOOP -j DROP<br>iptables -A FORWARD -i eth0 -d $LOOP -j DROP</p>
<h1 id="任何从互联网流入的数据包都必须使用真实互联网地址"><a href="#任何从互联网流入的数据包都必须使用真实互联网地址" class="headerlink" title="任何从互联网流入的数据包都必须使用真实互联网地址"></a>任何从互联网流入的数据包都必须使用真实互联网地址</h1><p>iptables -A FORWARD -i eth0 -s 192.168.0.0/16 -j DROP<br>iptables -A FORWARD -i eth0 -s 172.16.0.0/12 -j DROP<br>iptables -A FORWARD -i eth0 -s 10.0.0.0/8 -j DROP<br>iptables -A INPUT -i eth0 -s 192.168.0.0/16 -j DROP<br>iptables -A INPUT -i eth0 -s 172.16.0.0/12 -j DROP<br>iptables -A INPUT -i eth0 -s 10.0.0.0/8 -j DROP</p>
<h1 id="阻塞-NetBios-数据包流出-如果内网有-windows-机器-。"><a href="#阻塞-NetBios-数据包流出-如果内网有-windows-机器-。" class="headerlink" title="阻塞 NetBios 数据包流出(如果内网有 windows 机器)。"></a>阻塞 NetBios 数据包流出(如果内网有 windows 机器)。</h1><h1 id="这不会影响-VPN-隧道上的NetBios通信，"><a href="#这不会影响-VPN-隧道上的NetBios通信，" class="headerlink" title="这不会影响 VPN 隧道上的NetBios通信，"></a>这不会影响 VPN 隧道上的NetBios通信，</h1><h1 id="但它会阻止本地-windows-机器向互联网广播自己。"><a href="#但它会阻止本地-windows-机器向互联网广播自己。" class="headerlink" title="但它会阻止本地 windows 机器向互联网广播自己。"></a>但它会阻止本地 windows 机器向互联网广播自己。</h1><p>iptables -A FORWARD -p tcp –sport 137:139 -o eth0 -j DROP<br>iptables -A FORWARD -p udp –sport 137:139 -o eth0 -j DROP<br>iptables -A OUTPUT -p tcp –sport 137:139 -o eth0 -j DROP<br>iptables -A OUTPUT -p udp –sport 137:139 -o eth0 -j DROP</p>
<h1 id="检查流向互联网的数据包中源地址的合法性"><a href="#检查流向互联网的数据包中源地址的合法性" class="headerlink" title="检查流向互联网的数据包中源地址的合法性"></a>检查流向互联网的数据包中源地址的合法性</h1><p>iptables -A FORWARD -s ! $PRIVATE -i eth1 -j DROP</p>
<h1 id="允许本地-loopback"><a href="#允许本地-loopback" class="headerlink" title="允许本地 loopback"></a>允许本地 loopback</h1><p>iptables -A INPUT -s $LOOP -j ACCEPT<br>iptables -A INPUT -d $LOOP -j ACCEPT</p>
<h1 id="允许向内的-incoming-ping-操作-可以禁止"><a href="#允许向内的-incoming-ping-操作-可以禁止" class="headerlink" title="允许向内的(incoming) ping 操作(可以禁止)"></a>允许向内的(incoming) ping 操作(可以禁止)</h1><p>iptables -A INPUT -p icmp –icmp-type echo-request -j ACCEPT</p>
<h1 id="允许-www-和-ssh-服务-可以禁止"><a href="#允许-www-和-ssh-服务-可以禁止" class="headerlink" title="允许 www 和 ssh 服务(可以禁止)"></a>允许 www 和 ssh 服务(可以禁止)</h1><p>iptables -A INPUT -p tcp –dport http -j ACCEPT<br>iptables -A INPUT -p tcp –dport ssh -j ACCEPT</p>
<h1 id="允许向内的-incoming-OpenVPN-数据包"><a href="#允许向内的-incoming-OpenVPN-数据包" class="headerlink" title="允许向内的(incoming) OpenVPN 数据包"></a>允许向内的(incoming) OpenVPN 数据包</h1><h1 id="对于每条-OpenVPN-隧道要将以下每行重复，"><a href="#对于每条-OpenVPN-隧道要将以下每行重复，" class="headerlink" title="对于每条 OpenVPN 隧道要将以下每行重复，"></a>对于每条 OpenVPN 隧道要将以下每行重复，</h1><h1 id="改变-–dport-n-为-OpenVPN-UDP-实际端口。"><a href="#改变-–dport-n-为-OpenVPN-UDP-实际端口。" class="headerlink" title="改变 –dport n 为 OpenVPN UDP 实际端口。"></a>改变 –dport n 为 OpenVPN UDP 实际端口。</h1><p>#</p>
<h1 id="在-OpenVPN中，端口号由-–port-n-选项控制。"><a href="#在-OpenVPN中，端口号由-–port-n-选项控制。" class="headerlink" title="在 OpenVPN中，端口号由 –port n 选项控制。"></a>在 OpenVPN中，端口号由 –port n 选项控制。</h1><h1 id="如果你将这个选型写入配置文件，"><a href="#如果你将这个选型写入配置文件，" class="headerlink" title="如果你将这个选型写入配置文件，"></a>如果你将这个选型写入配置文件，</h1><h1 id="你可以去掉-‘–’后这一串字符。"><a href="#你可以去掉-‘–’后这一串字符。" class="headerlink" title="你可以去掉 ‘–’后这一串字符。"></a>你可以去掉 ‘–’后这一串字符。</h1><p>#</p>
<h1 id="If-you-taking-the-stateful-firewall"><a href="#If-you-taking-the-stateful-firewall" class="headerlink" title="If you taking the stateful firewall"></a>If you taking the stateful firewall</h1><h1 id="approach-参看-OpenVPN-HOWTO"><a href="#approach-参看-OpenVPN-HOWTO" class="headerlink" title="approach (参看 OpenVPN HOWTO),"></a>approach (参看 OpenVPN HOWTO),</h1><h1 id="那么注释掉下面这一行。"><a href="#那么注释掉下面这一行。" class="headerlink" title="那么注释掉下面这一行。"></a>那么注释掉下面这一行。</h1><p>iptables -A INPUT -p udp –dport 5000 -j ACCEPT</p>
<h1 id="允许来自-TUN-TAP-设备的数据包。"><a href="#允许来自-TUN-TAP-设备的数据包。" class="headerlink" title="允许来自 TUN/TAP 设备的数据包。"></a>允许来自 TUN/TAP 设备的数据包。</h1><h1 id="当-OpenVPN-运行于安全模式时，"><a href="#当-OpenVPN-运行于安全模式时，" class="headerlink" title="当 OpenVPN 运行于安全模式时，"></a>当 OpenVPN 运行于安全模式时，</h1><h1 id="他会对-tun-或-tap-接口上的数据包到达前进行验证。"><a href="#他会对-tun-或-tap-接口上的数据包到达前进行验证。" class="headerlink" title="他会对 tun 或 tap 接口上的数据包到达前进行验证。"></a>他会对 tun 或 tap 接口上的数据包到达前进行验证。</h1><h1 id="也就是说，这里添加的任何过滤不是必需的，"><a href="#也就是说，这里添加的任何过滤不是必需的，" class="headerlink" title="也就是说，这里添加的任何过滤不是必需的，"></a>也就是说，这里添加的任何过滤不是必需的，</h1><h1 id="除非你想对有可能溢出隧道的数据包类型进行严格约束。"><a href="#除非你想对有可能溢出隧道的数据包类型进行严格约束。" class="headerlink" title="除非你想对有可能溢出隧道的数据包类型进行严格约束。"></a>除非你想对有可能溢出隧道的数据包类型进行严格约束。</h1><p>iptables -A INPUT -i tun+ -j ACCEPT<br>iptables -A FORWARD -i tun+ -j ACCEPT<br>iptables -A INPUT -i tap+ -j ACCEPT<br>iptables -A FORWARD -i tap+ -j ACCEPT</p>
<h1 id="允许来自内网的数据包"><a href="#允许来自内网的数据包" class="headerlink" title="允许来自内网的数据包"></a>允许来自内网的数据包</h1><p>iptables -A INPUT -i eth1 -j ACCEPT<br>iptables -A FORWARD -i eth1 -j ACCEPT</p>
<h1 id="保持来自本机和内网数据包的连接状态"><a href="#保持来自本机和内网数据包的连接状态" class="headerlink" title="保持来自本机和内网数据包的连接状态"></a>保持来自本机和内网数据包的连接状态</h1><p>iptables -A OUTPUT -m state –state NEW -o eth0 -j ACCEPT<br>iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>iptables -A FORWARD -m state –state NEW -o eth0 -j ACCEPT<br>iptables -A FORWARD -m state –state ESTABLISHED,RELATED -j ACCEPT</p>
<h1 id="伪装本地子网"><a href="#伪装本地子网" class="headerlink" title="伪装本地子网"></a>伪装本地子网</h1><p>iptables -t nat -A POSTROUTING -s $PRIVATE -o eth0 -j MASQUERADE</p>
<p>OpenVPN 在防火墙设置中提供少量的附加选项：</p>
<p>If both OpenVPN peers reference the other with an explicit –remote option, and stateful firewalls that provide UDP connection tracking (such as iptables) exist between the peers, it is possible to run OpenVPN without any explicit firewall rules, if both peers originate regular pings to each other to keep the connection alive. To do this, simply run OpenVPN with the –remote peer option, and specify –ping 15 to ensure that packets flow over the tunnel at least once every 15 seconds.<br>上面的选项在隧道一端(peer)频繁变更 IP 地址比如说DHCP或拨号时，显得不够方便。在这种情况下，以上简单的防火墙配置将允许任何IP地址通过UDP端口5000（OpenVPN 的缺省UDP端口） 流入数据包。在 OpenVPN 的安全模式下，所有流入隧道的数据或者通过安全验证或者被丢弃，所以它通常被认为是安全的。<br>如果你选择完全开放 OpenVPN 的 incoming UDP 端口就像上面简单防火墙中的配置一样，你可能会想利用 –tls-auth 选项在 TLS 控制通道上作双倍的验证，同时使用 RSA 密钥和预先分享的密码短语(passphrase)来作为防御 DoS 或 active 攻击的第二道防线。关于–tls-auth 的更多信息，参考 openvpn man page。</p>
<p>创建 RSA 证书和密钥<br>OpenVPN 有两种安全模式，一种基于使用 RSA 证书和密钥的 SSL/TLS，一种使用预先分享的静态密钥。SSL/TLS + RSA 密钥被证明是一种最安全的选择，静态密钥优势则在于简洁。如果你想使用 RSA 密钥，继续往下读。要使用静态密钥，向前跳到 创建预分享静态密钥 一节.<br>我们将使用 openssl 命令创建 RSA 证书和密钥，该命令包含在 OpenSSL 库的发布程序中。</p>
<p>RSA 证书是一种公开密钥，在其中还含有其他安全域，比如说证书持有者的 Common Name 或 email 地址。OpenVPN 有能力在进行认证前对这些域进行测试。更多信息参考 openvpn man page 中的 –tls-verify 选项。</p>
<p>在我们的例子中遵从 apache 惯例使用 .crt 扩展名表示证书文件，.key 扩展名表示私钥。私钥文件必须安全保管。证书文件可以自由发布共享。</p>
<p>选择一台机器比如 Office 作为密钥管理主机。</p>
<p>首先编辑文件 /usr/share/ssl/openssl.cnf (这个文件也许在其他地方，可以用 locate openssl.cnf 命令找到它)。</p>
<p>你或许会对它作一些修改：</p>
<p>建立一个目录作为密钥的工作目录，将 dir 指向它。<br>考虑增加有限期限 default_days 以免你的 VPN 在工作整一年后莫名其妙的终止。<br>设定 certificate 和 private_key 指向你的根证书 （master certificate authority certificate）和私钥文件（我们马上要生成它）。在下面的例子中，我们假定你的证书文件名为 my-ca.crt，你的私钥文件名为 my-ca.key 。<br>注意文件 index.txt 和 serial。将 index.txt 清空，serial 初始化为包含一个数字序列比如 01.<br>如果你狂热的追求密钥长度，那可以将 default_bits 增加到2048。 对于打开 pthread 支持（可以后台处理 RSA 密钥）的 OpenVPN 处理2048位的 RSA 密钥是毫无问题的。甚至没有打开 pthread 支持时也可以使用更长的密钥，但你会在隧道中作 SSL/TLS 密钥协商时感觉到响应时间的延迟。这里有一份选择 RSA 密钥长度的很好的文章，参见 April 2002 issue of Bruce Schneier’s Crypto-Gram Newsletter.<br>openssl.cnf 编辑完后，创建根证书/私钥对（master certificate authority certificate/private-key pair）:</p>
<p>openssl req -nodes -new -x509 -keyout my-ca.key -out my-ca.crt -days 3650<br>这将会创建一对有效期为十年的根证书/私钥对。</p>
<p>现在为 Home 和 Office 创建 证书/私钥对：</p>
<p>openssl req -nodes -new -keyout office.key -out office.csr<br>openssl ca -out office.crt -in office.csr<br>openssl req -nodes -new -keyout home.key -out home.csr<br>openssl ca -out home.crt -in home.csr<br>现在将 home.crt, home.key, 和 my-ca.crt 文件通过安全途径拷贝到 Home 机器上，尽管实际上只有.key 才被认为是应该保密的。</p>
<p>现在在 Office 机器上创建 Diffie Hellman 参数，使用下列命令：</p>
<p>openssl dhparam -out dh1024.pem 1024<br>如果在 openssl.cnf 中增大了密钥位数，相应的这里也要把 1024 改为 2048。</p>
<p>对于偏执狂可以考虑去掉上面 openssl 命令中的-nodes 选项。其结果是对每一个私钥进行口令加密，从而保证当有人攻入你的主机盗走你的私钥时仍有一定的安全性。麻烦的是每次当你使用 OpenVPN 时都需要输入口令。更多信息参考 openvpn man page 中的 –askpass 选项。</p>
<p>如果你对手工管理 RSA 密钥觉得困惑，那要指出一点 OpenVPN 可以很好的同任何 X509 证书管理工具或服务包括商业化的 CAs 如 Thawte or Verisign等协同工作。检索 OpenCA 项目可以查看有哪些同证书/密钥管理工具 配合良好的开源项目。</p>
<p>另外，OpenVPN 发布版中包含了一组脚本能够简化 RSA 证书和密钥管理。</p>
<p>在 OpenVPN 上使用商业证书(CAs)的重要提示<br>It should be noted that OpenVPN’s security model in SSL/TLS mode is oriented toward users who will generate their own root certificate, and hence be their own CA. In SSL/TLS mode, OpenVPN authenticates its peer by checking that the peer-supplied certificate was signed by the CA certificate specified in the –ca option. Like the SSL-based secure web, the security of OpenVPN’s SSL/TLS mode rests on the infeasibility of forging a root certificate signature.</p>
<p>This authentication procedure works perfectly well if you have generated your own root certificate, but presents a problem if you wish to use the root certificate of a commercial CA such as Thawte. If, for example, you specified Thawte’s root certificate in the –ca option, any certificate signed by Thawte would now be able to authenticate with your OpenVPN peer – certainly not what you would want.</p>
<p>Luckily there is a solution to this problem in the –tls-verify option. This option will allow you to execute a command to check the contents of a certificate, to fine-tune the selection of which certificate is allowed, and which is not. See the script verify-cn in the sample-scripts subdirectory for an example of how to do this, and also see the man page for the –tls-verify option.</p>
<p>使用 SSL/TLS 模式和 RSA 证书/密钥的配置文件<br>在我们的例子中，我们使用 OpenVPN 配置文件。OpenVPN 允许由命令行或一个或多个配置文件指定参数。在命令行中由”–”引导的参数在配置文件中是可以忽略”–”的，命令行中则不行。</p>
<p>设置下列配置文件：</p>
<hr>
<p>sample-config-files/tls-office.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for"><a href="#Sample-OpenVPN-configuration-file-for" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="office-using-SSL-TLS-mode-and-RSA-certificates-keys"><a href="#office-using-SSL-TLS-mode-and-RSA-certificates-keys" class="headerlink" title="office using SSL/TLS mode and RSA certificates/keys."></a>office using SSL/TLS mode and RSA certificates/keys.</h1><p>#</p>
<h1 id="‘-’-或-‘-’-用于表明注释"><a href="#‘-’-或-‘-’-用于表明注释" class="headerlink" title="‘#’ 或 ‘;’ 用于表明注释."></a>‘#’ 或 ‘;’ 用于表明注释.</h1><h1 id="使用-dynamic-tun-device"><a href="#使用-dynamic-tun-device" class="headerlink" title="使用 dynamic tun device."></a>使用 dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes"><a href="#For-Linux-2-2-or-non-Linux-OSes" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="你可以使用显式指明的设备号，比如”tun1”"><a href="#你可以使用显式指明的设备号，比如”tun1”" class="headerlink" title="你可以使用显式指明的设备号，比如”tun1”"></a>你可以使用显式指明的设备号，比如”tun1”</h1><h1 id="OpenVPN-也支持虚拟网络-“tap”-devices"><a href="#OpenVPN-也支持虚拟网络-“tap”-devices" class="headerlink" title="OpenVPN 也支持虚拟网络 “tap” devices;"></a>OpenVPN 也支持虚拟网络 “tap” devices;</h1><p>dev tun</p>
<h1 id="10-1-0-1-is-our-local-VPN-endpoint-office"><a href="#10-1-0-1-is-our-local-VPN-endpoint-office" class="headerlink" title="10.1.0.1 is our local VPN endpoint (office)."></a>10.1.0.1 is our local VPN endpoint (office).</h1><h1 id="10-1-0-2-is-our-remote-VPN-endpoint-home"><a href="#10-1-0-2-is-our-remote-VPN-endpoint-home" class="headerlink" title="10.1.0.2 is our remote VPN endpoint (home)."></a>10.1.0.2 is our remote VPN endpoint (home).</h1><p>ifconfig 10.1.0.1 10.1.0.2</p>
<h1 id="up-脚本将在-VPN-激活时建立路由"><a href="#up-脚本将在-VPN-激活时建立路由" class="headerlink" title="up 脚本将在 VPN 激活时建立路由"></a>up 脚本将在 VPN 激活时建立路由</h1><p>up ./office.up</p>
<h1 id="在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client"><a href="#在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client" class="headerlink" title="在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client"></a>在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client</h1><p>tls-server</p>
<h1 id="Diffie-Hellman-Parameters-tls-server-only"><a href="#Diffie-Hellman-Parameters-tls-server-only" class="headerlink" title="Diffie-Hellman Parameters (tls-server only)"></a>Diffie-Hellman Parameters (tls-server only)</h1><p>dh dh1024.pem</p>
<h1 id="Certificate-Authority-file"><a href="#Certificate-Authority-file" class="headerlink" title="Certificate Authority file"></a>Certificate Authority file</h1><p>ca my-ca.crt</p>
<h1 id="Our-certificate-public-key"><a href="#Our-certificate-public-key" class="headerlink" title="Our certificate/public key"></a>Our certificate/public key</h1><p>cert office.crt</p>
<h1 id="Our-private-key"><a href="#Our-private-key" class="headerlink" title="Our private key"></a>Our private key</h1><p>key office.key</p>
<h1 id="OpenVPN-缺省使用-UDP-端口-5000"><a href="#OpenVPN-缺省使用-UDP-端口-5000" class="headerlink" title="OpenVPN 缺省使用 UDP 端口 5000 ."></a>OpenVPN 缺省使用 UDP 端口 5000 .</h1><h1 id="每一个-OpenVPN-tunnel-必须使用一个不同的端口"><a href="#每一个-OpenVPN-tunnel-必须使用一个不同的端口" class="headerlink" title="每一个 OpenVPN tunnel 必须使用一个不同的端口."></a>每一个 OpenVPN tunnel 必须使用一个不同的端口.</h1><h1 id="lport-和-rport-被用于指明本地或远程的不同端口"><a href="#lport-和-rport-被用于指明本地或远程的不同端口" class="headerlink" title="lport 和 rport 被用于指明本地或远程的不同端口"></a>lport 和 rport 被用于指明本地或远程的不同端口</h1><p>; port 5000</p>
<h1 id="出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”"><a href="#出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”" class="headerlink" title="出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”"></a>出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”</h1><p>; user nobody<br>; group nobody</p>
<h1 id="如果你的OpenVPN支持LZO-压缩-去掉这一行的注释"><a href="#如果你的OpenVPN支持LZO-压缩-去掉这一行的注释" class="headerlink" title="如果你的OpenVPN支持LZO 压缩,去掉这一行的注释"></a>如果你的OpenVPN支持LZO 压缩,去掉这一行的注释</h1><p>; comp-lzo</p>
<p>#</p>
<h1 id="每15秒向远端主机发送一个-UDP-ping"><a href="#每15秒向远端主机发送一个-UDP-ping" class="headerlink" title="每15秒向远端主机发送一个 UDP ping"></a>每15秒向远端主机发送一个 UDP ping</h1><h1 id="stateful-firewall-connection"><a href="#stateful-firewall-connection" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this"><a href="#alive-Uncomment-this" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful"><a href="#out-if-you-are-using-a-stateful" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall"><a href="#firewall" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations"><a href="#travel-to-other-locations" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级"><a href="#信息细节等级" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。"><a href="#0-–-除非发生致命错误，否则保持安静。" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。"><a href="#1-–-非常安静，但会显示一些非致命网络错误。" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。"><a href="#3-–-中等输出，通常情况下的很好选择。" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。"><a href="#9-–-非常详细，用于诊断错误。" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/office.up</p>
<p>#!/bin/bash<br>route add -net 10.0.1.0 netmask 255.255.255.0 gw $5</p>
<hr>
<p>sample-config-files/tls-home.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for-1"><a href="#Sample-OpenVPN-configuration-file-for-1" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="home-using-SSL-TLS-mode-and-RSA-certificates-keys"><a href="#home-using-SSL-TLS-mode-and-RSA-certificates-keys" class="headerlink" title="home using SSL/TLS mode and RSA certificates/keys."></a>home using SSL/TLS mode and RSA certificates/keys.</h1><p>#</p>
<h1 id="‘-’-or-‘-’-may-be-used-to-delimit-comments"><a href="#‘-’-or-‘-’-may-be-used-to-delimit-comments" class="headerlink" title="‘#’ or ‘;’ may be used to delimit comments."></a>‘#’ or ‘;’ may be used to delimit comments.</h1><h1 id="Use-a-dynamic-tun-device"><a href="#Use-a-dynamic-tun-device" class="headerlink" title="Use a dynamic tun device."></a>Use a dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes-1"><a href="#For-Linux-2-2-or-non-Linux-OSes-1" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="you-may-want-to-use-an-explicit"><a href="#you-may-want-to-use-an-explicit" class="headerlink" title="you may want to use an explicit"></a>you may want to use an explicit</h1><h1 id="unit-number-such-as-“tun1”"><a href="#unit-number-such-as-“tun1”" class="headerlink" title="unit number such as “tun1”."></a>unit number such as “tun1”.</h1><h1 id="OpenVPN-also-supports-virtual"><a href="#OpenVPN-also-supports-virtual" class="headerlink" title="OpenVPN also supports virtual"></a>OpenVPN also supports virtual</h1><h1 id="ethernet-“tap”-devices"><a href="#ethernet-“tap”-devices" class="headerlink" title="ethernet “tap” devices."></a>ethernet “tap” devices.</h1><p>dev tun</p>
<h1 id="Our-OpenVPN-peer-is-the-office-gateway"><a href="#Our-OpenVPN-peer-is-the-office-gateway" class="headerlink" title="Our OpenVPN peer is the office gateway."></a>Our OpenVPN peer is the office gateway.</h1><p>remote 1.2.3.4</p>
<h1 id="10-1-0-2-is-our-local-VPN-endpoint-home"><a href="#10-1-0-2-is-our-local-VPN-endpoint-home" class="headerlink" title="10.1.0.2 is our local VPN endpoint (home)."></a>10.1.0.2 is our local VPN endpoint (home).</h1><h1 id="10-1-0-1-is-our-remote-VPN-endpoint-office"><a href="#10-1-0-1-is-our-remote-VPN-endpoint-office" class="headerlink" title="10.1.0.1 is our remote VPN endpoint (office)."></a>10.1.0.1 is our remote VPN endpoint (office).</h1><p>ifconfig 10.1.0.2 10.1.0.1</p>
<h1 id="Our-up-script-will-establish-routes"><a href="#Our-up-script-will-establish-routes" class="headerlink" title="Our up script will establish routes"></a>Our up script will establish routes</h1><h1 id="once-the-VPN-is-alive"><a href="#once-the-VPN-is-alive" class="headerlink" title="once the VPN is alive."></a>once the VPN is alive.</h1><p>up ./home.up</p>
<h1 id="在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client-1"><a href="#在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client-1" class="headerlink" title="在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client"></a>在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client</h1><p>tls-client</p>
<h1 id="Certificate-Authority-file-1"><a href="#Certificate-Authority-file-1" class="headerlink" title="Certificate Authority file"></a>Certificate Authority file</h1><p>ca my-ca.crt</p>
<h1 id="Our-certificate-public-key-1"><a href="#Our-certificate-public-key-1" class="headerlink" title="Our certificate/public key"></a>Our certificate/public key</h1><p>cert home.crt</p>
<h1 id="Our-private-key-1"><a href="#Our-private-key-1" class="headerlink" title="Our private key"></a>Our private key</h1><p>key home.key</p>
<h1 id="OpenVPN-缺省使用-UDP-端口-5000-1"><a href="#OpenVPN-缺省使用-UDP-端口-5000-1" class="headerlink" title="OpenVPN 缺省使用 UDP 端口 5000 ."></a>OpenVPN 缺省使用 UDP 端口 5000 .</h1><h1 id="每一个-OpenVPN-tunnel-必须使用一个不同的端口-1"><a href="#每一个-OpenVPN-tunnel-必须使用一个不同的端口-1" class="headerlink" title="每一个 OpenVPN tunnel 必须使用一个不同的端口."></a>每一个 OpenVPN tunnel 必须使用一个不同的端口.</h1><h1 id="lport-和-rport-被用于指明本地或远程的不同端口-1"><a href="#lport-和-rport-被用于指明本地或远程的不同端口-1" class="headerlink" title="lport 和 rport 被用于指明本地或远程的不同端口"></a>lport 和 rport 被用于指明本地或远程的不同端口</h1><p>; port 5000</p>
<h1 id="出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”-1"><a href="#出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”-1" class="headerlink" title="出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”"></a>出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”</h1><p>; user nobody<br>; group nobody</p>
<h1 id="如果你的OpenVPN支持LZO-压缩-去掉这一行的注释-1"><a href="#如果你的OpenVPN支持LZO-压缩-去掉这一行的注释-1" class="headerlink" title="如果你的OpenVPN支持LZO 压缩,去掉这一行的注释"></a>如果你的OpenVPN支持LZO 压缩,去掉这一行的注释</h1><p>; comp-lzo</p>
<h1 id="每15秒向远端主机发送一个-UDP-ping-1"><a href="#每15秒向远端主机发送一个-UDP-ping-1" class="headerlink" title="每15秒向远端主机发送一个 UDP ping"></a>每15秒向远端主机发送一个 UDP ping</h1><h1 id="stateful-firewall-connection-1"><a href="#stateful-firewall-connection-1" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this-1"><a href="#alive-Uncomment-this-1" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful-1"><a href="#out-if-you-are-using-a-stateful-1" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall-1"><a href="#firewall-1" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system-1"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-1" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that-1"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that-1" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations-1"><a href="#travel-to-other-locations-1" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级-1"><a href="#信息细节等级-1" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。-1"><a href="#0-–-除非发生致命错误，否则保持安静。-1" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。-1"><a href="#1-–-非常安静，但会显示一些非致命网络错误。-1" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。-1"><a href="#3-–-中等输出，通常情况下的很好选择。-1" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。-1"><a href="#9-–-非常详细，用于诊断错误。-1" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/home.up</p>
<p>#!/bin/bash<br>route add -net 10.0.0.0 netmask 255.255.255.0 gw $5</p>
<p>创建一个预分享静态密钥(Pre-Shared Static Key)<br>同 RSA 密钥管理极为不同的是，使用预分享静态密钥是十分简单。The major downside of using static keys is that you give up the notion of perfect forward secrecy, meaning that if an attacker steals your static key, everything that was ever encrypted with it is compromised.</p>
<p>使用如下命令生成静态密钥：</p>
<p>openvpn –genkey –secret static.key<br>静态密钥文件由ascii组成，就像下面这样：</p>
<p>—–BEGIN OpenVPN Static key V1—–<br>e5e4d6af39289d53<br>171ecc237a8f996a<br>97743d146661405e<br>c724d5913c550a0c<br>30a48e52dfbeceb6<br>e2e7bd4a8357df78<br>4609fe35bbe99c32<br>bdf974952ade8fb9<br>71c204aaf4f256ba<br>eeda7aed4822ff98<br>fd66da2efa9bf8c5<br>e70996353e0f96a9<br>c94c9f9afb17637b<br>283da25cc99b37bf<br>6f7e15b38aedc3e8<br>e6adb40fca5c5463<br>—–END OpenVPN Static key V1—–</p>
<p>一个 OpenVPN 静态密钥包含有足够的熵值，其中512位作为加密键，512位作为身份验证的 HMAC。（An OpenVPN static key file contains enough entropy to key both a 512 bit cipher key and a 512 bit HMAC key for authentication.）</p>
<p>通过安全的媒介将 static.key 拷贝到另一端(peer)，比如使用scp 或 ssh 中的拷贝、粘贴。</p>
<p>使用预共享静态密钥(Pre-Shared Static Key)的配置文件<br>在我们的例子中，我们使用 OpenVPN 配置文件。OpenVPN 允许由命令行或一个或多个配置文件指定参数。在命令行中由”–”引导的参数在配置文件中是可以忽略”–”的，命令行中则不行。</p>
<p>Set up the following configuration files:</p>
<hr>
<p>sample-config-files/static-office.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for-2"><a href="#Sample-OpenVPN-configuration-file-for-2" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="office-using-a-pre-shared-static-key"><a href="#office-using-a-pre-shared-static-key" class="headerlink" title="office using a pre-shared static key."></a>office using a pre-shared static key.</h1><p>#</p>
<h1 id="‘-’-or-‘-’-may-be-used-to-delimit-comments-1"><a href="#‘-’-or-‘-’-may-be-used-to-delimit-comments-1" class="headerlink" title="‘#’ or ‘;’ may be used to delimit comments."></a>‘#’ or ‘;’ may be used to delimit comments.</h1><h1 id="Use-a-dynamic-tun-device-1"><a href="#Use-a-dynamic-tun-device-1" class="headerlink" title="Use a dynamic tun device."></a>Use a dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes-2"><a href="#For-Linux-2-2-or-non-Linux-OSes-2" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="you-may-want-to-use-an-explicit-1"><a href="#you-may-want-to-use-an-explicit-1" class="headerlink" title="you may want to use an explicit"></a>you may want to use an explicit</h1><h1 id="unit-number-such-as-“tun1”-1"><a href="#unit-number-such-as-“tun1”-1" class="headerlink" title="unit number such as “tun1”."></a>unit number such as “tun1”.</h1><h1 id="OpenVPN-also-supports-virtual-1"><a href="#OpenVPN-also-supports-virtual-1" class="headerlink" title="OpenVPN also supports virtual"></a>OpenVPN also supports virtual</h1><h1 id="ethernet-“tap”-devices-1"><a href="#ethernet-“tap”-devices-1" class="headerlink" title="ethernet “tap” devices."></a>ethernet “tap” devices.</h1><p>dev tun</p>
<h1 id="10-1-0-1-is-our-local-VPN-endpoint-office-1"><a href="#10-1-0-1-is-our-local-VPN-endpoint-office-1" class="headerlink" title="10.1.0.1 is our local VPN endpoint (office)."></a>10.1.0.1 is our local VPN endpoint (office).</h1><h1 id="10-1-0-2-is-our-remote-VPN-endpoint-home-1"><a href="#10-1-0-2-is-our-remote-VPN-endpoint-home-1" class="headerlink" title="10.1.0.2 is our remote VPN endpoint (home)."></a>10.1.0.2 is our remote VPN endpoint (home).</h1><p>ifconfig 10.1.0.1 10.1.0.2</p>
<h1 id="Our-up-script-will-establish-routes-1"><a href="#Our-up-script-will-establish-routes-1" class="headerlink" title="Our up script will establish routes"></a>Our up script will establish routes</h1><h1 id="once-the-VPN-is-alive-1"><a href="#once-the-VPN-is-alive-1" class="headerlink" title="once the VPN is alive."></a>once the VPN is alive.</h1><p>up ./office.up</p>
<h1 id="Our-pre-shared-static-key"><a href="#Our-pre-shared-static-key" class="headerlink" title="Our pre-shared static key"></a>Our pre-shared static key</h1><p>secret static.key</p>
<h1 id="OpenVPN-uses-UDP-port-5000-by-default"><a href="#OpenVPN-uses-UDP-port-5000-by-default" class="headerlink" title="OpenVPN uses UDP port 5000 by default."></a>OpenVPN uses UDP port 5000 by default.</h1><h1 id="Each-OpenVPN-tunnel-must-use"><a href="#Each-OpenVPN-tunnel-must-use" class="headerlink" title="Each OpenVPN tunnel must use"></a>Each OpenVPN tunnel must use</h1><h1 id="a-different-port-number"><a href="#a-different-port-number" class="headerlink" title="a different port number."></a>a different port number.</h1><h1 id="lport-or-rport-can-be-used"><a href="#lport-or-rport-can-be-used" class="headerlink" title="lport or rport can be used"></a>lport or rport can be used</h1><h1 id="to-denote-different-ports"><a href="#to-denote-different-ports" class="headerlink" title="to denote different ports"></a>to denote different ports</h1><h1 id="for-local-and-remote"><a href="#for-local-and-remote" class="headerlink" title="for local and remote."></a>for local and remote.</h1><p>; port 5000</p>
<h1 id="Downgrade-UID-and-GID-to"><a href="#Downgrade-UID-and-GID-to" class="headerlink" title="Downgrade UID and GID to"></a>Downgrade UID and GID to</h1><h1 id="“nobody”-after-initialization"><a href="#“nobody”-after-initialization" class="headerlink" title="“nobody” after initialization"></a>“nobody” after initialization</h1><h1 id="for-extra-security"><a href="#for-extra-security" class="headerlink" title="for extra security."></a>for extra security.</h1><p>; user nobody<br>; group nobody</p>
<h1 id="If-you-built-OpenVPN-with"><a href="#If-you-built-OpenVPN-with" class="headerlink" title="If you built OpenVPN with"></a>If you built OpenVPN with</h1><h1 id="LZO-compression-uncomment"><a href="#LZO-compression-uncomment" class="headerlink" title="LZO compression, uncomment"></a>LZO compression, uncomment</h1><h1 id="out-the-following-line"><a href="#out-the-following-line" class="headerlink" title="out the following line."></a>out the following line.</h1><p>; comp-lzo</p>
<h1 id="Send-a-UDP-ping-to-remote-once"><a href="#Send-a-UDP-ping-to-remote-once" class="headerlink" title="Send a UDP ping to remote once"></a>Send a UDP ping to remote once</h1><h1 id="every-15-seconds-to-keep"><a href="#every-15-seconds-to-keep" class="headerlink" title="every 15 seconds to keep"></a>every 15 seconds to keep</h1><h1 id="stateful-firewall-connection-2"><a href="#stateful-firewall-connection-2" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this-2"><a href="#alive-Uncomment-this-2" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful-2"><a href="#out-if-you-are-using-a-stateful-2" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall-2"><a href="#firewall-2" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system-2"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-2" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that-2"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that-2" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations-2"><a href="#travel-to-other-locations-2" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级-2"><a href="#信息细节等级-2" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。-2"><a href="#0-–-除非发生致命错误，否则保持安静。-2" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。-2"><a href="#1-–-非常安静，但会显示一些非致命网络错误。-2" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。-2"><a href="#3-–-中等输出，通常情况下的很好选择。-2" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。-2"><a href="#9-–-非常详细，用于诊断错误。-2" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/office.up</p>
<p>#!/bin/bash<br>route add -net 10.0.1.0 netmask 255.255.255.0 gw $5</p>
<hr>
<p>sample-config-files/static-home.conf</p>
<p>#</p>
<h1 id="Sample-OpenVPN-configuration-file-for-3"><a href="#Sample-OpenVPN-configuration-file-for-3" class="headerlink" title="Sample OpenVPN configuration file for"></a>Sample OpenVPN configuration file for</h1><h1 id="home-using-a-pre-shared-static-key"><a href="#home-using-a-pre-shared-static-key" class="headerlink" title="home using a pre-shared static key."></a>home using a pre-shared static key.</h1><p>#</p>
<h1 id="‘-’-or-‘-’-may-be-used-to-delimit-comments-2"><a href="#‘-’-or-‘-’-may-be-used-to-delimit-comments-2" class="headerlink" title="‘#’ or ‘;’ may be used to delimit comments."></a>‘#’ or ‘;’ may be used to delimit comments.</h1><h1 id="Use-a-dynamic-tun-device-2"><a href="#Use-a-dynamic-tun-device-2" class="headerlink" title="Use a dynamic tun device."></a>Use a dynamic tun device.</h1><h1 id="For-Linux-2-2-or-non-Linux-OSes-3"><a href="#For-Linux-2-2-or-non-Linux-OSes-3" class="headerlink" title="For Linux 2.2 or non-Linux OSes,"></a>For Linux 2.2 or non-Linux OSes,</h1><h1 id="you-may-want-to-use-an-explicit-2"><a href="#you-may-want-to-use-an-explicit-2" class="headerlink" title="you may want to use an explicit"></a>you may want to use an explicit</h1><h1 id="unit-number-such-as-“tun1”-2"><a href="#unit-number-such-as-“tun1”-2" class="headerlink" title="unit number such as “tun1”."></a>unit number such as “tun1”.</h1><h1 id="OpenVPN-also-supports-virtual-2"><a href="#OpenVPN-also-supports-virtual-2" class="headerlink" title="OpenVPN also supports virtual"></a>OpenVPN also supports virtual</h1><h1 id="ethernet-“tap”-devices-2"><a href="#ethernet-“tap”-devices-2" class="headerlink" title="ethernet “tap” devices."></a>ethernet “tap” devices.</h1><p>dev tun</p>
<h1 id="Our-OpenVPN-peer-is-the-office-gateway-1"><a href="#Our-OpenVPN-peer-is-the-office-gateway-1" class="headerlink" title="Our OpenVPN peer is the office gateway."></a>Our OpenVPN peer is the office gateway.</h1><p>remote 1.2.3.4</p>
<h1 id="10-1-0-2-is-our-local-VPN-endpoint-home-1"><a href="#10-1-0-2-is-our-local-VPN-endpoint-home-1" class="headerlink" title="10.1.0.2 is our local VPN endpoint (home)."></a>10.1.0.2 is our local VPN endpoint (home).</h1><h1 id="10-1-0-1-is-our-remote-VPN-endpoint-office-1"><a href="#10-1-0-1-is-our-remote-VPN-endpoint-office-1" class="headerlink" title="10.1.0.1 is our remote VPN endpoint (office)."></a>10.1.0.1 is our remote VPN endpoint (office).</h1><p>ifconfig 10.1.0.2 10.1.0.1</p>
<h1 id="Our-up-script-will-establish-routes-2"><a href="#Our-up-script-will-establish-routes-2" class="headerlink" title="Our up script will establish routes"></a>Our up script will establish routes</h1><h1 id="once-the-VPN-is-alive-2"><a href="#once-the-VPN-is-alive-2" class="headerlink" title="once the VPN is alive."></a>once the VPN is alive.</h1><p>up ./home.up</p>
<h1 id="Our-pre-shared-static-key-1"><a href="#Our-pre-shared-static-key-1" class="headerlink" title="Our pre-shared static key"></a>Our pre-shared static key</h1><p>secret static.key</p>
<h1 id="OpenVPN-uses-UDP-port-5000-by-default-1"><a href="#OpenVPN-uses-UDP-port-5000-by-default-1" class="headerlink" title="OpenVPN uses UDP port 5000 by default."></a>OpenVPN uses UDP port 5000 by default.</h1><h1 id="Each-OpenVPN-tunnel-must-use-1"><a href="#Each-OpenVPN-tunnel-must-use-1" class="headerlink" title="Each OpenVPN tunnel must use"></a>Each OpenVPN tunnel must use</h1><h1 id="a-different-port-number-1"><a href="#a-different-port-number-1" class="headerlink" title="a different port number."></a>a different port number.</h1><h1 id="lport-or-rport-can-be-used-1"><a href="#lport-or-rport-can-be-used-1" class="headerlink" title="lport or rport can be used"></a>lport or rport can be used</h1><h1 id="to-denote-different-ports-1"><a href="#to-denote-different-ports-1" class="headerlink" title="to denote different ports"></a>to denote different ports</h1><h1 id="for-local-and-remote-1"><a href="#for-local-and-remote-1" class="headerlink" title="for local and remote."></a>for local and remote.</h1><p>; port 5000</p>
<h1 id="Downgrade-UID-and-GID-to-1"><a href="#Downgrade-UID-and-GID-to-1" class="headerlink" title="Downgrade UID and GID to"></a>Downgrade UID and GID to</h1><h1 id="“nobody”-after-initialization-1"><a href="#“nobody”-after-initialization-1" class="headerlink" title="“nobody” after initialization"></a>“nobody” after initialization</h1><h1 id="for-extra-security-1"><a href="#for-extra-security-1" class="headerlink" title="for extra security."></a>for extra security.</h1><p>; user nobody<br>; group nobody</p>
<h1 id="If-you-built-OpenVPN-with-1"><a href="#If-you-built-OpenVPN-with-1" class="headerlink" title="If you built OpenVPN with"></a>If you built OpenVPN with</h1><h1 id="LZO-compression-uncomment-1"><a href="#LZO-compression-uncomment-1" class="headerlink" title="LZO compression, uncomment"></a>LZO compression, uncomment</h1><h1 id="out-the-following-line-1"><a href="#out-the-following-line-1" class="headerlink" title="out the following line."></a>out the following line.</h1><p>; comp-lzo</p>
<h1 id="Send-a-UDP-ping-to-remote-once-1"><a href="#Send-a-UDP-ping-to-remote-once-1" class="headerlink" title="Send a UDP ping to remote once"></a>Send a UDP ping to remote once</h1><h1 id="every-15-seconds-to-keep-1"><a href="#every-15-seconds-to-keep-1" class="headerlink" title="every 15 seconds to keep"></a>every 15 seconds to keep</h1><h1 id="stateful-firewall-connection-3"><a href="#stateful-firewall-connection-3" class="headerlink" title="stateful firewall connection"></a>stateful firewall connection</h1><h1 id="alive-Uncomment-this-3"><a href="#alive-Uncomment-this-3" class="headerlink" title="alive.  Uncomment this"></a>alive.  Uncomment this</h1><h1 id="out-if-you-are-using-a-stateful-3"><a href="#out-if-you-are-using-a-stateful-3" class="headerlink" title="out if you are using a stateful"></a>out if you are using a stateful</h1><h1 id="firewall-3"><a href="#firewall-3" class="headerlink" title="firewall."></a>firewall.</h1><p>; ping 15</p>
<h1 id="Uncomment-this-section-for-a-more-reliable-detection-when-a-system-3"><a href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-3" class="headerlink" title="Uncomment this section for a more reliable detection when a system"></a>Uncomment this section for a more reliable detection when a system</h1><h1 id="loses-its-connection-For-example-dial-ups-or-laptops-that-3"><a href="#loses-its-connection-For-example-dial-ups-or-laptops-that-3" class="headerlink" title="loses its connection.  For example, dial-ups or laptops that"></a>loses its connection.  For example, dial-ups or laptops that</h1><h1 id="travel-to-other-locations-3"><a href="#travel-to-other-locations-3" class="headerlink" title="travel to other locations."></a>travel to other locations.</h1><p>; ping 15<br>; ping-restart 45<br>; ping-timer-rem<br>; persist-tun<br>; persist-key</p>
<h1 id="信息细节等级-3"><a href="#信息细节等级-3" class="headerlink" title="信息细节等级"></a>信息细节等级</h1><h1 id="0-–-除非发生致命错误，否则保持安静。-3"><a href="#0-–-除非发生致命错误，否则保持安静。-3" class="headerlink" title="0 – 除非发生致命错误，否则保持安静。"></a>0 – 除非发生致命错误，否则保持安静。</h1><h1 id="1-–-非常安静，但会显示一些非致命网络错误。-3"><a href="#1-–-非常安静，但会显示一些非致命网络错误。-3" class="headerlink" title="1 – 非常安静，但会显示一些非致命网络错误。"></a>1 – 非常安静，但会显示一些非致命网络错误。</h1><h1 id="3-–-中等输出，通常情况下的很好选择。-3"><a href="#3-–-中等输出，通常情况下的很好选择。-3" class="headerlink" title="3 – 中等输出，通常情况下的很好选择。"></a>3 – 中等输出，通常情况下的很好选择。</h1><h1 id="9-–-非常详细，用于诊断错误。-3"><a href="#9-–-非常详细，用于诊断错误。-3" class="headerlink" title="9 – 非常详细，用于诊断错误。"></a>9 – 非常详细，用于诊断错误。</h1><p>verb 3</p>
<hr>
<p>sample-config-files/home.up</p>
<p>#!/bin/bash<br>route add -net 10.0.0.0 netmask 255.255.255.0 gw $5</p>
<p>在 SSL/TLS mode 下启动 VPN<br>Home 机器端，用如下命令启动 VPN ：</p>
<p>openvpn –config tls-home.conf<br>Office 端，用如下命令启动 VPN ：</p>
<p>openvpn –config tls-office.conf</p>
<p>在静态密钥模式(Static Key mode)下启动 VPN<br>Home 机器端，用如下命令启动 VPN ：</p>
<p>openvpn –config static-home.conf<br>Office 端，用如下命令启动 VPN ：</p>
<p>openvpn –config static-office.conf</p>
<p>测试 VPN<br>在 Home 机器上，可以通过 ping Office 主机（经过隧道）来测试 VPN：</p>
<p>ping 10.1.0.1<br>在 Office 机器上，可以通过 ping Home 主机（经过隧道）来测试 VPN：</p>
<p>ping 10.1.0.2<br>如果测试失败但无输出信息，可以编辑配置文件将 信息细节等级 调为8（将产生大量细节信息用于调试）。参考FAQ 获取更多错误处理信息。</p>
<p>如果测试通过，可以尝试经过隧道 ping 另一端子网中的机器（网关机器除外）来测试路由。基本上 10.0.1.0/24 子网中的任一机器可以访问 10.0.1.0/24 子网中的任意机器，反之亦然。</p>
<p>如果工作正常，恭喜你！如果不正常，你可以查看邮件列表 OpenVPN Mailing List 有没有相似问题。如果问题依旧，可以考虑贴到 openvpn-users 列表。</p>
<p>Make the VPN DHCP-aware<br>回想一下，在我们的网络配置中，Home是使用动态 IP，地址可以任意的变化。如果你的客户端(client daemon)使用 dhcpcd ，那写一个适应IP地址任意变化的脚本也是很容易的。这个脚本或许被命名为 /etc/dhcpc/dhcpcd-eth0.exe.</p>
<p>基本上你要作的就是将下面这一行加入脚本，其作用是向 OpenVPn daemon 发送一个SIGUSR1 或 SIGHUP 信号：</p>
<p>killall -HUP openvpn<br>当 OpenVPN 收到这个信号后会关闭连接随后再使用DHCP获取的新的IP重新与对端连接。</p>
<p>如果你连接的对端由于 DHCP 重置而改变IP地址，你也许会考虑使用 –float 选项。</p>
<p>DHCP 重置时也有可能是 SIGUSR1 起作用，相比SIGHUP 它会在OpenVPN子系统重置时提供更多的进程回收控制。–ping 和 –ping-restart 也会内在的产生SIGUSR1信号。</p>
<p>–persist-tun 选项实现重置时不需关闭重新打开 TUN 设备（这就为在DHCP上的隧道提供了一种无缝连接）。</p>
<p>–persist-remote-ip 选项实现在DHCP重置时会保留远端 IP 地址。这样就允许 OpenVPN 隧道的两端都可以为DHCP client。</p>
<p>–persist-key 选项实现在重启时不用重新读取密钥文件（这样就允许 OpenVPN daemon 在权限降为 –user 或 –group 时也能实现重启）。</p>
<p>在 动态IP 环境下使用 OpenVPN的 更多信息，可参考FAQ 。</p>
<p>OpenVPN 也能在如下环境使用:连接两端都为动态地址。</p>
<p>系统重启时自动启动 VPN<br>首先建立一个目录存放OpenVPN密钥和配置文件,如： /etc/openvpn.</p>
<p>选择使用TLS模式或静态密钥模式 ，将适当的 .conf, .up, .key, .pem, 和 .crt 文件拷入 目录/etc/openvpn.</p>
<p>保护你的 .key 文件：</p>
<p>chmod go-rwx /etc/openvpn/*.key<br>如果使用 Linux iptables，编辑防火墙配置文件 firewall.sh，将相应的变动拷入目录 /etc/openvpn.</p>
<p>创建类似如下的 startup 脚本：</p>
<hr>
<p>sample-config-files/openvpn-startup.sh</p>
<p>#!/bin/bash</p>
<h1 id="A-sample-OpenVPN-startup-script"><a href="#A-sample-OpenVPN-startup-script" class="headerlink" title="A sample OpenVPN startup script"></a>A sample OpenVPN startup script</h1><h1 id="for-Linux"><a href="#for-Linux" class="headerlink" title="for Linux."></a>for Linux.</h1><h1 id="openvpn-config-file-directory"><a href="#openvpn-config-file-directory" class="headerlink" title="openvpn config file directory"></a>openvpn config file directory</h1><p>dir=/etc/openvpn</p>
<h1 id="载入防火墙"><a href="#载入防火墙" class="headerlink" title="载入防火墙"></a>载入防火墙</h1><p>$dir/firewall.sh</p>
<h1 id="载入-TUN-TAP-kernel-module"><a href="#载入-TUN-TAP-kernel-module" class="headerlink" title="载入 TUN/TAP kernel module"></a>载入 TUN/TAP kernel module</h1><p>modprobe tun</p>
<h1 id="开启IP转发"><a href="#开启IP转发" class="headerlink" title="开启IP转发"></a>开启IP转发</h1><p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<h1 id="为每一个VPN隧道唤醒一个守护-daemon-模式的openvpn"><a href="#为每一个VPN隧道唤醒一个守护-daemon-模式的openvpn" class="headerlink" title="为每一个VPN隧道唤醒一个守护(daemon)模式的openvpn"></a>为每一个VPN隧道唤醒一个守护(daemon)模式的openvpn</h1><h1 id="Invoke-openvpn-for-each-VPN-tunnel"><a href="#Invoke-openvpn-for-each-VPN-tunnel" class="headerlink" title="Invoke openvpn for each VPN tunnel"></a>Invoke openvpn for each VPN tunnel</h1><h1 id="in-daemon-mode-Alternatively"><a href="#in-daemon-mode-Alternatively" class="headerlink" title="in daemon mode.  Alternatively,"></a>in daemon mode.  Alternatively,</h1><h1 id="you-could-remove-“–daemon”-from"><a href="#you-could-remove-“–daemon”-from" class="headerlink" title="you could remove “–daemon” from"></a>you could remove “–daemon” from</h1><h1 id="the-command-line-and-add-“daemon”"><a href="#the-command-line-and-add-“daemon”" class="headerlink" title="the command line and add “daemon”"></a>the command line and add “daemon”</h1><h1 id="to-the-config-file"><a href="#to-the-config-file" class="headerlink" title="to the config file."></a>to the config file.</h1><p>#</p>
<h1 id="Each-tunnel-should-run-on-a-separate"><a href="#Each-tunnel-should-run-on-a-separate" class="headerlink" title="Each tunnel should run on a separate"></a>Each tunnel should run on a separate</h1><h1 id="UDP-port-Use-the-“port”-option"><a href="#UDP-port-Use-the-“port”-option" class="headerlink" title="UDP port.  Use the “port” option"></a>UDP port.  Use the “port” option</h1><h1 id="to-control-this-Like-all-of"><a href="#to-control-this-Like-all-of" class="headerlink" title="to control this.  Like all of"></a>to control this.  Like all of</h1><h1 id="OpenVPN’s-options-you-can"><a href="#OpenVPN’s-options-you-can" class="headerlink" title="OpenVPN’s options, you can"></a>OpenVPN’s options, you can</h1><h1 id="specify-“–port-8000”-on-the-command"><a href="#specify-“–port-8000”-on-the-command" class="headerlink" title="specify “–port 8000” on the command"></a>specify “–port 8000” on the command</h1><h1 id="line-or-“port-8000”-in-the-config"><a href="#line-or-“port-8000”-in-the-config" class="headerlink" title="line or “port 8000” in the config"></a>line or “port 8000” in the config</h1><h1 id="file"><a href="#file" class="headerlink" title="file."></a>file.</h1><p>openvpn –cd $dir –daemon –config vpn1.conf<br>openvpn –cd $dir –daemon –config vpn2.conf<br>openvpn –cd $dir –daemon –config vpn2.conf</p>
<p>创建类似如下的 shutdown 脚本：</p>
<hr>
<p>sample-config-files/openvpn-shutdown.sh</p>
<p>#!/bin/bash</p>
<h1 id="stop-all-openvpn-processes"><a href="#stop-all-openvpn-processes" class="headerlink" title="stop all openvpn processes"></a>stop all openvpn processes</h1><p>killall -TERM openvpn</p>
<p>最后将 openvpn-startup.sh 和 openvpn-shutdown.sh 脚本添加到系统的 startup 和shutdown 脚本中 或拷贝到 /etc/init.d 目录.</p>
<p>管理多条 OpenVPN 隧道的 startup 和 shutdown<br>这里是一个/etc/init.d 下的脚本例子，它自动为 /etc/openvpn 下的每一个.conf 文件创建一条 OpenVPN 隧道。</p>
<p>该脚本在通过 RPM 安装 OpenVPN 时会缺省安装到机器上。</p>
<hr>
<p>sample-scripts/openvpn.init</p>
<p>#!/bin/sh<br>#</p>
<h1 id="openvpn-This-shell-script-takes-care-of-starting-and-stopping"><a href="#openvpn-This-shell-script-takes-care-of-starting-and-stopping" class="headerlink" title="openvpn       This shell script takes care of starting and stopping"></a>openvpn       This shell script takes care of starting and stopping</h1><h1 id="openvpn-on-RedHat-or-other-chkconfig-based-system"><a href="#openvpn-on-RedHat-or-other-chkconfig-based-system" class="headerlink" title="openvpn on RedHat or other chkconfig-based system."></a>openvpn on RedHat or other chkconfig-based system.</h1><p>#</p>
<h1 id="chkconfig-345-80-30"><a href="#chkconfig-345-80-30" class="headerlink" title="chkconfig: 345 80 30"></a>chkconfig: 345 80 30</h1><p>#</p>
<h1 id="描述-OpenVPN-is-a-robust-and-highly-flexible-tunneling-application-that"><a href="#描述-OpenVPN-is-a-robust-and-highly-flexible-tunneling-application-that" class="headerlink" title="描述:         OpenVPN is a robust and highly flexible tunneling application that"></a>描述:         OpenVPN is a robust and highly flexible tunneling application that</h1><h1 id="uses-all-of-the-encryption-authentication-and-certification-features"><a href="#uses-all-of-the-encryption-authentication-and-certification-features" class="headerlink" title="uses all of the encryption, authentication, and certification features"></a>uses all of the encryption, authentication, and certification features</h1><h1 id="of-the-OpenSSL-library-to-securely-tunnel-IP-networks-over-a-single"><a href="#of-the-OpenSSL-library-to-securely-tunnel-IP-networks-over-a-single" class="headerlink" title="of the OpenSSL library to securely tunnel IP networks over a single"></a>of the OpenSSL library to securely tunnel IP networks over a single</h1><h1 id="UDP-port"><a href="#UDP-port" class="headerlink" title="UDP port."></a>UDP port.</h1><p>#</p>
<h1 id="Contributed-to-the-OpenVPN-project-by"><a href="#Contributed-to-the-OpenVPN-project-by" class="headerlink" title="Contributed to the OpenVPN project by"></a>Contributed to the OpenVPN project by</h1><h1 id="Douglas-Keller"><a href="#Douglas-Keller" class="headerlink" title="Douglas Keller"></a>Douglas Keller</h1><h1 id="2002-05-15"><a href="#2002-05-15" class="headerlink" title="2002.05.15"></a>2002.05.15</h1><h1 id="安装此脚本"><a href="#安装此脚本" class="headerlink" title="安装此脚本:"></a>安装此脚本:</h1><h1 id="将这个文件拷贝到-etc-rc-d-init-d-openvpn"><a href="#将这个文件拷贝到-etc-rc-d-init-d-openvpn" class="headerlink" title="将这个文件拷贝到 /etc/rc.d/init.d/openvpn"></a>将这个文件拷贝到 /etc/rc.d/init.d/openvpn</h1><h1 id="shell-gt-chkconfig-–add-openvpn"><a href="#shell-gt-chkconfig-–add-openvpn" class="headerlink" title="shell&gt; chkconfig –add openvpn"></a>shell&gt; chkconfig –add openvpn</h1><h1 id="shell-gt-mkdir-etc-openvpn"><a href="#shell-gt-mkdir-etc-openvpn" class="headerlink" title="shell&gt; mkdir /etc/openvpn"></a>shell&gt; mkdir /etc/openvpn</h1><h1 id="make-conf-or-sh-files-in-etc-openvpn-see-below"><a href="#make-conf-or-sh-files-in-etc-openvpn-see-below" class="headerlink" title="make .conf or .sh files in /etc/openvpn (see below)"></a>make .conf or .sh files in /etc/openvpn (see below)</h1><h1 id="删除此脚本"><a href="#删除此脚本" class="headerlink" title="删除此脚本:"></a>删除此脚本:</h1><h1 id="运行-chkconfig-–del-openvpn"><a href="#运行-chkconfig-–del-openvpn" class="headerlink" title="运行: chkconfig –del openvpn"></a>运行: chkconfig –del openvpn</h1><h1 id="作者提示"><a href="#作者提示" class="headerlink" title="作者提示:"></a>作者提示:</h1><p>#</p>
<h1 id="我已经写了一个-etc-init-d-初始化脚本并修改了-openvpn-spec-可以自动注册该脚本。"><a href="#我已经写了一个-etc-init-d-初始化脚本并修改了-openvpn-spec-可以自动注册该脚本。" class="headerlink" title="我已经写了一个 /etc/init.d 初始化脚本并修改了 openvpn.spec 可以自动注册该脚本。"></a>我已经写了一个 /etc/init.d 初始化脚本并修改了 openvpn.spec 可以自动注册该脚本。</h1><h1 id="RPM-包装好后你可以直接使用-“service-openvpn-start”-和-“service-openvpn-stop”"><a href="#RPM-包装好后你可以直接使用-“service-openvpn-start”-和-“service-openvpn-stop”" class="headerlink" title="RPM 包装好后你可以直接使用 “service openvpn start” 和 “service openvpn stop”."></a>RPM 包装好后你可以直接使用 “service openvpn start” 和 “service openvpn stop”.</h1><h1 id="命令启动和终止-OpenVPN"><a href="#命令启动和终止-OpenVPN" class="headerlink" title="命令启动和终止 OpenVPN."></a>命令启动和终止 OpenVPN.</h1><p>#</p>
<h1 id="初始化脚本工作如下："><a href="#初始化脚本工作如下：" class="headerlink" title="初始化脚本工作如下："></a>初始化脚本工作如下：</h1><p>#</p>
<h1 id="为它在-etc-openvpn下找到的每一个-conf-文件启动一个-openvpn-进程"><a href="#为它在-etc-openvpn下找到的每一个-conf-文件启动一个-openvpn-进程" class="headerlink" title="- 为它在/etc/openvpn下找到的每一个 .conf 文件启动一个 openvpn 进程"></a>- 为它在/etc/openvpn下找到的每一个 .conf 文件启动一个 openvpn 进程</h1><p>#</p>
<h1 id="如果存在对应于-xxx-conf-的-etc-openvpn-xxx-sh-文件，"><a href="#如果存在对应于-xxx-conf-的-etc-openvpn-xxx-sh-文件，" class="headerlink" title="- 如果存在对应于 xxx.conf 的 /etc/openvpn/xxx.sh 文件，"></a>- 如果存在对应于 xxx.conf 的 /etc/openvpn/xxx.sh 文件，</h1><h1 id="那么在它启动-openvpn-前执行它-作-openvpn-–mktun…-时很有用-。"><a href="#那么在它启动-openvpn-前执行它-作-openvpn-–mktun…-时很有用-。" class="headerlink" title="那么在它启动 openvpn 前执行它(作 openvpn –mktun… 时很有用)。"></a>那么在它启动 openvpn 前执行它(作 openvpn –mktun… 时很有用)。</h1><p>#</p>
<h1 id="除-start-stop-外还可以执行："><a href="#除-start-stop-外还可以执行：" class="headerlink" title="- 除 start/stop 外还可以执行："></a>- 除 start/stop 外还可以执行：</h1><p>#</p>
<h1 id="service-openvpn-reload-SIGHUP"><a href="#service-openvpn-reload-SIGHUP" class="headerlink" title="service openvpn reload - SIGHUP"></a>service openvpn reload - SIGHUP</h1><h1 id="service-openvpn-reopen-SIGUSR1"><a href="#service-openvpn-reopen-SIGUSR1" class="headerlink" title="service openvpn reopen - SIGUSR1"></a>service openvpn reopen - SIGUSR1</h1><h1 id="service-openvpn-status-SIGUSR2"><a href="#service-openvpn-status-SIGUSR2" class="headerlink" title="service openvpn status - SIGUSR2"></a>service openvpn status - SIGUSR2</h1><h1 id="Modifications-2003-05-02"><a href="#Modifications-2003-05-02" class="headerlink" title="Modifications 2003.05.02"></a>Modifications 2003.05.02</h1><h1 id="Changed-to-for-sh-compliance-Bishop-Clark"><a href="#Changed-to-for-sh-compliance-Bishop-Clark" class="headerlink" title="* Changed == to = for sh compliance (Bishop Clark)."></a>* Changed == to = for sh compliance (Bishop Clark).</h1><h1 id="If-condrestart-reload-reopen-status-check-that-we-were"><a href="#If-condrestart-reload-reopen-status-check-that-we-were" class="headerlink" title="* If condrestart|reload|reopen|status, check that we were"></a>* If condrestart|reload|reopen|status, check that we were</h1><h1 id="actually-started-James-Yonan"><a href="#actually-started-James-Yonan" class="headerlink" title="actually started (James Yonan)."></a>actually started (James Yonan).</h1><h1 id="Added-lock-piddir-and-work-variables-James-Yonan"><a href="#Added-lock-piddir-and-work-variables-James-Yonan" class="headerlink" title="* Added lock, piddir, and work variables (James Yonan)."></a>* Added lock, piddir, and work variables (James Yonan).</h1><h1 id="If-start-is-attempted-twice-without-an-intervening-stop-or"><a href="#If-start-is-attempted-twice-without-an-intervening-stop-or" class="headerlink" title="* If start is attempted twice, without an intervening stop, or"></a>* If start is attempted twice, without an intervening stop, or</h1><h1 id="if-start-is-attempted-when-previous-start-was-not-properly"><a href="#if-start-is-attempted-when-previous-start-was-not-properly" class="headerlink" title="if start is attempted when previous start was not properly"></a>if start is attempted when previous start was not properly</h1><h1 id="shut-down-then-kill-any-previously-started-processes-before"><a href="#shut-down-then-kill-any-previously-started-processes-before" class="headerlink" title="shut down, then kill any previously started processes, before"></a>shut down, then kill any previously started processes, before</h1><h1 id="commencing-new-start-operation-James-Yonan"><a href="#commencing-new-start-operation-James-Yonan" class="headerlink" title="commencing new start operation (James Yonan)."></a>commencing new start operation (James Yonan).</h1><h1 id="Do-a-better-job-of-flagging-errors-on-start-and-properly"><a href="#Do-a-better-job-of-flagging-errors-on-start-and-properly" class="headerlink" title="* Do a better job of flagging errors on start, and properly"></a>* Do a better job of flagging errors on start, and properly</h1><h1 id="returning-success-or-failure-status-to-caller-James-Yonan"><a href="#returning-success-or-failure-status-to-caller-James-Yonan" class="headerlink" title="returning success or failure status to caller (James Yonan)."></a>returning success or failure status to caller (James Yonan).</h1><h1 id="Location-of-openvpn-binary"><a href="#Location-of-openvpn-binary" class="headerlink" title="Location of openvpn binary"></a>Location of openvpn binary</h1><p>openvpn=”/usr/sbin/openvpn”</p>
<h1 id="Lockfile"><a href="#Lockfile" class="headerlink" title="Lockfile"></a>Lockfile</h1><p>lock=”/var/lock/subsys/openvpn”</p>
<h1 id="PID-directory"><a href="#PID-directory" class="headerlink" title="PID directory"></a>PID directory</h1><p>piddir=”/var/run/openvpn”</p>
<h1 id="Our-working-directory"><a href="#Our-working-directory" class="headerlink" title="Our working directory"></a>Our working directory</h1><p>work=/etc/openvpn</p>
<h1 id="Source-function-library"><a href="#Source-function-library" class="headerlink" title="Source function library."></a>Source function library.</h1><p>. /etc/rc.d/init.d/functions</p>
<h1 id="Source-networking-configuration"><a href="#Source-networking-configuration" class="headerlink" title="Source networking configuration."></a>Source networking configuration.</h1><p>. /etc/sysconfig/network</p>
<h1 id="Check-that-networking-is-up"><a href="#Check-that-networking-is-up" class="headerlink" title="Check that networking is up."></a>Check that networking is up.</h1><p>[ ${NETWORKING} = “no” ] &amp;&amp; exit 0</p>
<p>[ -f  $openvpn ] || exit 0</p>
<h1 id="See-how-we-were-called"><a href="#See-how-we-were-called" class="headerlink" title="See how we were called."></a>See how we were called.</h1><p>case “$1” in<br>start)<br>echo -n $”Starting openvpn: “</p>
<p>/sbin/modprobe tun &gt;/dev/null 2&gt;&amp;1</p>
<h1 id="From-a-security-perspective-I-think-it-makes"><a href="#From-a-security-perspective-I-think-it-makes" class="headerlink" title="From a security perspective, I think it makes"></a>From a security perspective, I think it makes</h1><h1 id="sense-to-remove-this-and-have-users-who-need"><a href="#sense-to-remove-this-and-have-users-who-need" class="headerlink" title="sense to remove this, and have users who need"></a>sense to remove this, and have users who need</h1><h1 id="it-explictly-enable-in-their-–up-scripts-or"><a href="#it-explictly-enable-in-their-–up-scripts-or" class="headerlink" title="it explictly enable in their –up scripts or"></a>it explictly enable in their –up scripts or</h1><h1 id="firewall-setups"><a href="#firewall-setups" class="headerlink" title="firewall setups."></a>firewall setups.</h1><p>#echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<p>if [ ! -d  $piddir ]; then<br>mkdir $piddir<br>fi</p>
<p>if [ -f $lock ]; then</p>
<h1 id="we-were-not-shut-down-correctly"><a href="#we-were-not-shut-down-correctly" class="headerlink" title="we were not shut down correctly"></a>we were not shut down correctly</h1><p>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>rm -f $pidf<br>done<br>rm -f $lock<br>sleep 2<br>fi</p>
<p>rm -f $piddir/*.pid<br>cd $work</p>
<h1 id="Start-every-conf-in-work-and-run-sh-if-exists"><a href="#Start-every-conf-in-work-and-run-sh-if-exists" class="headerlink" title="Start every .conf in $work and run .sh if exists"></a>Start every .conf in $work and run .sh if exists</h1><p>errors=0<br>successes=0<br>for c in <code>/bin/ls *.conf 2&amp;gt;/dev/null</code>; do<br>bn=${c%%.conf}<br>if [ -f “$bn.sh” ]; then<br>. $bn.sh<br>fi<br>rm -f $piddir/$bn.pid<br>$openvpn –daemon –writepid $piddir/$bn.pid –config $c –cd $work<br>if [ $? = 0 ]; then<br>successes=1<br>else<br>errors=1<br>fi<br>done</p>
<p>if [ $errors = 1 ]; then<br>failure; echo<br>else<br>success; echo<br>fi</p>
<p>if [ $successes = 1 ]; then<br>touch $lock<br>fi<br>;;<br>stop)<br>echo -n $”Shutting down openvpn: “<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>rm -f $pidf<br>done<br>success; echo<br>rm -f $lock<br>;;<br>restart)<br>$0 stop<br>sleep 2<br>$0 start<br>;;<br>reload)<br>if [ -f $lock ]; then<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill -HUP <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>done<br>else<br>echo “openvpn: service not started”<br>exit 1<br>fi<br>;;<br>reopen)<br>if [ -f $lock ]; then<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill -USR1 <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>done<br>else<br>echo “openvpn: service not started”<br>exit 1<br>fi<br>;;<br>condrestart)<br>if [ -f $lock ]; then<br>$0 stop</p>
<h1 id="avoid-race"><a href="#avoid-race" class="headerlink" title="avoid race"></a>avoid race</h1><p>sleep 2<br>$0 start<br>fi<br>;;<br>status)<br>if [ -f $lock ]; then<br>for pidf in <code>/bin/ls $piddir/*.pid 2&amp;gt;/dev/null</code>; do<br>if [ -s $pidf ]; then<br>kill -USR2 <code>cat $pidf</code> &gt;/dev/null 2&gt;&amp;1<br>fi<br>done<br>echo “Status written to /var/log/messages”<br>else<br>echo “openvpn: service not started”<br>exit 1<br>fi<br>;;<br>*)<br>echo “Usage: openvpn {start|stop|restart|condrestart|reload|reopen|status}”<br>exit 1<br>esac</p>
<p>exit 0</p>
<p>用inetd或xinetd衍生(instantiate)一个 OpenVPN daemon<br>通用服务进程 xinetd 能够响应远端节点发送的初始数据报，自动衍生一个 OpenVPN daemon 。</p>
<p>此 xinetd 配置会使 xinetd 进程监听 UDP 端口 5000，当流入一个 OpenVPN session (使用 pre-shared key)的数据报时，xinetd 自动衍生一个 OpenVPN daemon来处理此 session。注意使用 –inactive 参数会使 OpenVPN daemon 在发呆10分钟后超时退出。无论何种原因一旦OpenVPN daemon 退出，xinetd 服务会重新监听端口等待新的连接。另外要注意 xinetd 使用 root 权限衍生 OpenVPN daemon，但随后(读取受保护的密钥文件后) OpenVPN 会将权限降为 nobody 。</p>
<p>可用如下命令生成密钥(key)文件：</p>
<p>openvpn –genkey –secret key<br>注意每一条新的 OpenVPN 隧道都有它独自的端口，同时也有它自己的 xinetd 配置文件。这是因为OpenVPN 对每一个潜在的接入者需要特定的信息，包括key文件，TUN/TAP 设备，隧道节点(endpoints)，和路由配置。基于这种观点在 OpenVPN 的发展中，它从不使用单个配置文件来处理一大批类似的潜在接入者，即它没有描述接入的模板文件。从OpenVPN 作为一个UDP server 实现以来，它不具有TCP server可监听一个固定端口同时可 fork 一个新的 daemon 来动态处理客户连接的优点。尽管如此，接入模板的实现已进入预期计划，只要得到开发者和最终用户社区的足够注意和支持，它一定会实现的。</p>
<hr>
<p>sample-config-files/xinetd-server-config</p>
<h1 id="An-xinetd-configuration-file-for-OpenVPN"><a href="#An-xinetd-configuration-file-for-OpenVPN" class="headerlink" title="An xinetd configuration file for OpenVPN."></a>An xinetd configuration file for OpenVPN.</h1><p>#</p>
<h1 id="This-file-should-be-renamed-to-openvpn-or-something-suitably"><a href="#This-file-should-be-renamed-to-openvpn-or-something-suitably" class="headerlink" title="This file should be renamed to openvpn or something suitably"></a>This file should be renamed to openvpn or something suitably</h1><h1 id="descriptive-and-copied-to-the-etc-xinetd-d-directory"><a href="#descriptive-and-copied-to-the-etc-xinetd-d-directory" class="headerlink" title="descriptive and copied to the /etc/xinetd.d directory."></a>descriptive and copied to the /etc/xinetd.d directory.</h1><h1 id="xinetd-can-then-be-made-aware-of-this-file-by-restarting"><a href="#xinetd-can-then-be-made-aware-of-this-file-by-restarting" class="headerlink" title="xinetd can then be made aware of this file by restarting"></a>xinetd can then be made aware of this file by restarting</h1><h1 id="it-or-sending-it-a-SIGHUP-signal"><a href="#it-or-sending-it-a-SIGHUP-signal" class="headerlink" title="it or sending it a SIGHUP signal."></a>it or sending it a SIGHUP signal.</h1><p>#</p>
<h1 id="For-each-potential-incoming-client-create-a-separate-version"><a href="#For-each-potential-incoming-client-create-a-separate-version" class="headerlink" title="For each potential incoming client, create a separate version"></a>For each potential incoming client, create a separate version</h1><h1 id="of-this-configuration-file-on-a-unique-port-number-Also-note"><a href="#of-this-configuration-file-on-a-unique-port-number-Also-note" class="headerlink" title="of this configuration file on a unique port number.  Also note"></a>of this configuration file on a unique port number.  Also note</h1><h1 id="that-the-key-file-and-ifconfig-endpoints-should-be-unique-for"><a href="#that-the-key-file-and-ifconfig-endpoints-should-be-unique-for" class="headerlink" title="that the key file and ifconfig endpoints should be unique for"></a>that the key file and ifconfig endpoints should be unique for</h1><h1 id="each-client-This-configuration-assumes-that-the-OpenVPN"><a href="#each-client-This-configuration-assumes-that-the-OpenVPN" class="headerlink" title="each client.  This configuration assumes that the OpenVPN"></a>each client.  This configuration assumes that the OpenVPN</h1><h1 id="executable-and-key-live-in-root-openvpn-Change-this-to-fit"><a href="#executable-and-key-live-in-root-openvpn-Change-this-to-fit" class="headerlink" title="executable and key live in /root/openvpn.  Change this to fit"></a>executable and key live in /root/openvpn.  Change this to fit</h1><h1 id="your-environment"><a href="#your-environment" class="headerlink" title="your environment."></a>your environment.</h1><p>service openvpn_1<br>{<br>type            = UNLISTED<br>port            = 5000<br>socket_type     = dgram<br>protocol        = udp<br>wait            = yes<br>user            = root<br>server          = /root/openvpn/openvpn<br>server_args     = –inetd –dev tun –ifconfig 10.4.0.2 10.4.0.1 –secret /root/openvpn/key –inactive 600 –user nobody<br>}</p>
<hr>
<p>sample-config-files/xinetd-client-config</p>
<h1 id="This-OpenVPN-config-file"><a href="#This-OpenVPN-config-file" class="headerlink" title="This OpenVPN config file"></a>This OpenVPN config file</h1><h1 id="is-the-client-side-counterpart"><a href="#is-the-client-side-counterpart" class="headerlink" title="is the client side counterpart"></a>is the client side counterpart</h1><h1 id="of-xinetd-server-config"><a href="#of-xinetd-server-config" class="headerlink" title="of xinetd-server-config"></a>of xinetd-server-config</h1><p>dev tun<br>ifconfig 10.4.0.1 10.4.0.2<br>remote my-server<br>port 5000<br>user nobody<br>secret /root/openvpn/key<br>inactive 600</p>
<hr>
<p>Copyright (C) 2002-2004 by James Yonan . 此文档于 GNU Free Documentation License Version 1.2 协议下发布.</p>
<p>中文翻译：liyi</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2010/12/30/ Iptables 指南 1.1.19/" rel="next" title="Iptables 指南 1.1.19">
                <i class="fa fa-chevron-left"></i> Iptables 指南 1.1.19
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2010/12/31/WordPress自动升级插件时需要填写FTP信息的解决/" rel="prev" title="WordPress自动升级插件时需要填写FTP信息的解决">
                WordPress自动升级插件时需要填写FTP信息的解决 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Wooley Gu" />
          <p class="site-author-name" itemprop="name">Wooley Gu</p>
          <p class="site-description motion-element" itemprop="description">我将去向哪里</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">147</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">94</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://m.qxqy.net" title="栖霞棋院" target="_blank">栖霞棋院</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-aware-防火墙例子"><span class="nav-number">1.</span> <span class="nav-text">OpenVPN-aware 防火墙例子.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#eth0-连接到互联网"><span class="nav-number">2.</span> <span class="nav-text">eth0 连接到互联网.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#eth1-连接到内部子网"><span class="nav-number">3.</span> <span class="nav-text">eth1 连接到内部子网.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#这里改变你的子网地址"><span class="nav-number">4.</span> <span class="nav-text">这里改变你的子网地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Home-使用-10-0-1-0-24"><span class="nav-number">5.</span> <span class="nav-text">Home   使用 10.0.1.0/24</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Office-使用-10-0-0-0-24"><span class="nav-number">6.</span> <span class="nav-text">Office 使用 10.0.0.0/24</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Loopback-地址"><span class="nav-number">7.</span> <span class="nav-text">Loopback 地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#删除旧的-iptables-规则"><span class="nav-number">8.</span> <span class="nav-text">删除旧的 iptables 规则</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#并且临时阻塞网络通信"><span class="nav-number">9.</span> <span class="nav-text">并且临时阻塞网络通信</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#设置缺省策略"><span class="nav-number">10.</span> <span class="nav-text">设置缺省策略</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#阻止外部数据包使用-loopback-地址"><span class="nav-number">11.</span> <span class="nav-text">阻止外部数据包使用 loopback 地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#任何从互联网流入的数据包都必须使用真实互联网地址"><span class="nav-number">12.</span> <span class="nav-text">任何从互联网流入的数据包都必须使用真实互联网地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#阻塞-NetBios-数据包流出-如果内网有-windows-机器-。"><span class="nav-number">13.</span> <span class="nav-text">阻塞 NetBios 数据包流出(如果内网有 windows 机器)。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#这不会影响-VPN-隧道上的NetBios通信，"><span class="nav-number">14.</span> <span class="nav-text">这不会影响 VPN 隧道上的NetBios通信，</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#但它会阻止本地-windows-机器向互联网广播自己。"><span class="nav-number">15.</span> <span class="nav-text">但它会阻止本地 windows 机器向互联网广播自己。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#检查流向互联网的数据包中源地址的合法性"><span class="nav-number">16.</span> <span class="nav-text">检查流向互联网的数据包中源地址的合法性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#允许本地-loopback"><span class="nav-number">17.</span> <span class="nav-text">允许本地 loopback</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#允许向内的-incoming-ping-操作-可以禁止"><span class="nav-number">18.</span> <span class="nav-text">允许向内的(incoming) ping 操作(可以禁止)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#允许-www-和-ssh-服务-可以禁止"><span class="nav-number">19.</span> <span class="nav-text">允许 www 和 ssh 服务(可以禁止)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#允许向内的-incoming-OpenVPN-数据包"><span class="nav-number">20.</span> <span class="nav-text">允许向内的(incoming) OpenVPN 数据包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#对于每条-OpenVPN-隧道要将以下每行重复，"><span class="nav-number">21.</span> <span class="nav-text">对于每条 OpenVPN 隧道要将以下每行重复，</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#改变-–dport-n-为-OpenVPN-UDP-实际端口。"><span class="nav-number">22.</span> <span class="nav-text">改变 –dport n 为 OpenVPN UDP 实际端口。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在-OpenVPN中，端口号由-–port-n-选项控制。"><span class="nav-number">23.</span> <span class="nav-text">在 OpenVPN中，端口号由 –port n 选项控制。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如果你将这个选型写入配置文件，"><span class="nav-number">24.</span> <span class="nav-text">如果你将这个选型写入配置文件，</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#你可以去掉-‘–’后这一串字符。"><span class="nav-number">25.</span> <span class="nav-text">你可以去掉 ‘–’后这一串字符。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#If-you-taking-the-stateful-firewall"><span class="nav-number">26.</span> <span class="nav-text">If you taking the stateful firewall</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#approach-参看-OpenVPN-HOWTO"><span class="nav-number">27.</span> <span class="nav-text">approach (参看 OpenVPN HOWTO),</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#那么注释掉下面这一行。"><span class="nav-number">28.</span> <span class="nav-text">那么注释掉下面这一行。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#允许来自-TUN-TAP-设备的数据包。"><span class="nav-number">29.</span> <span class="nav-text">允许来自 TUN/TAP 设备的数据包。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#当-OpenVPN-运行于安全模式时，"><span class="nav-number">30.</span> <span class="nav-text">当 OpenVPN 运行于安全模式时，</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#他会对-tun-或-tap-接口上的数据包到达前进行验证。"><span class="nav-number">31.</span> <span class="nav-text">他会对 tun 或 tap 接口上的数据包到达前进行验证。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#也就是说，这里添加的任何过滤不是必需的，"><span class="nav-number">32.</span> <span class="nav-text">也就是说，这里添加的任何过滤不是必需的，</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#除非你想对有可能溢出隧道的数据包类型进行严格约束。"><span class="nav-number">33.</span> <span class="nav-text">除非你想对有可能溢出隧道的数据包类型进行严格约束。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#允许来自内网的数据包"><span class="nav-number">34.</span> <span class="nav-text">允许来自内网的数据包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#保持来自本机和内网数据包的连接状态"><span class="nav-number">35.</span> <span class="nav-text">保持来自本机和内网数据包的连接状态</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#伪装本地子网"><span class="nav-number">36.</span> <span class="nav-text">伪装本地子网</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sample-OpenVPN-configuration-file-for"><span class="nav-number">37.</span> <span class="nav-text">Sample OpenVPN configuration file for</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#office-using-SSL-TLS-mode-and-RSA-certificates-keys"><span class="nav-number">38.</span> <span class="nav-text">office using SSL/TLS mode and RSA certificates/keys.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#‘-’-或-‘-’-用于表明注释"><span class="nav-number">39.</span> <span class="nav-text">‘#’ 或 ‘;’ 用于表明注释.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-dynamic-tun-device"><span class="nav-number">40.</span> <span class="nav-text">使用 dynamic tun device.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#For-Linux-2-2-or-non-Linux-OSes"><span class="nav-number">41.</span> <span class="nav-text">For Linux 2.2 or non-Linux OSes,</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#你可以使用显式指明的设备号，比如”tun1”"><span class="nav-number">42.</span> <span class="nav-text">你可以使用显式指明的设备号，比如”tun1”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-也支持虚拟网络-“tap”-devices"><span class="nav-number">43.</span> <span class="nav-text">OpenVPN 也支持虚拟网络 “tap” devices;</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-1-is-our-local-VPN-endpoint-office"><span class="nav-number">44.</span> <span class="nav-text">10.1.0.1 is our local VPN endpoint (office).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-2-is-our-remote-VPN-endpoint-home"><span class="nav-number">45.</span> <span class="nav-text">10.1.0.2 is our remote VPN endpoint (home).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#up-脚本将在-VPN-激活时建立路由"><span class="nav-number">46.</span> <span class="nav-text">up 脚本将在 VPN 激活时建立路由</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client"><span class="nav-number">47.</span> <span class="nav-text">在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Diffie-Hellman-Parameters-tls-server-only"><span class="nav-number">48.</span> <span class="nav-text">Diffie-Hellman Parameters (tls-server only)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Certificate-Authority-file"><span class="nav-number">49.</span> <span class="nav-text">Certificate Authority file</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-certificate-public-key"><span class="nav-number">50.</span> <span class="nav-text">Our certificate/public key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-private-key"><span class="nav-number">51.</span> <span class="nav-text">Our private key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-缺省使用-UDP-端口-5000"><span class="nav-number">52.</span> <span class="nav-text">OpenVPN 缺省使用 UDP 端口 5000 .</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#每一个-OpenVPN-tunnel-必须使用一个不同的端口"><span class="nav-number">53.</span> <span class="nav-text">每一个 OpenVPN tunnel 必须使用一个不同的端口.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lport-和-rport-被用于指明本地或远程的不同端口"><span class="nav-number">54.</span> <span class="nav-text">lport 和 rport 被用于指明本地或远程的不同端口</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”"><span class="nav-number">55.</span> <span class="nav-text">出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如果你的OpenVPN支持LZO-压缩-去掉这一行的注释"><span class="nav-number">56.</span> <span class="nav-text">如果你的OpenVPN支持LZO 压缩,去掉这一行的注释</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#每15秒向远端主机发送一个-UDP-ping"><span class="nav-number">57.</span> <span class="nav-text">每15秒向远端主机发送一个 UDP ping</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stateful-firewall-connection"><span class="nav-number">58.</span> <span class="nav-text">stateful firewall connection</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#alive-Uncomment-this"><span class="nav-number">59.</span> <span class="nav-text">alive.  Uncomment this</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#out-if-you-are-using-a-stateful"><span class="nav-number">60.</span> <span class="nav-text">out if you are using a stateful</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#firewall"><span class="nav-number">61.</span> <span class="nav-text">firewall.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system"><span class="nav-number">62.</span> <span class="nav-text">Uncomment this section for a more reliable detection when a system</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#loses-its-connection-For-example-dial-ups-or-laptops-that"><span class="nav-number">63.</span> <span class="nav-text">loses its connection.  For example, dial-ups or laptops that</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#travel-to-other-locations"><span class="nav-number">64.</span> <span class="nav-text">travel to other locations.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#信息细节等级"><span class="nav-number">65.</span> <span class="nav-text">信息细节等级</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0-–-除非发生致命错误，否则保持安静。"><span class="nav-number">66.</span> <span class="nav-text">0 – 除非发生致命错误，否则保持安静。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-–-非常安静，但会显示一些非致命网络错误。"><span class="nav-number">67.</span> <span class="nav-text">1 – 非常安静，但会显示一些非致命网络错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-–-中等输出，通常情况下的很好选择。"><span class="nav-number">68.</span> <span class="nav-text">3 – 中等输出，通常情况下的很好选择。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-–-非常详细，用于诊断错误。"><span class="nav-number">69.</span> <span class="nav-text">9 – 非常详细，用于诊断错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sample-OpenVPN-configuration-file-for-1"><span class="nav-number">70.</span> <span class="nav-text">Sample OpenVPN configuration file for</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#home-using-SSL-TLS-mode-and-RSA-certificates-keys"><span class="nav-number">71.</span> <span class="nav-text">home using SSL/TLS mode and RSA certificates/keys.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#‘-’-or-‘-’-may-be-used-to-delimit-comments"><span class="nav-number">72.</span> <span class="nav-text">‘#’ or ‘;’ may be used to delimit comments.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-a-dynamic-tun-device"><span class="nav-number">73.</span> <span class="nav-text">Use a dynamic tun device.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#For-Linux-2-2-or-non-Linux-OSes-1"><span class="nav-number">74.</span> <span class="nav-text">For Linux 2.2 or non-Linux OSes,</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#you-may-want-to-use-an-explicit"><span class="nav-number">75.</span> <span class="nav-text">you may want to use an explicit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unit-number-such-as-“tun1”"><span class="nav-number">76.</span> <span class="nav-text">unit number such as “tun1”.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-also-supports-virtual"><span class="nav-number">77.</span> <span class="nav-text">OpenVPN also supports virtual</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ethernet-“tap”-devices"><span class="nav-number">78.</span> <span class="nav-text">ethernet “tap” devices.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-OpenVPN-peer-is-the-office-gateway"><span class="nav-number">79.</span> <span class="nav-text">Our OpenVPN peer is the office gateway.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-2-is-our-local-VPN-endpoint-home"><span class="nav-number">80.</span> <span class="nav-text">10.1.0.2 is our local VPN endpoint (home).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-1-is-our-remote-VPN-endpoint-office"><span class="nav-number">81.</span> <span class="nav-text">10.1.0.1 is our remote VPN endpoint (office).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-up-script-will-establish-routes"><span class="nav-number">82.</span> <span class="nav-text">Our up script will establish routes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#once-the-VPN-is-alive"><span class="nav-number">83.</span> <span class="nav-text">once the VPN is alive.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在-SSL-TLS-密钥交换时-Office-作为-server-Home-作为-client-1"><span class="nav-number">84.</span> <span class="nav-text">在 SSL/TLS 密钥交换时,Office 作为 server,Home 作为 client</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Certificate-Authority-file-1"><span class="nav-number">85.</span> <span class="nav-text">Certificate Authority file</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-certificate-public-key-1"><span class="nav-number">86.</span> <span class="nav-text">Our certificate/public key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-private-key-1"><span class="nav-number">87.</span> <span class="nav-text">Our private key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-缺省使用-UDP-端口-5000-1"><span class="nav-number">88.</span> <span class="nav-text">OpenVPN 缺省使用 UDP 端口 5000 .</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#每一个-OpenVPN-tunnel-必须使用一个不同的端口-1"><span class="nav-number">89.</span> <span class="nav-text">每一个 OpenVPN tunnel 必须使用一个不同的端口.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lport-和-rport-被用于指明本地或远程的不同端口-1"><span class="nav-number">90.</span> <span class="nav-text">lport 和 rport 被用于指明本地或远程的不同端口</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#出于安全考虑-初始化后UID-和GID-权限将降为-“nobody”-1"><span class="nav-number">91.</span> <span class="nav-text">出于安全考虑,初始化后UID 和GID 权限将降为 “nobody”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如果你的OpenVPN支持LZO-压缩-去掉这一行的注释-1"><span class="nav-number">92.</span> <span class="nav-text">如果你的OpenVPN支持LZO 压缩,去掉这一行的注释</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#每15秒向远端主机发送一个-UDP-ping-1"><span class="nav-number">93.</span> <span class="nav-text">每15秒向远端主机发送一个 UDP ping</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stateful-firewall-connection-1"><span class="nav-number">94.</span> <span class="nav-text">stateful firewall connection</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#alive-Uncomment-this-1"><span class="nav-number">95.</span> <span class="nav-text">alive.  Uncomment this</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#out-if-you-are-using-a-stateful-1"><span class="nav-number">96.</span> <span class="nav-text">out if you are using a stateful</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#firewall-1"><span class="nav-number">97.</span> <span class="nav-text">firewall.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-1"><span class="nav-number">98.</span> <span class="nav-text">Uncomment this section for a more reliable detection when a system</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#loses-its-connection-For-example-dial-ups-or-laptops-that-1"><span class="nav-number">99.</span> <span class="nav-text">loses its connection.  For example, dial-ups or laptops that</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#travel-to-other-locations-1"><span class="nav-number">100.</span> <span class="nav-text">travel to other locations.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#信息细节等级-1"><span class="nav-number">101.</span> <span class="nav-text">信息细节等级</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0-–-除非发生致命错误，否则保持安静。-1"><span class="nav-number">102.</span> <span class="nav-text">0 – 除非发生致命错误，否则保持安静。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-–-非常安静，但会显示一些非致命网络错误。-1"><span class="nav-number">103.</span> <span class="nav-text">1 – 非常安静，但会显示一些非致命网络错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-–-中等输出，通常情况下的很好选择。-1"><span class="nav-number">104.</span> <span class="nav-text">3 – 中等输出，通常情况下的很好选择。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-–-非常详细，用于诊断错误。-1"><span class="nav-number">105.</span> <span class="nav-text">9 – 非常详细，用于诊断错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sample-OpenVPN-configuration-file-for-2"><span class="nav-number">106.</span> <span class="nav-text">Sample OpenVPN configuration file for</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#office-using-a-pre-shared-static-key"><span class="nav-number">107.</span> <span class="nav-text">office using a pre-shared static key.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#‘-’-or-‘-’-may-be-used-to-delimit-comments-1"><span class="nav-number">108.</span> <span class="nav-text">‘#’ or ‘;’ may be used to delimit comments.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-a-dynamic-tun-device-1"><span class="nav-number">109.</span> <span class="nav-text">Use a dynamic tun device.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#For-Linux-2-2-or-non-Linux-OSes-2"><span class="nav-number">110.</span> <span class="nav-text">For Linux 2.2 or non-Linux OSes,</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#you-may-want-to-use-an-explicit-1"><span class="nav-number">111.</span> <span class="nav-text">you may want to use an explicit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unit-number-such-as-“tun1”-1"><span class="nav-number">112.</span> <span class="nav-text">unit number such as “tun1”.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-also-supports-virtual-1"><span class="nav-number">113.</span> <span class="nav-text">OpenVPN also supports virtual</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ethernet-“tap”-devices-1"><span class="nav-number">114.</span> <span class="nav-text">ethernet “tap” devices.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-1-is-our-local-VPN-endpoint-office-1"><span class="nav-number">115.</span> <span class="nav-text">10.1.0.1 is our local VPN endpoint (office).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-2-is-our-remote-VPN-endpoint-home-1"><span class="nav-number">116.</span> <span class="nav-text">10.1.0.2 is our remote VPN endpoint (home).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-up-script-will-establish-routes-1"><span class="nav-number">117.</span> <span class="nav-text">Our up script will establish routes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#once-the-VPN-is-alive-1"><span class="nav-number">118.</span> <span class="nav-text">once the VPN is alive.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-pre-shared-static-key"><span class="nav-number">119.</span> <span class="nav-text">Our pre-shared static key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-uses-UDP-port-5000-by-default"><span class="nav-number">120.</span> <span class="nav-text">OpenVPN uses UDP port 5000 by default.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Each-OpenVPN-tunnel-must-use"><span class="nav-number">121.</span> <span class="nav-text">Each OpenVPN tunnel must use</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#a-different-port-number"><span class="nav-number">122.</span> <span class="nav-text">a different port number.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lport-or-rport-can-be-used"><span class="nav-number">123.</span> <span class="nav-text">lport or rport can be used</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#to-denote-different-ports"><span class="nav-number">124.</span> <span class="nav-text">to denote different ports</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-local-and-remote"><span class="nav-number">125.</span> <span class="nav-text">for local and remote.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Downgrade-UID-and-GID-to"><span class="nav-number">126.</span> <span class="nav-text">Downgrade UID and GID to</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#“nobody”-after-initialization"><span class="nav-number">127.</span> <span class="nav-text">“nobody” after initialization</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-extra-security"><span class="nav-number">128.</span> <span class="nav-text">for extra security.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#If-you-built-OpenVPN-with"><span class="nav-number">129.</span> <span class="nav-text">If you built OpenVPN with</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LZO-compression-uncomment"><span class="nav-number">130.</span> <span class="nav-text">LZO compression, uncomment</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#out-the-following-line"><span class="nav-number">131.</span> <span class="nav-text">out the following line.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Send-a-UDP-ping-to-remote-once"><span class="nav-number">132.</span> <span class="nav-text">Send a UDP ping to remote once</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#every-15-seconds-to-keep"><span class="nav-number">133.</span> <span class="nav-text">every 15 seconds to keep</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stateful-firewall-connection-2"><span class="nav-number">134.</span> <span class="nav-text">stateful firewall connection</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#alive-Uncomment-this-2"><span class="nav-number">135.</span> <span class="nav-text">alive.  Uncomment this</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#out-if-you-are-using-a-stateful-2"><span class="nav-number">136.</span> <span class="nav-text">out if you are using a stateful</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#firewall-2"><span class="nav-number">137.</span> <span class="nav-text">firewall.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-2"><span class="nav-number">138.</span> <span class="nav-text">Uncomment this section for a more reliable detection when a system</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#loses-its-connection-For-example-dial-ups-or-laptops-that-2"><span class="nav-number">139.</span> <span class="nav-text">loses its connection.  For example, dial-ups or laptops that</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#travel-to-other-locations-2"><span class="nav-number">140.</span> <span class="nav-text">travel to other locations.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#信息细节等级-2"><span class="nav-number">141.</span> <span class="nav-text">信息细节等级</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0-–-除非发生致命错误，否则保持安静。-2"><span class="nav-number">142.</span> <span class="nav-text">0 – 除非发生致命错误，否则保持安静。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-–-非常安静，但会显示一些非致命网络错误。-2"><span class="nav-number">143.</span> <span class="nav-text">1 – 非常安静，但会显示一些非致命网络错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-–-中等输出，通常情况下的很好选择。-2"><span class="nav-number">144.</span> <span class="nav-text">3 – 中等输出，通常情况下的很好选择。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-–-非常详细，用于诊断错误。-2"><span class="nav-number">145.</span> <span class="nav-text">9 – 非常详细，用于诊断错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sample-OpenVPN-configuration-file-for-3"><span class="nav-number">146.</span> <span class="nav-text">Sample OpenVPN configuration file for</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#home-using-a-pre-shared-static-key"><span class="nav-number">147.</span> <span class="nav-text">home using a pre-shared static key.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#‘-’-or-‘-’-may-be-used-to-delimit-comments-2"><span class="nav-number">148.</span> <span class="nav-text">‘#’ or ‘;’ may be used to delimit comments.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-a-dynamic-tun-device-2"><span class="nav-number">149.</span> <span class="nav-text">Use a dynamic tun device.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#For-Linux-2-2-or-non-Linux-OSes-3"><span class="nav-number">150.</span> <span class="nav-text">For Linux 2.2 or non-Linux OSes,</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#you-may-want-to-use-an-explicit-2"><span class="nav-number">151.</span> <span class="nav-text">you may want to use an explicit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unit-number-such-as-“tun1”-2"><span class="nav-number">152.</span> <span class="nav-text">unit number such as “tun1”.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-also-supports-virtual-2"><span class="nav-number">153.</span> <span class="nav-text">OpenVPN also supports virtual</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ethernet-“tap”-devices-2"><span class="nav-number">154.</span> <span class="nav-text">ethernet “tap” devices.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-OpenVPN-peer-is-the-office-gateway-1"><span class="nav-number">155.</span> <span class="nav-text">Our OpenVPN peer is the office gateway.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-2-is-our-local-VPN-endpoint-home-1"><span class="nav-number">156.</span> <span class="nav-text">10.1.0.2 is our local VPN endpoint (home).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-0-1-is-our-remote-VPN-endpoint-office-1"><span class="nav-number">157.</span> <span class="nav-text">10.1.0.1 is our remote VPN endpoint (office).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-up-script-will-establish-routes-2"><span class="nav-number">158.</span> <span class="nav-text">Our up script will establish routes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#once-the-VPN-is-alive-2"><span class="nav-number">159.</span> <span class="nav-text">once the VPN is alive.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-pre-shared-static-key-1"><span class="nav-number">160.</span> <span class="nav-text">Our pre-shared static key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN-uses-UDP-port-5000-by-default-1"><span class="nav-number">161.</span> <span class="nav-text">OpenVPN uses UDP port 5000 by default.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Each-OpenVPN-tunnel-must-use-1"><span class="nav-number">162.</span> <span class="nav-text">Each OpenVPN tunnel must use</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#a-different-port-number-1"><span class="nav-number">163.</span> <span class="nav-text">a different port number.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lport-or-rport-can-be-used-1"><span class="nav-number">164.</span> <span class="nav-text">lport or rport can be used</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#to-denote-different-ports-1"><span class="nav-number">165.</span> <span class="nav-text">to denote different ports</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-local-and-remote-1"><span class="nav-number">166.</span> <span class="nav-text">for local and remote.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Downgrade-UID-and-GID-to-1"><span class="nav-number">167.</span> <span class="nav-text">Downgrade UID and GID to</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#“nobody”-after-initialization-1"><span class="nav-number">168.</span> <span class="nav-text">“nobody” after initialization</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-extra-security-1"><span class="nav-number">169.</span> <span class="nav-text">for extra security.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#If-you-built-OpenVPN-with-1"><span class="nav-number">170.</span> <span class="nav-text">If you built OpenVPN with</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LZO-compression-uncomment-1"><span class="nav-number">171.</span> <span class="nav-text">LZO compression, uncomment</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#out-the-following-line-1"><span class="nav-number">172.</span> <span class="nav-text">out the following line.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Send-a-UDP-ping-to-remote-once-1"><span class="nav-number">173.</span> <span class="nav-text">Send a UDP ping to remote once</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#every-15-seconds-to-keep-1"><span class="nav-number">174.</span> <span class="nav-text">every 15 seconds to keep</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stateful-firewall-connection-3"><span class="nav-number">175.</span> <span class="nav-text">stateful firewall connection</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#alive-Uncomment-this-3"><span class="nav-number">176.</span> <span class="nav-text">alive.  Uncomment this</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#out-if-you-are-using-a-stateful-3"><span class="nav-number">177.</span> <span class="nav-text">out if you are using a stateful</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#firewall-3"><span class="nav-number">178.</span> <span class="nav-text">firewall.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Uncomment-this-section-for-a-more-reliable-detection-when-a-system-3"><span class="nav-number">179.</span> <span class="nav-text">Uncomment this section for a more reliable detection when a system</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#loses-its-connection-For-example-dial-ups-or-laptops-that-3"><span class="nav-number">180.</span> <span class="nav-text">loses its connection.  For example, dial-ups or laptops that</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#travel-to-other-locations-3"><span class="nav-number">181.</span> <span class="nav-text">travel to other locations.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#信息细节等级-3"><span class="nav-number">182.</span> <span class="nav-text">信息细节等级</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0-–-除非发生致命错误，否则保持安静。-3"><span class="nav-number">183.</span> <span class="nav-text">0 – 除非发生致命错误，否则保持安静。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-–-非常安静，但会显示一些非致命网络错误。-3"><span class="nav-number">184.</span> <span class="nav-text">1 – 非常安静，但会显示一些非致命网络错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-–-中等输出，通常情况下的很好选择。-3"><span class="nav-number">185.</span> <span class="nav-text">3 – 中等输出，通常情况下的很好选择。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-–-非常详细，用于诊断错误。-3"><span class="nav-number">186.</span> <span class="nav-text">9 – 非常详细，用于诊断错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#A-sample-OpenVPN-startup-script"><span class="nav-number">187.</span> <span class="nav-text">A sample OpenVPN startup script</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-Linux"><span class="nav-number">188.</span> <span class="nav-text">for Linux.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#openvpn-config-file-directory"><span class="nav-number">189.</span> <span class="nav-text">openvpn config file directory</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#载入防火墙"><span class="nav-number">190.</span> <span class="nav-text">载入防火墙</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#载入-TUN-TAP-kernel-module"><span class="nav-number">191.</span> <span class="nav-text">载入 TUN/TAP kernel module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开启IP转发"><span class="nav-number">192.</span> <span class="nav-text">开启IP转发</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为每一个VPN隧道唤醒一个守护-daemon-模式的openvpn"><span class="nav-number">193.</span> <span class="nav-text">为每一个VPN隧道唤醒一个守护(daemon)模式的openvpn</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Invoke-openvpn-for-each-VPN-tunnel"><span class="nav-number">194.</span> <span class="nav-text">Invoke openvpn for each VPN tunnel</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#in-daemon-mode-Alternatively"><span class="nav-number">195.</span> <span class="nav-text">in daemon mode.  Alternatively,</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#you-could-remove-“–daemon”-from"><span class="nav-number">196.</span> <span class="nav-text">you could remove “–daemon” from</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#the-command-line-and-add-“daemon”"><span class="nav-number">197.</span> <span class="nav-text">the command line and add “daemon”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#to-the-config-file"><span class="nav-number">198.</span> <span class="nav-text">to the config file.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Each-tunnel-should-run-on-a-separate"><span class="nav-number">199.</span> <span class="nav-text">Each tunnel should run on a separate</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UDP-port-Use-the-“port”-option"><span class="nav-number">200.</span> <span class="nav-text">UDP port.  Use the “port” option</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#to-control-this-Like-all-of"><span class="nav-number">201.</span> <span class="nav-text">to control this.  Like all of</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenVPN’s-options-you-can"><span class="nav-number">202.</span> <span class="nav-text">OpenVPN’s options, you can</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#specify-“–port-8000”-on-the-command"><span class="nav-number">203.</span> <span class="nav-text">specify “–port 8000” on the command</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#line-or-“port-8000”-in-the-config"><span class="nav-number">204.</span> <span class="nav-text">line or “port 8000” in the config</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#file"><span class="nav-number">205.</span> <span class="nav-text">file.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stop-all-openvpn-processes"><span class="nav-number">206.</span> <span class="nav-text">stop all openvpn processes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#openvpn-This-shell-script-takes-care-of-starting-and-stopping"><span class="nav-number">207.</span> <span class="nav-text">openvpn       This shell script takes care of starting and stopping</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#openvpn-on-RedHat-or-other-chkconfig-based-system"><span class="nav-number">208.</span> <span class="nav-text">openvpn on RedHat or other chkconfig-based system.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#chkconfig-345-80-30"><span class="nav-number">209.</span> <span class="nav-text">chkconfig: 345 80 30</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#描述-OpenVPN-is-a-robust-and-highly-flexible-tunneling-application-that"><span class="nav-number">210.</span> <span class="nav-text">描述:         OpenVPN is a robust and highly flexible tunneling application that</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#uses-all-of-the-encryption-authentication-and-certification-features"><span class="nav-number">211.</span> <span class="nav-text">uses all of the encryption, authentication, and certification features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#of-the-OpenSSL-library-to-securely-tunnel-IP-networks-over-a-single"><span class="nav-number">212.</span> <span class="nav-text">of the OpenSSL library to securely tunnel IP networks over a single</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UDP-port"><span class="nav-number">213.</span> <span class="nav-text">UDP port.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contributed-to-the-OpenVPN-project-by"><span class="nav-number">214.</span> <span class="nav-text">Contributed to the OpenVPN project by</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Douglas-Keller"><span class="nav-number">215.</span> <span class="nav-text">Douglas Keller</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2002-05-15"><span class="nav-number">216.</span> <span class="nav-text">2002.05.15</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装此脚本"><span class="nav-number">217.</span> <span class="nav-text">安装此脚本:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#将这个文件拷贝到-etc-rc-d-init-d-openvpn"><span class="nav-number">218.</span> <span class="nav-text">将这个文件拷贝到 /etc/rc.d/init.d/openvpn</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shell-gt-chkconfig-–add-openvpn"><span class="nav-number">219.</span> <span class="nav-text">shell> chkconfig –add openvpn</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shell-gt-mkdir-etc-openvpn"><span class="nav-number">220.</span> <span class="nav-text">shell> mkdir /etc/openvpn</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#make-conf-or-sh-files-in-etc-openvpn-see-below"><span class="nav-number">221.</span> <span class="nav-text">make .conf or .sh files in /etc/openvpn (see below)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#删除此脚本"><span class="nav-number">222.</span> <span class="nav-text">删除此脚本:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#运行-chkconfig-–del-openvpn"><span class="nav-number">223.</span> <span class="nav-text">运行: chkconfig –del openvpn</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#作者提示"><span class="nav-number">224.</span> <span class="nav-text">作者提示:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#我已经写了一个-etc-init-d-初始化脚本并修改了-openvpn-spec-可以自动注册该脚本。"><span class="nav-number">225.</span> <span class="nav-text">我已经写了一个 /etc/init.d 初始化脚本并修改了 openvpn.spec 可以自动注册该脚本。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RPM-包装好后你可以直接使用-“service-openvpn-start”-和-“service-openvpn-stop”"><span class="nav-number">226.</span> <span class="nav-text">RPM 包装好后你可以直接使用 “service openvpn start” 和 “service openvpn stop”.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#命令启动和终止-OpenVPN"><span class="nav-number">227.</span> <span class="nav-text">命令启动和终止 OpenVPN.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#初始化脚本工作如下："><span class="nav-number">228.</span> <span class="nav-text">初始化脚本工作如下：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为它在-etc-openvpn下找到的每一个-conf-文件启动一个-openvpn-进程"><span class="nav-number">229.</span> <span class="nav-text">- 为它在/etc/openvpn下找到的每一个 .conf 文件启动一个 openvpn 进程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如果存在对应于-xxx-conf-的-etc-openvpn-xxx-sh-文件，"><span class="nav-number">230.</span> <span class="nav-text">- 如果存在对应于 xxx.conf 的 /etc/openvpn/xxx.sh 文件，</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#那么在它启动-openvpn-前执行它-作-openvpn-–mktun…-时很有用-。"><span class="nav-number">231.</span> <span class="nav-text">那么在它启动 openvpn 前执行它(作 openvpn –mktun… 时很有用)。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#除-start-stop-外还可以执行："><span class="nav-number">232.</span> <span class="nav-text">- 除 start/stop 外还可以执行：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#service-openvpn-reload-SIGHUP"><span class="nav-number">233.</span> <span class="nav-text">service openvpn reload - SIGHUP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#service-openvpn-reopen-SIGUSR1"><span class="nav-number">234.</span> <span class="nav-text">service openvpn reopen - SIGUSR1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#service-openvpn-status-SIGUSR2"><span class="nav-number">235.</span> <span class="nav-text">service openvpn status - SIGUSR2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Modifications-2003-05-02"><span class="nav-number">236.</span> <span class="nav-text">Modifications 2003.05.02</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Changed-to-for-sh-compliance-Bishop-Clark"><span class="nav-number">237.</span> <span class="nav-text">* Changed == to = for sh compliance (Bishop Clark).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#If-condrestart-reload-reopen-status-check-that-we-were"><span class="nav-number">238.</span> <span class="nav-text">* If condrestart|reload|reopen|status, check that we were</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#actually-started-James-Yonan"><span class="nav-number">239.</span> <span class="nav-text">actually started (James Yonan).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Added-lock-piddir-and-work-variables-James-Yonan"><span class="nav-number">240.</span> <span class="nav-text">* Added lock, piddir, and work variables (James Yonan).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#If-start-is-attempted-twice-without-an-intervening-stop-or"><span class="nav-number">241.</span> <span class="nav-text">* If start is attempted twice, without an intervening stop, or</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#if-start-is-attempted-when-previous-start-was-not-properly"><span class="nav-number">242.</span> <span class="nav-text">if start is attempted when previous start was not properly</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shut-down-then-kill-any-previously-started-processes-before"><span class="nav-number">243.</span> <span class="nav-text">shut down, then kill any previously started processes, before</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#commencing-new-start-operation-James-Yonan"><span class="nav-number">244.</span> <span class="nav-text">commencing new start operation (James Yonan).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Do-a-better-job-of-flagging-errors-on-start-and-properly"><span class="nav-number">245.</span> <span class="nav-text">* Do a better job of flagging errors on start, and properly</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#returning-success-or-failure-status-to-caller-James-Yonan"><span class="nav-number">246.</span> <span class="nav-text">returning success or failure status to caller (James Yonan).</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Location-of-openvpn-binary"><span class="nav-number">247.</span> <span class="nav-text">Location of openvpn binary</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lockfile"><span class="nav-number">248.</span> <span class="nav-text">Lockfile</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PID-directory"><span class="nav-number">249.</span> <span class="nav-text">PID directory</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Our-working-directory"><span class="nav-number">250.</span> <span class="nav-text">Our working directory</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Source-function-library"><span class="nav-number">251.</span> <span class="nav-text">Source function library.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Source-networking-configuration"><span class="nav-number">252.</span> <span class="nav-text">Source networking configuration.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Check-that-networking-is-up"><span class="nav-number">253.</span> <span class="nav-text">Check that networking is up.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#See-how-we-were-called"><span class="nav-number">254.</span> <span class="nav-text">See how we were called.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#From-a-security-perspective-I-think-it-makes"><span class="nav-number">255.</span> <span class="nav-text">From a security perspective, I think it makes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sense-to-remove-this-and-have-users-who-need"><span class="nav-number">256.</span> <span class="nav-text">sense to remove this, and have users who need</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#it-explictly-enable-in-their-–up-scripts-or"><span class="nav-number">257.</span> <span class="nav-text">it explictly enable in their –up scripts or</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#firewall-setups"><span class="nav-number">258.</span> <span class="nav-text">firewall setups.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#we-were-not-shut-down-correctly"><span class="nav-number">259.</span> <span class="nav-text">we were not shut down correctly</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Start-every-conf-in-work-and-run-sh-if-exists"><span class="nav-number">260.</span> <span class="nav-text">Start every .conf in $work and run .sh if exists</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#avoid-race"><span class="nav-number">261.</span> <span class="nav-text">avoid race</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#An-xinetd-configuration-file-for-OpenVPN"><span class="nav-number">262.</span> <span class="nav-text">An xinetd configuration file for OpenVPN.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-file-should-be-renamed-to-openvpn-or-something-suitably"><span class="nav-number">263.</span> <span class="nav-text">This file should be renamed to openvpn or something suitably</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#descriptive-and-copied-to-the-etc-xinetd-d-directory"><span class="nav-number">264.</span> <span class="nav-text">descriptive and copied to the /etc/xinetd.d directory.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xinetd-can-then-be-made-aware-of-this-file-by-restarting"><span class="nav-number">265.</span> <span class="nav-text">xinetd can then be made aware of this file by restarting</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#it-or-sending-it-a-SIGHUP-signal"><span class="nav-number">266.</span> <span class="nav-text">it or sending it a SIGHUP signal.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#For-each-potential-incoming-client-create-a-separate-version"><span class="nav-number">267.</span> <span class="nav-text">For each potential incoming client, create a separate version</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#of-this-configuration-file-on-a-unique-port-number-Also-note"><span class="nav-number">268.</span> <span class="nav-text">of this configuration file on a unique port number.  Also note</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#that-the-key-file-and-ifconfig-endpoints-should-be-unique-for"><span class="nav-number">269.</span> <span class="nav-text">that the key file and ifconfig endpoints should be unique for</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#each-client-This-configuration-assumes-that-the-OpenVPN"><span class="nav-number">270.</span> <span class="nav-text">each client.  This configuration assumes that the OpenVPN</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#executable-and-key-live-in-root-openvpn-Change-this-to-fit"><span class="nav-number">271.</span> <span class="nav-text">executable and key live in /root/openvpn.  Change this to fit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#your-environment"><span class="nav-number">272.</span> <span class="nav-text">your environment.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-OpenVPN-config-file"><span class="nav-number">273.</span> <span class="nav-text">This OpenVPN config file</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#is-the-client-side-counterpart"><span class="nav-number">274.</span> <span class="nav-text">is the client side counterpart</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#of-xinetd-server-config"><span class="nav-number">275.</span> <span class="nav-text">of xinetd-server-config</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wooley Gu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
